"use strict";(()=>{var e={};e.id=947,e.ids=[947],e.modules={11185:e=>{e.exports=require("mongoose")},72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},39491:e=>{e.exports=require("assert")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},82361:e=>{e.exports=require("events")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},63477:e=>{e.exports=require("querystring")},57310:e=>{e.exports=require("url")},73837:e=>{e.exports=require("util")},59796:e=>{e.exports=require("zlib")},64631:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>g,originalPathname:()=>q,requestAsyncStorage:()=>c,routeModule:()=>l,serverHooks:()=>x,staticGenerationAsyncStorage:()=>m,staticGenerationBailout:()=>h});var s={};r.r(s),r.d(s,{GET:()=>GET,dynamic:()=>d});var a=r(10884),i=r(16132),o=r(46031),n=r(60357),p=r(94020),u=r(95798);let d="force-dynamic";async function GET(e){try{let{user:e}=await (0,p.getServerSession)(),t=await n.Z.findOne({email:e.email}).select("_id "),r=await o.Z.aggregate([{$match:{participants:{$elemMatch:{$eq:t._id}}}},{$sort:{updatedAt:-1}},{$lookup:{from:"users",foreignField:"_id",localField:"participants",as:"participants",pipeline:[{$project:{password:0,contacts:0,updatedAt:0,createdAt:0}}]}},{$lookup:{from:"chatmessages",foreignField:"_id",localField:"lastMessage",as:"lastMessage",pipeline:[{$lookup:{from:"users",foreignField:"_id",localField:"sender",as:"sender",pipeline:[{$project:{name:1,avatar:1,email:1}}]}},{$addFields:{sender:{$first:"$sender"}}}]}},{$addFields:{lastMessage:{$first:"$lastMessage"}}}]);return u.Z.json({chats:r},{status:200})}catch(e){return console.log("[GET_CHATS]",e),new u.Z(e)}}let l=new a.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/chats/route",pathname:"/api/chats",filename:"route",bundlePath:"app/api/chats/route"},resolvedPagePath:"/Users/quangnhat/Documents/Chatapp-Kathie/app/api/chats/route.js",nextConfigOutput:"",userland:s}),{requestAsyncStorage:c,staticGenerationAsyncStorage:m,serverHooks:x,headerHooks:g,staticGenerationBailout:h}=l,q="/api/chats/route"},46031:(e,t,r)=>{r.d(t,{Z:()=>o});var s=r(11185);let a=new s.Schema({lastMessage:{type:s.Schema.Types.ObjectId,ref:"ChatMessage"},participants:[{type:s.Schema.Types.ObjectId,ref:"User"}],unread:{type:Number,default:0}},{timestamps:!0}),i=s.models.Chat||(0,s.model)("Chat",a),o=i}};var t=require("../../../webpack-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),r=t.X(0,[657,449,11,674,107,20,357],()=>__webpack_exec__(64631));module.exports=r})();