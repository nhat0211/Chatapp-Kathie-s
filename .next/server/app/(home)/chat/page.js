(()=>{var e={};e.id=412,e.ids=[412],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},55403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},94749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},32081:e=>{"use strict";e.exports=require("child_process")},6113:e=>{"use strict";e.exports=require("crypto")},82361:e=>{"use strict";e.exports=require("events")},57147:e=>{"use strict";e.exports=require("fs")},13685:e=>{"use strict";e.exports=require("http")},95687:e=>{"use strict";e.exports=require("https")},41808:e=>{"use strict";e.exports=require("net")},70612:e=>{"use strict";e.exports=require("node:os")},97742:e=>{"use strict";e.exports=require("node:process")},25997:e=>{"use strict";e.exports=require("node:tty")},22037:e=>{"use strict";e.exports=require("os")},71017:e=>{"use strict";e.exports=require("path")},12781:e=>{"use strict";e.exports=require("stream")},24404:e=>{"use strict";e.exports=require("tls")},76224:e=>{"use strict";e.exports=require("tty")},57310:e=>{"use strict";e.exports=require("url")},73837:e=>{"use strict";e.exports=require("util")},59796:e=>{"use strict";e.exports=require("zlib")},37717:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>n.a,__next_app__:()=>m,originalPathname:()=>u,pages:()=>c,routeModule:()=>x,tree:()=>d});var a=s(67096),r=s(16132),l=s(37284),n=s.n(l),i=s(32564),o={};for(let e in i)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>i[e]);s.d(t,o);let d=["",{children:["(home)",{children:["chat",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,48717)),"/Users/quangnhat/Documents/Chatapp-Kathie/app/(home)/chat/page.jsx"]}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,56887)),"/Users/quangnhat/Documents/Chatapp-Kathie/app/(home)/layout.jsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,9291,23)),"next/dist/client/components/not-found-error"]}]},{layout:[()=>Promise.resolve().then(s.bind(s,49813)),"/Users/quangnhat/Documents/Chatapp-Kathie/app/layout.jsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,9291,23)),"next/dist/client/components/not-found-error"]}],c=["/Users/quangnhat/Documents/Chatapp-Kathie/app/(home)/chat/page.jsx"],u="/(home)/chat/page",m={require:s,loadChunk:()=>Promise.resolve()},x=new a.AppPageRouteModule({definition:{kind:r.x.APP_PAGE,page:"/(home)/chat/page",pathname:"/chat",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},31706:(e,t,s)=>{Promise.resolve().then(s.bind(s,59813))},59813:(e,t,s)=>{"use strict";let a;s.r(t),s.d(t,{default:()=>chat_page_client});var r=s(30784),l=s(9885),n=s(74284),i=s(7589),o=s(56206),d=s(1268);let c=i.fC;i.xz;let u=i.h_;i.x8;let m=l.forwardRef(({className:e,...t},s)=>r.jsx(i.aV,{ref:s,className:(0,d.cn)("fixed inset-0 z-50 bg-background/80 backdrop-blur-sm data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...t}));m.displayName=i.aV.displayName;let x=l.forwardRef(({className:e,children:t,...s},a)=>(0,r.jsxs)(u,{children:[r.jsx(m,{}),(0,r.jsxs)(i.VY,{ref:a,className:(0,d.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg md:w-full",e),...s,children:[t,(0,r.jsxs)(i.x8,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[r.jsx(o.Z,{className:"h-4 w-4"}),r.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));x.displayName=i.VY.displayName;let DialogHeader=({className:e,...t})=>r.jsx("div",{className:(0,d.cn)("flex flex-col space-y-1.5 text-center sm:text-left",e),...t});DialogHeader.displayName="DialogHeader";let f=l.forwardRef(({className:e,...t},s)=>r.jsx(i.Dx,{ref:s,className:(0,d.cn)("text-lg font-semibold leading-none tracking-tight",e),...t}));f.displayName=i.Dx.displayName;let h=l.forwardRef(({className:e,...t},s)=>r.jsx(i.dk,{ref:s,className:(0,d.cn)("text-sm text-muted-foreground",e),...t}));h.displayName=i.dk.displayName;let Modal=({title:e,description:t,isOpen:s,onClose:a,children:l})=>r.jsx(c,{open:s,onOpenChange:e=>{e||a()},children:(0,r.jsxs)(x,{children:[(0,r.jsxs)(DialogHeader,{children:[r.jsx(f,{children:e}),r.jsx(h,{children:t})]}),r.jsx("div",{children:l})]})});var p=s(1488),g=s(56456);let AddModal=({isOpen:e,onClose:t,onConfirm:s,loading:a})=>{let[n,i]=(0,l.useState)(!1),o=(0,l.useRef)(null);return((0,l.useEffect)(()=>{i(!0)},[]),n)?r.jsx(Modal,{title:"Add Contact",description:"Add a new person",isOpen:e,onClose:t,children:(0,r.jsxs)("div",{className:"space-y-4 py-2 pb-4",children:[r.jsx(g.I,{ref:o,placeholder:"Email"}),r.jsx("div",{className:"pt-6 space-x-2 flex items-center justify-end w-full",children:r.jsx(p.z,{disabled:a,variant:"default",className:"bg-orange text-accent_1",onClick:()=>s(o?.current.value),children:"Add"})})]})}):null};var j=s(22385),b=s(57114),w=s(10345),v=s(85456),y=s(69518);let N={shallow:!0},search_bar=()=>{let e=(0,b.useSearchParams)(),t=(0,b.usePathname)(),s=(0,b.useRouter)(),a=(0,l.useCallback)((t,s)=>{let a=new URLSearchParams(e);return a.set(t,s),a.toString()},[e]);function clearParams(){s.push(`${t}`,N)}return(0,r.jsxs)("div",{className:"flex items-center rounded-3xl border border-input px-4 py-2 ml-auto mr-5 md:mx-2 ",children:[r.jsx("input",{type:"text",name:"search",placeholder:"Search",className:"w-20 xs:w-28 bg-transparent h-full  outline-none text-sm",onChange:e=>{""===e.target.value?clearParams():s.push(`${t}/?${a("search",e.target.value)}`,N)},value:e.get("search")||""}),r.jsx(y.Z,{className:"w-5 h-5"})]})},contact_ContactHeader=({currUser:e})=>{let[t,s]=(0,l.useState)(!1),[a,n]=(0,l.useState)(!1),{setContacts:i,contacts:o}=(0,v.useChat)(),d=(0,b.useRouter)(),handleAddContact=async t=>{if(t&&e){if(t===e?.email){w.toast.error("You cant add your self.");return}n(!0);try{let a=await fetch("api/addContact",{method:"POST",body:JSON.stringify({currUser:e?.email,personToAdd:t})}),{data:r,error:l}=await a.json();if(l){w.toast.error(l);return}r||w.toast.error("Something went wrong."),i([...o,r]),w.toast.success("Contact added successfully."),s(!1),d.refresh()}catch(e){console.log("error occured: ",e),w.toast.error("Something went wrong."|e.message)}finally{n(!1)}}};return(0,r.jsxs)(r.Fragment,{children:[r.jsx(AddModal,{loading:a,isOpen:t,onClose:()=>s(!1),onConfirm:handleAddContact}),(0,r.jsxs)("header",{className:"flex items-center bg-primary rounded-xl px-5 py-5 justify-between md:justify-around md:max-w-contact w-full shadow-md",children:[r.jsx("p",{className:"hidden xs:block text-heading text-lg font-semibold ml-10 md:ml-0",children:"Chat"}),r.jsx(search_bar,{}),r.jsx(p.z,{onClick:()=>s(!0),size:"icon",className:"bg-orange rounded-full hover:text-accent_1 hover:ring-orange hover:ring-1",children:r.jsx(j.Z,{className:"w-4 h-4"})})]})]})};var _=s(52451),C=s.n(_);let contact_list=()=>{let{getChat:e,contacts:t}=(0,v.useChat)();return(0,r.jsxs)(r.Fragment,{children:[r.jsx("p",{className:"font-medium text-md text-on_white_gray ml-6 mt-4 hidden md:block",children:"Contacts"}),t?.length>0&&t.map((s,a)=>(0,r.jsxs)("div",{onClick:()=>e(s?._id),className:"hidden md:flex items-center gap-2 py-3 px-5 relative self-stretch w-full text-black cursor-pointer  rounded-md",children:[r.jsx(C(),{src:s?.avatar,width:40,height:40,alt:"user-avatar",className:"rounded-full w-10 h-10 aspect-square object-cover"}),r.jsx("div",{className:"flex flex-col items-start gap-[3px]",children:r.jsx("p",{className:"text-sm text-black_accent_2 font-medium",children:s?.name})}),a!==t.length-1&&r.jsx("div",{className:"absolute bottom-0 left-1/2 -translate-x-1/2 h-[1px] w-[85%] bg-on_white_gray_2"})]},s?._id))]})},OnlineStatus=()=>r.jsx("span",{className:"absolute z-50 top-[2px] right-[2px] rounded-full w-2 h-2 bg-green-500 transition animate-in duration-150"});function Skeleton({className:e,...t}){return r.jsx("div",{className:(0,d.cn)("animate-pulse rounded-md bg-on_white_gray",e),...t})}function ChatsContactsSkeleton({className:e,count:t}){return r.jsx(r.Fragment,{children:Array.from({length:t}).map((t,s)=>(0,r.jsxs)("div",{className:(0,d.cn)("w-full flex grow justify-center min-h-[65px] gap-3 py-3 px-6",e),children:[r.jsx(Skeleton,{className:"h-11 w-11 aspect-square rounded-full"}),(0,r.jsxs)("div",{className:"space-y-2 grow w-full self-stretch",children:[r.jsx(Skeleton,{className:"h-4"}),r.jsx(Skeleton,{className:"h-4 w-[50%]"})]})]},s))})}var S=s(51749),k=s(64731),E=s.n(k);let chat_ChatList=({session:e})=>{let[t,s]=(0,l.useState)(!1),{currentChat:a,handleSetCurrChat:n,chats:i,chatsLoading:o}=(0,v.useChat)(),[d,c]=(0,l.useState)([]),u=(0,b.useSearchParams)(),{members:m}=(0,S.Z)(),x=(0,l.useCallback)(t=>{let s=t.filter(t=>t.email!==e?.user.email);return s[0]},[e?.user.email]),f=(0,l.useCallback)(e=>m.includes(e),[m]);return((0,l.useEffect)(()=>{let e=u.get("search")?.toLowerCase();if(e){let t=i.filter(t=>{let s=x(t?.participants);return s?.email?.toLowerCase().includes(e)});c(t)}else c(i)},[i,u,x]),(0,l.useEffect)(()=>{s(!0)},[]),t)?(0,r.jsxs)(r.Fragment,{children:[r.jsx("span",{className:"text-xs text-on_white_gray ml-6 mt-4",children:"All"}),o&&r.jsx(ChatsContactsSkeleton,{count:7,className:"grow min-h-[65px] h-[65px] gap-3 py-3"}),d?.length>0&&d?.map((t,s)=>{let l=x(t?.participants);return r.jsxs("div",{className:`flex relative hover:bg-on_white_gray_2 overflow-hidden
                        transition-colors ease-in duration-150 min-h-[65px]
                        ${a&&a._id===t?._id?"bg-on_white_gray_2":""}
                        items-center gap-3 py-3 relative self-stretch
                        w-full cursor-pointer `,onClick:()=>{a&&a._id===t?._id||n(t)},children:[r.jsxs("div",{className:"w-11 h-11 rounded-full relative ml-6 ",children:[r.jsx(C(),{fill:!0,src:l?.avatar,className:"object-cover rounded-full overflow-hidden",alt:"user profile"}),f(l?.email)&&r.jsx(OnlineStatus,{})]}),r.jsx("p",{className:"text-[10px] tracking-wide absolute top-2 font-medium right-4 text-accent_2",children:E()(t?.updatedAt).format("HH:mm A")}),t?.unread>0&&t?.lastMessage?.sender?.email!==e?.user?.email&&r.jsx("span",{className:"absolute top-1/2 -translate-y-1/2  flex items-center justify-center w-4 h-4  rounded-full right-4 text-[10px]  font-bold bg-orange text-white",children:t?.unread}),r.jsxs("div",{className:"flex flex-col items-start gap-[3px] truncate",children:[r.jsx("p",{className:"text-sm text-accent_1 font-medium",children:l?.name}),a?._id!==t?._id&&r.jsx("p",{className:"text-accent_2 text-xs font-medium truncate w-full",children:t?.lastMessage?.content})]}),s!==i.length-1&&r.jsx("div",{className:"absolute bottom-0 left-1/2 -translate-x-1/2 h-[1px] w-[85%] bg-on_white_gray_2"})]},t?._id)})]}):null},contact_Contacts=()=>{let{data:e}=(0,n.useSession)();return(0,r.jsxs)("div",{className:"flex flex-col items-start gap-2 self-stretch w-full  md:max-w-contact",children:[r.jsx(contact_ContactHeader,{currUser:e?.user}),(0,r.jsxs)("div",{className:"relative self-stretch w-full grow overflow-hidden",children:[r.jsx("div",{className:"absolute inset-x-0 top-0 h-5 z-50 bg-gradient-to-b from-white to-transparent rounded-t-xl pointer-events-none"}),(0,r.jsxs)("div",{id:"chat-list",className:" max-h-[200px] md:max-h-full h-full w-full flex flex-col items-start   md:max-w-contact overflow-y-scroll bg-primary  gap-3 shadow-md rounded-xl",children:[r.jsx(chat_ChatList,{session:e}),r.jsx(contact_list,{}),r.jsx("div",{className:"w-full h-[100px]"})]}),r.jsx("div",{className:"absolute inset-x-0 bottom-0 h-20  bg-gradient-to-t from-white to-transparent rounded-b-xl pointer-events-none"})]})]})};var M=s(4345),A=s(87052),q=s(11922),R=s(1264),P=s(74151);let z=A.fC,D=A.xz;A.ZA,A.Uv,A.Tr,A.Ee;let Z=l.forwardRef(({className:e,inset:t,children:s,...a},l)=>(0,r.jsxs)(A.fF,{ref:l,className:(0,d.cn)("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent",t&&"pl-8",e),...a,children:[s,r.jsx(q.Z,{className:"ml-auto h-4 w-4"})]}));Z.displayName=A.fF.displayName;let T=l.forwardRef(({className:e,...t},s)=>r.jsx(A.tu,{ref:s,className:(0,d.cn)("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...t}));T.displayName=A.tu.displayName;let U=l.forwardRef(({className:e,sideOffset:t=4,...s},a)=>r.jsx(A.Uv,{children:r.jsx(A.VY,{ref:a,sideOffset:t,className:(0,d.cn)("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...s})}));U.displayName=A.VY.displayName;let F=l.forwardRef(({className:e,inset:t,...s},a)=>r.jsx(A.ck,{ref:a,className:(0,d.cn)("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t&&"pl-8",e),...s}));F.displayName=A.ck.displayName;let L=l.forwardRef(({className:e,children:t,checked:s,...a},l)=>(0,r.jsxs)(A.oC,{ref:l,className:(0,d.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),checked:s,...a,children:[r.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:r.jsx(A.wU,{children:r.jsx(R.Z,{className:"h-4 w-4"})})}),t]}));L.displayName=A.oC.displayName;let O=l.forwardRef(({className:e,children:t,...s},a)=>(0,r.jsxs)(A.Rk,{ref:a,className:(0,d.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),...s,children:[r.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:r.jsx(A.wU,{children:r.jsx(P.Z,{className:"h-2 w-2 fill-current"})})}),t]}));O.displayName=A.Rk.displayName;let V=l.forwardRef(({className:e,inset:t,...s},a)=>r.jsx(A.__,{ref:a,className:(0,d.cn)("px-2 py-1.5 text-sm font-semibold",t&&"pl-8",e),...s}));V.displayName=A.__.displayName;let B=l.forwardRef(({className:e,...t},s)=>r.jsx(A.Z0,{ref:s,className:(0,d.cn)("-mx-1 my-1 h-px bg-muted",e),...t}));B.displayName=A.Z0.displayName;var H=s(16665),G=s(51734);let DeleteModal=({isOpen:e,onClose:t,onConfirm:s,loading:a})=>{let[n,i]=(0,l.useState)(!1);return((0,l.useEffect)(()=>{i(!0)},[]),n)?r.jsx(Modal,{title:"Are you sure ?",description:"This action will not be reversed.",isOpen:e,onClose:t,children:(0,r.jsxs)("div",{className:"pt-6 space-x-2 flex items-center justify-end w-full",children:[r.jsx(p.z,{disabled:a,variant:"outline",className:" text-accent_1",onClick:t,children:"Cancel"}),r.jsx(p.z,{disabled:a,variant:"destructive",onClick:()=>s(),children:"Delete"})]})}):null},chat_ChatHeader=({selectedChat:e,currUserEmail:t})=>{let[s,a]=(0,l.useState)(!1),[i,c]=(0,l.useState)(!1),{currentChat:u,handleSetCurrChat:m,closeChat:x}=(0,v.useChat)(),{data:f}=(0,n.useSession)(),{socket:h}=(0,M.useSocket)(),p=(0,b.useRouter)(),{members:g}=(0,S.Z)(),deleteMessages=async()=>{try{c(!0);let e=await fetch(`api/chats/${u?._id}/messages`,{method:"DELETE"}),{newChat:t}=await e.json();console.log(t),m(t),w.toast.success("Chat cleared!"),p.refresh()}catch(e){console.log(e),w.toast.error(e.message||"Please try again later.")}finally{a(!1),c(!1)}},j=(e=>{if(e){let s=e?.filter(e=>e.email!==t);return s[0]}return null})(e?.participants),y=(0,l.useMemo)(()=>g.includes(j?.email),[g,j?.email]);return(0,r.jsxs)(r.Fragment,{children:[r.jsx(DeleteModal,{onClose:()=>a(!1),isOpen:s,onConfirm:deleteMessages,loading:i}),(0,r.jsxs)("header",{className:"w-full hidden md:flex self-stretch  items-center gap-4 px-6 py-4 bg-primary rounded-xl max-h-[80px] shadow-sm",children:[r.jsx("div",{className:"relative w-12 h-12 rounded-full",children:r.jsx(C(),{src:j?.avatar,fill:!0,className:"rounded-full overflow-hidden object-cover object-center",alt:"user-profile"})}),(0,r.jsxs)("div",{className:"flex flex-col items-start ",children:[r.jsx("p",{className:"text-accent_1 font-medium",children:j?.name}),r.jsx("p",{className:(0,d.cn)("text-[10px] text-accent_2 tracking-wide",y&&"text-green-400 font-semibold"),children:y?"Online":"Offline"})]}),r.jsx("div",{className:"flex items-center ml-auto gap-4",children:r.jsx("div",{className:"cursor-pointer relative flex items-center justify-center",children:(0,r.jsxs)(z,{children:[r.jsx(D,{children:r.jsx(H.Z,{className:"w-5 h-5"})}),(0,r.jsxs)(U,{className:"mr-12 mt-4",children:[(0,r.jsxs)(F,{onClick:()=>a(!0),className:"text-red-500 cursor-pointer",children:[r.jsx(G.Z,{className:"w-4 h-4 mr-2"}),"Clear Chat"]}),(0,r.jsxs)(F,{onClick:x,className:"cursor-pointer",children:[r.jsx(o.Z,{className:"w-4 h-4 mr-2"}),"Close Chat"]})]})]})})})]})]})};var Y=s(63657),$=s(28089),I=s(28464),K=s(6865),J=s(84770);let emoji=({onSuccess:e})=>(0,r.jsxs)(z,{children:[r.jsx(D,{asChild:!0,children:r.jsx(p.z,{size:"icon",variant:"outline",children:r.jsx(J.Z,{className:"w-4 h-4 "})})}),r.jsx(U,{className:"w-fit",children:r.jsx(K.Z,{data:I,onEmojiSelect:e})})]});var W=s(62532);let components_MessageInput=({value:e,onChange:t,onSubmit:s,loading:a,onFileChange:n})=>{let[i,o]=(0,l.useState)(!1),d=(0,l.useRef)();return((0,l.useEffect)(()=>{o(!0)},[]),(0,l.useEffect)(()=>{a||d?.current?.focus()},[a]),i)?(0,r.jsxs)("div",{className:"w-full mt-auto flex items-center gap-3 overflow-hidden justify-between rounded-l-lg ",children:[(0,r.jsxs)("label",{htmlFor:"media-message",className:`transition bg-orange rounded-lg ml-auto hover:bg-black hover:text-orange p-4 shadow-md ${a?"opacity-60":""}`,children:[r.jsx("input",{type:"file",name:"media-message",id:"media-message",hidden:!0,onChange:n}),r.jsx(Y.Z,{className:"w-5 h-5"})]}),(0,r.jsxs)("div",{className:"grow h-full flex items-center w-full bg-primary rounded-lg overflow-hidden shadow-md p-1",children:[r.jsx("input",{type:"text",ref:d,value:e,onChange:t,onKeyDown:t=>{e&&"Enter"===t.key&&s()},className:`grow h-full w-full px-5 outline-none
                               font-medium text-sm  bg-transparent placeholder:opacity-70
                                 placeholder-black_accent_2 focus-visible:ring-0`,placeholder:"Hey there!",disabled:a}),r.jsx(emoji,{onSuccess:({native:e})=>{t({},!0,e),d?.current.focus()}})]}),r.jsx("button",{disabled:a||""===e,onClick:t=>{t.preventDefault(),e&&s()},className:`transition bg-orange rounded-lg ml-auto hover:bg-black hover:text-orange p-4 shadow-md ${a?"opacity-60":""}`,children:r.jsx($.Z,{className:"w-5 h-5"})})]}):null},X="receive-message",Q="typing",{useState:ee,useEffect:et}=s(9885);function useDebounce(e,t){let[s,a]=ee(e);return et(()=>{let s=setTimeout(()=>{a(e)},t);return()=>{clearTimeout(s)}},[e,t]),s}let es=useDebounce,typing_status=()=>(0,r.jsxs)("div",{className:"text-xs text-orange font-semibold flex space-x-1 animate-in animate-out px-3",children:[r.jsx("span",{children:"typing"}),r.jsx("span",{className:"animate-blink scale-150",children:"."}),r.jsx("span",{className:"animate-blink delay-200 scale-150",children:"."}),r.jsx("span",{className:"animate-blink delay-400 scale-150",children:"."})]});var ea=s(44999),er=s(64097);let el=er.fC,en=er.xz;er.ZA,er.Uv,er.Tr,er.Ee;let ei=l.forwardRef(({className:e,inset:t,children:s,...a},l)=>(0,r.jsxs)(er.fF,{ref:l,className:(0,d.cn)("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground",t&&"pl-8",e),...a,children:[s,r.jsx(q.Z,{className:"ml-auto h-4 w-4"})]}));ei.displayName=er.fF.displayName;let eo=l.forwardRef(({className:e,...t},s)=>r.jsx(er.tu,{ref:s,className:(0,d.cn)("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...t}));eo.displayName=er.tu.displayName;let ed=l.forwardRef(({className:e,...t},s)=>r.jsx(er.Uv,{children:r.jsx(er.VY,{ref:s,className:(0,d.cn)("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md animate-in fade-in-80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...t})}));ed.displayName=er.VY.displayName;let ec=l.forwardRef(({className:e,inset:t,...s},a)=>r.jsx(er.ck,{ref:a,className:(0,d.cn)("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t&&"pl-8",e),...s}));ec.displayName=er.ck.displayName;let eu=l.forwardRef(({className:e,children:t,checked:s,...a},l)=>(0,r.jsxs)(er.oC,{ref:l,className:(0,d.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),checked:s,...a,children:[r.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:r.jsx(er.wU,{children:r.jsx(R.Z,{className:"h-4 w-4"})})}),t]}));eu.displayName=er.oC.displayName;let em=l.forwardRef(({className:e,children:t,...s},a)=>(0,r.jsxs)(er.Rk,{ref:a,className:(0,d.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),...s,children:[r.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:r.jsx(er.wU,{children:r.jsx(P.Z,{className:"h-2 w-2 fill-current"})})}),t]}));em.displayName=er.Rk.displayName;let ex=l.forwardRef(({className:e,inset:t,...s},a)=>r.jsx(er.__,{ref:a,className:(0,d.cn)("px-2 py-1.5 text-sm font-semibold text-foreground",t&&"pl-8",e),...s}));ex.displayName=er.__.displayName;let ef=l.forwardRef(({className:e,...t},s)=>r.jsx(er.Z0,{ref:s,className:(0,d.cn)("-mx-1 my-1 h-px bg-border",e),...t}));ef.displayName=er.Z0.displayName;let context_menu_wrapper=({children:e,src:t})=>{let s=(0,l.useCallback)(e=>{fetch(e,{method:"GET",headers:{}}).then(e=>{e.arrayBuffer().then(function(e){let t=window.URL.createObjectURL(new Blob([e])),s=document.createElement("a");s.href=t,s.download="image.png",s.click(),s.remove()})}).catch(e=>{console.log(e)})},[]);return(0,r.jsxs)(el,{children:[r.jsx(en,{children:e}),(0,r.jsxs)(ed,{children:[r.jsx(ec,{children:r.jsx("button",{onClick:()=>s(t),children:"Download"})}),r.jsx(ec,{children:"Properties"})]})]})};var eh=s(97389);let ep=(0,eh.j)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function Badge({className:e,variant:t,...s}){return r.jsx("div",{className:(0,d.cn)(ep({variant:t}),e),...s})}let DateBadge=({time:e})=>e?r.jsx(Badge,{variant:"outline",className:"w-fit self-center rounded-2xl text-[10px] text-accent_1 font-medium px-3 outline-on_white_gray_2 outline outline-[1px] py-2 my-2",children:E()(e).calendar(null,{sameDay:"[Today]",lastDay:"[Yesterday]",lastWeek:"dddd",sameElse:"D MMMM, YYYY"})}):null,MessageItem=({msg:e,session:t})=>{let s=t?.user?.sub===e?.sender?._id;return(0,r.jsxs)(r.Fragment,{children:[e?.isNewDay&&r.jsx(DateBadge,{time:e?.updatedAt}),(0,r.jsxs)("div",{id:`message-${e?._id}`,className:`flex flex-col items-start  max-w-[80%] gap-1 relative ${s?"self-end items-end":"self-start items-start"}`,children:[e?.document&&r.jsx(context_menu_wrapper,{src:e?.document,children:r.jsx(C(),{src:e?.document,width:200,height:200,className:"w-[200px] h-[200px] aspect-square object-cover rounded-xl cursor-pointer shadow-sm",alt:"msg"})}),e?.content&&r.jsx("div",{"data-sender":s?"self":"other",className:`w-fit ${s?"text-white bg-orange   ":"self-start items-start  text-message bg-on_white_gray_2"} flex flex-col text-sm font-medium rounded-sm py-2 px-4 break-all`,children:r.jsx("p",{children:e?.content})}),(0,r.jsxs)("div",{className:"flex items-center space-x-2 mt-[2px] text-[10px]",children:[r.jsx("time",{className:" text-on_white_gray font-semibold ",children:E()(e?.updatedAt).format("HH:mm A")}),s&&r.jsx("p",{className:"text-black text-sm font-medium",children:e?.status==="sent"?r.jsx(R.Z,{className:"w-3 h-3 text-accent_1"}):r.jsx(ea.Z,{className:"w-3 h-3 text-accent_1"})})]})]})]})},GroupedMessages=({messages:e,session:t})=>{let s=[],a=[],l=null;if(e.length<=0)return null;for(let t=0;t<e.length;t++){let r=e[t],n=e[t-1];n&&n.sender._id===r.sender._id&&E()(n.updatedAt).isSame(r.updatedAt,"day")?a.push(r):(a.length>0&&s.push(a),a=[r]),l&&E()(r.updatedAt).isSame(l,"day")||(l=E()(r.updatedAt),r.isNewDay=!0)}return a.length>0&&s.push(a),r.jsx(r.Fragment,{children:s.map((e,s)=>{let a=t?.user?.sub!==e[0].sender._id,l=e[0].sender;return(0,r.jsxs)("div",{className:(0,d.cn)("flex flex-col w-full gap-3 relative",{"pl-11":a}),children:[e.map((e,s)=>r.jsx(MessageItem,{msg:e,session:t},e._id|s)),a&&r.jsx("div",{className:"absolute w-8 h-8 bottom-5 left-0 shadow-sm transition-all duration-150 animate-in",children:r.jsx(C(),{fill:!0,src:l?.avatar,alt:"user-profile",className:"object-cover rounded-full"})})]},s)})})};var eg=s(66045),ej=s(26252),eb=s(81057);let ew=(0,l.memo)(({session:e,filePreview:t,clearFile:s,sendMsg:a,fileSendProgress:n})=>{let{socket:i}=(0,M.useSocket)(),{messages:o,loading:d,updateSeen:c}=(0,v.useChat)(),[u,m]=(0,l.useState)(!1),[x]=(0,l.useState)(!1),f=es(u,500),h=(0,l.useRef)(null),scrollToBottom=()=>{h.current&&(h.current.scrollTop=h.current.scrollHeight)};return(0,l.useEffect)(()=>{scrollToBottom()},[o]),(0,l.useEffect)(()=>(i&&(i.on(Q,e=>{m(e.isTyping)}),i.on("SEEN_MESSAGE_UPDATE",({updatedMsg:e})=>{e&&c(e)})),()=>{i?.off(Q),i?.off("SEEN_MESSAGE_UPDATE")}),[i,o,c]),(0,r.jsxs)("div",{className:"relative grow w-full flex flex-col items-start rounded-xl shadow-md h-full max-h-[350px] md:max-h-[570px] bg-primary p-6",children:[r.jsx("div",{style:{scrollBehavior:"smooth"},className:"w-full grow flex flex-col gap-4 overflow-y-scroll overflow-x-hidden px-2  py-1 relative",ref:h,children:d?r.jsx("div",{className:"absolute w-5 h-5 md:w-8 md:h-8 top-1/2 -translate-x-1/2 left-1/2 -translate-y-1/2",children:r.jsx(eg.Z,{className:"w-full h-full animate-spin text-orange"})}):r.jsx(GroupedMessages,{messages:o,session:e})}),x&&r.jsx(p.z,{size:"sm",variant:"ghost",children:r.jsx(ej.Z,{className:"w-4 h-4"})}),t&&(0,r.jsxs)("div",{className:"absolute bottom-2 left-4 z-20 ",children:[r.jsx(C(),{src:t,width:250,height:250,className:"object-cover relative aspect-square",alt:"selected image"}),0!==n&&r.jsx("div",{className:"z-50 absolute top-1/2 outline  outline-black -translate-x-1/2 left-1/2  -translate-y-1/2 w-40 h-[6px] rounded overflow-hidden",children:r.jsx("div",{className:"h-full bg-black transition-all duration-200",style:{width:`${n}`}})}),r.jsx("button",{className:"absolute top-2 left-2",onClick:s,children:r.jsx("div",{className:"text-white bg-black p-2 rounded-full",children:r.jsx(eb.Z,{})})}),r.jsx("button",{className:"absolute bottom-1 -right-12",onClick:a,children:r.jsx("div",{className:"text-white bg-black p-2 rounded-sm",children:r.jsx($.Z,{})})})]}),f&&r.jsx(typing_status,{})]})}),hooks_useTabActive=()=>{let[e,t]=(0,l.useState)("undefined"==typeof document?"visible":document.visibilityState),[s,a]=(0,l.useState)("undefined"==typeof document||document.hasFocus());return(0,l.useEffect)(()=>{let handleVisibilityChange=()=>{t(document.visibilityState)},handleBrowserVisibilityChange=()=>{a(document.hasFocus())};return document.addEventListener("visibilitychange",handleVisibilityChange),void 0!==window&&(window.addEventListener("focus",handleBrowserVisibilityChange),window.addEventListener("blur",handleBrowserVisibilityChange)),()=>{document.removeEventListener("visibilitychange",handleVisibilityChange),window.removeEventListener("focus",handleBrowserVisibilityChange),window.removeEventListener("blur",handleBrowserVisibilityChange)}},[]),"visible"===e&&s||"visible"===e},chat_ChatContainer=()=>{let[e,t]=(0,l.useState)(""),[s,i]=(0,l.useState)(!1),[o,d]=(0,l.useState)(!1),[c,u]=(0,l.useState)(null),[m,x]=(0,l.useState)(null),[f,h]=(0,l.useState)(0),{currentChat:p,setMessages:g,messages:j,resetUnreadCount:b,updateSeen:w}=(0,v.useChat)(),{socket:y}=(0,M.useSocket)(),{data:N}=(0,n.useSession)(),{edgestore:_}=(0,W.useEdgeStore)(),C=hooks_useTabActive(),sendingMediaMessage=async()=>{if(c){let e=await _.publicFiles.upload({file:c,onProgressChange:e=>{h(e)}});return e.url}},sendMessage=async()=>{if(!e&&!c)return;y.emit(Q,{chat:p,isTyping:!1}),i(!0);let s=N?.user?.sub,a=Object.entries(p).filter(([e,t])=>"_id"===e&&t!==s).map(([e,t])=>t);try{let r={chatId:p?._id,users:{senderId:s,receiverId:a[0]},content:e,status:"pending"};if(c){let e=await sendingMediaMessage();r.fileContent=e}let l=await new Promise((e,t)=>{y.timeout(3e4).emit("SEND_MESSAGE",r,(s,a)=>{s?t(s):e(a)})});g([...j,l]),t("")}catch(e){console.log(e)}finally{u(null),x(null),h(0),i(!1)}},S=(0,l.useMemo)(()=>j,[j]),k=(0,l.useCallback)(e=>{u(e.target.files[0]);let t=URL.createObjectURL(e.target.files[0]);x(t)},[]);return(0,l.useEffect)(()=>{let e=new IntersectionObserver(e=>{e.forEach(e=>{let t="true"===e.target.getAttribute("data-isSender");if(e.isIntersecting&&!t){let t=e.target.getAttribute("id").split("-")[1];y.emit("SEEN_MESSAGE",{messageId:t,chatId:p?._id}),p?.unread>0&&b(p?._id),w({_id:t})}})},{threshold:.5});return S.forEach(t=>{if("seen"===t.status)return;let s=document.getElementById(`message-${t._id}`);s&&C&&(s.setAttribute("data-isSender",t.sender._id===N?.user?.sub),e.observe(s))}),()=>{e.disconnect(),y?.off("SEEN_MESSAGE")}},[S,C,y,p,b,N?.user?.sub,w]),(0,l.useEffect)(()=>{if(y)return y.on(X,e=>{e.chat===p?._id&&g([...j,e])}),()=>{y?.off(X)}},[y,p,j,g]),r.jsx("div",{className:"w-full min-w-[342px] h-full self-stretch flex flex-col items-start gap-2  ",children:r.jsx(r.Fragment,{children:p?(0,r.jsxs)(r.Fragment,{children:[r.jsx(chat_ChatHeader,{selectedChat:p,currUserEmail:N?.user.email}),r.jsx(ew,{session:N,filePreview:m,clearFile:()=>{u(null),x(null)},sendMsg:sendMessage,fileSendProgress:f}),r.jsx(components_MessageInput,{value:e,onChange:(e,s=!1,r)=>{s?t(e=>e+r):t(e.target.value),o||(d(!0),y.emit(Q,{chat:p,isTyping:!0})),clearTimeout(a),a=setTimeout(()=>{d(!1),y.emit(Q,{chat:p,isTyping:!1})},800)},onSubmit:sendMessage,loading:s,onFileChange:k})]}):r.jsx("div",{className:"w-full self-stretch grow bg-primary shadow-xl rounded-md flex items-center justify-center ",children:"Select a chat to talk to"})})})},chat_page_client=()=>{let[e,t]=(0,l.useState)(!1),[s,a]=(0,l.useState)(!1),[i,o]=(0,l.useState)({from:null,offer:null}),{data:d}=(0,n.useSession)(),{socket:c}=(0,M.useSocket)();return(0,r.jsxs)(r.Fragment,{children:[r.jsx(contact_Contacts,{}),r.jsx(chat_ChatContainer,{})]})}},48717:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>c});var a=s(4656),r=s(95153);let l=(0,r.createProxy)(String.raw`/Users/quangnhat/Documents/Chatapp-Kathie/components/chat-page-client.jsx`),{__esModule:n,$$typeof:i}=l,o=l.default;var d=s(3542);let ChatPage=async()=>a.jsx(a.Fragment,{children:a.jsx("div",{className:"w-full h-full self-stretch items-start flex flex-col md:flex-row gap-4  md:gap-2",children:a.jsx(d.Suspense,{className:a.jsx("p",{children:"Loading..."}),children:a.jsx(o,{})})})}),c=ChatPage}};var t=require("../../../webpack-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),s=t.X(0,[657,762,778,245,325,315,488,555,456],()=>__webpack_exec__(37717));module.exports=s})();