"use strict";exports.id=635,exports.ids=[635],exports.modules={16132:(e,t)=>{var r;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return r}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(r||(r={}))},10884:(e,t,r)=>{e.exports=r(30517)},4356:(e,t,r)=>{let a,n,s;r.d(t,{o:()=>createEdgeStoreNextHandler});var i=r(45104);function _define_property(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}let o=["debug","info","warn","error","none"];let Logger=class Logger{shouldLog(e){return o.indexOf(e)>=o.indexOf(this.logLevel)}debug(e,...t){this.shouldLog("debug")&&console.debug("[EdgeStoreDebug]",e,...t)}info(e,...t){this.shouldLog("info")&&console.info("[EdgeStoreInfo]",e,...t)}warn(e,...t){this.shouldLog("warn")&&console.warn("[EdgeStoreWarn]",e,...t)}error(e,...t){this.shouldLog("error")&&console.error("[EdgeStoreError]",e,...t)}constructor(e){_define_property(this,"logLevel",void 0),this.logLevel=e??"error"}};let d=`Missing EDGE_STORE_ACCESS_KEY or EDGE_STORE_SECRET_KEY. 
This can happen if you are trying to import something related to the backend of Edge Store in a client component.`;let EdgeStoreCredentialsError=class EdgeStoreCredentialsError extends Error{constructor(e=d){super(e),this.name="EdgeStoreCredentialsError"}};let c=process.env.EDGE_STORE_API_ENDPOINT??"https://api.edgestore.dev";async function makeRequest(e){let{body:t,accessKey:r,secretKey:a,path:n}=e,s=await fetch(`${c}${n}`,{method:"POST",body:JSON.stringify(t),headers:{"Content-Type":"application/json",Authorization:`Basic ${Buffer.from(`${r}:${a}`).toString("base64")}`}});if(!s.ok)throw Error(`Failed to make request to ${n}: ${await s.text()}`);return await s.json()}let l={async getToken(e){let t=Object.entries(e.router.buckets).reduce((e,[t,r])=>(e[t]={path:r._def.path.map(e=>{let t=Object.entries(e);if(void 0===t[0])throw new i.f9({message:`Empty path param found in: ${JSON.stringify(r._def.path)}`,code:"SERVER_ERROR"});let[a,n]=t[0];return{key:a,value:n()}}),accessControl:r._def.accessControl},e),{}),{token:r}=await makeRequest({body:{ctx:e.ctx,buckets:t},accessKey:e.accessKey,secretKey:e.secretKey,path:"/get-token"});return r},getFile:async({accessKey:e,secretKey:t,url:r})=>await makeRequest({path:"/get-file",accessKey:e,secretKey:t,body:{url:r}}),async requestUpload({accessKey:e,secretKey:t,bucketName:r,bucketType:a,fileInfo:n,multipart:s}){let i=await makeRequest({path:"/request-upload",accessKey:e,secretKey:t,body:{multipart:s,bucketName:r,bucketType:a,isPublic:n.isPublic,path:n.path,extension:n.extension,size:n.size,mimeType:n.type,metadata:n.metadata,fileName:n.fileName,replaceTargetUrl:n.replaceTargetUrl,isTemporary:n.temporary}});return{multipart:i.multipart,signedUrl:i.signedUrl,accessUrl:i.url,path:i.path,thumbnailUrl:i.thumbnailUrl}},async requestUploadParts({accessKey:e,secretKey:t,key:r,multipart:a}){let n=await makeRequest({path:"/request-upload-parts",accessKey:e,secretKey:t,body:{multipart:a,key:r}});return{multipart:n.multipart}},completeMultipartUpload:async({accessKey:e,secretKey:t,uploadId:r,key:a,parts:n})=>await makeRequest({path:"/complete-multipart-upload",accessKey:e,secretKey:t,body:{uploadId:r,key:a,parts:n}}),confirmUpload:async({accessKey:e,secretKey:t,url:r})=>await makeRequest({path:"/confirm-upload",accessKey:e,secretKey:t,body:{url:r}}),deleteFile:async({accessKey:e,secretKey:t,url:r})=>await makeRequest({path:"/delete-file",accessKey:e,secretKey:t,body:{url:r}}),listFiles:async({accessKey:e,secretKey:t,bucketName:r,filter:a,pagination:n})=>await makeRequest({path:"/list-files",accessKey:e,secretKey:t,body:{bucketName:r,filter:a,pagination:n}})};function initEdgeStoreSdk(e){let{accessKey:t=process.env.EDGE_STORE_ACCESS_KEY,secretKey:r=process.env.EDGE_STORE_SECRET_KEY}=e??{};if(!t||!r)throw new EdgeStoreCredentialsError;return{getToken:async e=>await l.getToken({accessKey:t,secretKey:r,ctx:e.ctx,router:e.router}),getFile:async({url:e})=>await l.getFile({accessKey:t,secretKey:r,url:e}),requestUpload:async({bucketName:e,bucketType:a,fileInfo:n,multipart:s})=>await l.requestUpload({accessKey:t,secretKey:r,bucketName:e,bucketType:a,fileInfo:n,multipart:s}),requestUploadParts:async({key:e,multipart:a})=>await l.requestUploadParts({accessKey:t,secretKey:r,key:e,multipart:a}),completeMultipartUpload:async({uploadId:e,key:a,parts:n})=>await l.completeMultipartUpload({accessKey:t,secretKey:r,uploadId:e,key:a,parts:n}),confirmUpload:async({url:e})=>await l.confirmUpload({accessKey:t,secretKey:r,url:e}),deleteFile:async({url:e})=>await l.deleteFile({accessKey:t,secretKey:r,url:e}),listFiles:async e=>await l.listFiles({accessKey:t,secretKey:r,...e})}}function EdgeStoreProvider(e){let{accessKey:t=process.env.EDGE_STORE_ACCESS_KEY,secretKey:r=process.env.EDGE_STORE_SECRET_KEY}=e??{},a=process.env.EDGE_STORE_BASE_URL??"https://files.edgestore.dev";if(!t||!r)throw new EdgeStoreCredentialsError;let n=initEdgeStoreSdk({accessKey:t,secretKey:r});return{init:async({ctx:e,router:t})=>{let r=await n.getToken({ctx:e,router:t});return{token:r}},getBaseUrl:()=>a,getFile:async({url:e})=>{let{uploadedAt:t,...r}=await n.getFile({url:e});return{uploadedAt:new Date(t),...r}},async requestUpload({bucketName:e,bucketType:t,fileInfo:r}){let a=5242880;if(r.size>10485760){let s=Math.ceil(r.size/a);s>1e3&&(s=1e3,a=Math.ceil(r.size/s));let o=await n.requestUpload({bucketName:e,bucketType:t,fileInfo:r,multipart:{parts:Array.from({length:s}).map((e,t)=>t+1)}}),d=o.multipart?{key:o.multipart.key,uploadId:o.multipart.uploadId,parts:o.multipart.parts.map(e=>({partNumber:e.partNumber,uploadUrl:e.signedUrl})),partSize:a,totalParts:s}:void 0;if(d)return{accessUrl:o.accessUrl,thumbnailUrl:o.thumbnailUrl,multipart:d};if(o.signedUrl)return{accessUrl:o.accessUrl,uploadUrl:o.signedUrl,thumbnailUrl:o.thumbnailUrl};throw new i.f9({message:"Could not get upload url",code:"SERVER_ERROR"})}let s=await n.requestUpload({bucketName:e,bucketType:t,fileInfo:r});if(s.signedUrl)return{accessUrl:s.accessUrl,uploadUrl:s.signedUrl,thumbnailUrl:s.thumbnailUrl};throw new i.f9({message:"Could not get upload url",code:"SERVER_ERROR"})},requestUploadParts:async({multipart:e,path:t})=>{let r=await n.requestUploadParts({multipart:e,key:t});return{multipart:{uploadId:r.multipart.uploadId,parts:r.multipart.parts.map(e=>({partNumber:e.partNumber,uploadUrl:e.signedUrl}))}}},completeMultipartUpload:async({uploadId:e,key:t,parts:r})=>await n.completeMultipartUpload({uploadId:e,key:t,parts:r}),confirmUpload:async({url:e})=>await n.confirmUpload({url:e}),deleteFile:async({url:e})=>await n.deleteFile({url:e})}}var u=r(6113),p=r.n(u);let fallback=(e,t,r,a,n)=>{let s=parseInt(e.substr(3),10)>>3||20,i=(0,u.createHmac)(e,r.byteLength?r:new Uint8Array(s)).update(t).digest(),o=Math.ceil(n/s),d=new Uint8Array(s*o+a.byteLength+1),c=0,l=0;for(let t=1;t<=o;t++)d.set(a,l),d[l+a.byteLength]=t,d.set((0,u.createHmac)(e,i).update(d.subarray(c,l+a.byteLength+1)).digest(),l),c=l,l+=s;return d.slice(0,n)};"function"!=typeof u.hkdf||process.versions.electron||(a=async(...e)=>new Promise((t,r)=>{u.hkdf(...e,(e,a)=>{e?r(e):t(new Uint8Array(a))})}));let runtime_hkdf=async(e,t,r,n,s)=>(a||fallback)(e,t,r,n,s);function normalizeDigest(e){switch(e){case"sha256":case"sha384":case"sha512":case"sha1":return e;default:throw TypeError('unsupported "digest" value')}}function normalizeUint8Array(e,t){if("string"==typeof e)return new TextEncoder().encode(e);if(!(e instanceof Uint8Array))throw TypeError(`"${t}"" must be an instance of Uint8Array or a string`);return e}function normalizeIkm(e){let t=normalizeUint8Array(e,"ikm");if(!t.byteLength)throw TypeError('"ikm" must be at least one byte in length');return t}function normalizeInfo(e){let t=normalizeUint8Array(e,"info");if(t.byteLength>1024)throw TypeError('"info" must not contain more than 1024 bytes');return t}function normalizeKeylen(e,t){if("number"!=typeof e||!Number.isInteger(e)||e<1)throw TypeError('"keylen" must be a positive integer');let r=parseInt(t.substr(3),10)>>3||20;if(e>255*r)throw TypeError('"keylen" too large');return e}async function esm_hkdf(e,t,r,a,n){return runtime_hkdf(normalizeDigest(e),normalizeIkm(t),normalizeUint8Array(r,"salt"),normalizeInfo(a),normalizeKeylen(n,e))}var h=r(95011),f=r(14300);let runtime_digest=(e,t)=>(0,u.createHash)(e).update(t).digest(),m=new TextEncoder,y=new TextDecoder;function buffer_utils_concat(...e){let t=e.reduce((e,{length:t})=>e+t,0),r=new Uint8Array(t),a=0;return e.forEach(e=>{r.set(e,a),a+=e.length}),r}function buffer_utils_p2s(e,t){return buffer_utils_concat(m.encode(e),new Uint8Array([0]),t)}function writeUInt32BE(e,t,r){if(t<0||t>=4294967296)throw RangeError(`value must be >= 0 and <= ${4294967296-1}. Received ${t}`);e.set([t>>>24,t>>>16,t>>>8,255&t],r)}function uint64be(e){let t=new Uint8Array(8);return writeUInt32BE(t,Math.floor(e/4294967296),0),writeUInt32BE(t,e%4294967296,4),t}function uint32be(e){let t=new Uint8Array(4);return writeUInt32BE(t,e),t}function lengthAndInput(e){return buffer_utils_concat(uint32be(e.length),e)}async function concatKdf(e,t,r){let a=Math.ceil((t>>3)/32),n=new Uint8Array(32*a);for(let t=0;t<a;t++){let a=new Uint8Array(4+e.length+r.length);a.set(uint32be(t+1)),a.set(e,4),a.set(r,4+e.length),n.set(await runtime_digest("sha256",a),32*t)}return n.slice(0,t>>3)}function normalize(e){let t=e;return t instanceof Uint8Array&&(t=y.decode(t)),t}n=f.Buffer.isEncoding("base64url")?e=>f.Buffer.from(e).toString("base64url"):e=>f.Buffer.from(e).toString("base64").replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_");let decode=e=>f.Buffer.from(normalize(e),"base64");let errors_JOSEError=class errors_JOSEError extends Error{static get code(){return"ERR_JOSE_GENERIC"}constructor(e){var t;super(e),this.code="ERR_JOSE_GENERIC",this.name=this.constructor.name,null===(t=Error.captureStackTrace)||void 0===t||t.call(Error,this,this.constructor)}};let JWTClaimValidationFailed=class JWTClaimValidationFailed extends errors_JOSEError{static get code(){return"ERR_JWT_CLAIM_VALIDATION_FAILED"}constructor(e,t="unspecified",r="unspecified"){super(e),this.code="ERR_JWT_CLAIM_VALIDATION_FAILED",this.claim=t,this.reason=r}};let JWTExpired=class JWTExpired extends errors_JOSEError{static get code(){return"ERR_JWT_EXPIRED"}constructor(e,t="unspecified",r="unspecified"){super(e),this.code="ERR_JWT_EXPIRED",this.claim=t,this.reason=r}};let errors_JOSEAlgNotAllowed=class errors_JOSEAlgNotAllowed extends errors_JOSEError{constructor(){super(...arguments),this.code="ERR_JOSE_ALG_NOT_ALLOWED"}static get code(){return"ERR_JOSE_ALG_NOT_ALLOWED"}};let errors_JOSENotSupported=class errors_JOSENotSupported extends errors_JOSEError{constructor(){super(...arguments),this.code="ERR_JOSE_NOT_SUPPORTED"}static get code(){return"ERR_JOSE_NOT_SUPPORTED"}};let errors_JWEDecryptionFailed=class errors_JWEDecryptionFailed extends errors_JOSEError{constructor(){super(...arguments),this.code="ERR_JWE_DECRYPTION_FAILED",this.message="decryption operation failed"}static get code(){return"ERR_JWE_DECRYPTION_FAILED"}};let errors_JWEInvalid=class errors_JWEInvalid extends errors_JOSEError{constructor(){super(...arguments),this.code="ERR_JWE_INVALID"}static get code(){return"ERR_JWE_INVALID"}};let errors_JWTInvalid=class errors_JWTInvalid extends errors_JOSEError{constructor(){super(...arguments),this.code="ERR_JWT_INVALID"}static get code(){return"ERR_JWT_INVALID"}};function bitLength(e){switch(e){case"A128GCM":case"A128GCMKW":case"A192GCM":case"A192GCMKW":case"A256GCM":case"A256GCMKW":return 96;case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":return 128;default:throw new errors_JOSENotSupported(`Unsupported JWE Algorithm: ${e}`)}}Symbol.asyncIterator;let lib_iv=e=>(0,u.randomFillSync)(new Uint8Array(bitLength(e)>>3)),check_iv_length=(e,t)=>{if(t.length<<3!==bitLength(e))throw new errors_JWEInvalid("Invalid Initialization Vector length")};var g=r(73837);let _=g.types.isKeyObject?e=>g.types.isKeyObject(e):e=>null!=e&&e instanceof u.KeyObject,check_cek_length=(e,t)=>{let r;switch(e){case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":r=parseInt(e.slice(-3),10);break;case"A128GCM":case"A192GCM":case"A256GCM":r=parseInt(e.slice(1,4),10);break;default:throw new errors_JOSENotSupported(`Content Encryption Algorithm ${e} is not supported either by JOSE or your javascript runtime`)}if(t instanceof Uint8Array){let e=t.byteLength<<3;if(e!==r)throw new errors_JWEInvalid(`Invalid Content Encryption Key length. Expected ${r} bits, got ${e} bits`);return}if(_(t)&&"secret"===t.type){let e=t.symmetricKeySize<<3;if(e!==r)throw new errors_JWEInvalid(`Invalid Content Encryption Key length. Expected ${r} bits, got ${e} bits`);return}throw TypeError("Invalid Content Encryption Key type")},v=u.timingSafeEqual;function cbcTag(e,t,r,a,n,s){let i=buffer_utils_concat(e,t,r,uint64be(e.length<<3)),o=(0,u.createHmac)(`sha${a}`,n);return o.update(i),o.digest().slice(0,s>>3)}let E=u.webcrypto,w=g.types.isCryptoKey?e=>g.types.isCryptoKey(e):e=>!1;function unusable(e,t="algorithm.name"){return TypeError(`CryptoKey does not support this operation, its ${t} must be ${e}`)}function isAlgorithm(e,t){return e.name===t}function getHashLength(e){return parseInt(e.name.slice(4),10)}function checkUsage(e,t){if(t.length&&!t.some(t=>e.usages.includes(t))){let e="CryptoKey does not support this operation, its usages must include ";if(t.length>2){let r=t.pop();e+=`one of ${t.join(", ")}, or ${r}.`}else 2===t.length?e+=`one of ${t[0]} or ${t[1]}.`:e+=`${t[0]}.`;throw TypeError(e)}}function checkEncCryptoKey(e,t,...r){switch(t){case"A128GCM":case"A192GCM":case"A256GCM":{if(!isAlgorithm(e.algorithm,"AES-GCM"))throw unusable("AES-GCM");let r=parseInt(t.slice(1,4),10),a=e.algorithm.length;if(a!==r)throw unusable(r,"algorithm.length");break}case"A128KW":case"A192KW":case"A256KW":{if(!isAlgorithm(e.algorithm,"AES-KW"))throw unusable("AES-KW");let r=parseInt(t.slice(1,4),10),a=e.algorithm.length;if(a!==r)throw unusable(r,"algorithm.length");break}case"ECDH":switch(e.algorithm.name){case"ECDH":case"X25519":case"X448":break;default:throw unusable("ECDH, X25519, or X448")}break;case"PBES2-HS256+A128KW":case"PBES2-HS384+A192KW":case"PBES2-HS512+A256KW":if(!isAlgorithm(e.algorithm,"PBKDF2"))throw unusable("PBKDF2");break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":{if(!isAlgorithm(e.algorithm,"RSA-OAEP"))throw unusable("RSA-OAEP");let r=parseInt(t.slice(9),10)||1,a=getHashLength(e.algorithm.hash);if(a!==r)throw unusable(`SHA-${r}`,"algorithm.hash");break}default:throw TypeError("CryptoKey does not support this operation")}checkUsage(e,r)}function message(e,t,...r){if(r.length>2){let t=r.pop();e+=`one of type ${r.join(", ")}, or ${t}.`}else 2===r.length?e+=`one of type ${r[0]} or ${r[1]}.`:e+=`of type ${r[0]}.`;return null==t?e+=` Received ${t}`:"function"==typeof t&&t.name?e+=` Received function ${t.name}`:"object"==typeof t&&null!=t&&t.constructor&&t.constructor.name&&(e+=` Received an instance of ${t.constructor.name}`),e}let invalid_key_input=(e,...t)=>message("Key must be ",e,...t);function withAlg(e,t,...r){return message(`Key for the ${e} algorithm must be `,t,...r)}let runtime_ciphers=e=>(s||(s=new Set((0,u.getCiphers)())),s.has(e)),is_key_like=e=>_(e)||w(e),b=["KeyObject"];function cbcDecrypt(e,t,r,a,n,s){let i,o;let d=parseInt(e.slice(1,4),10);_(t)&&(t=t.export());let c=t.subarray(d>>3),l=t.subarray(0,d>>3),p=parseInt(e.slice(-3),10),h=`aes-${d}-cbc`;if(!runtime_ciphers(h))throw new errors_JOSENotSupported(`alg ${e} is not supported by your javascript runtime`);let f=cbcTag(s,a,r,p,l,d);try{i=v(n,f)}catch{}if(!i)throw new errors_JWEDecryptionFailed;try{let e=(0,u.createDecipheriv)(h,c,a);o=buffer_utils_concat(e.update(r),e.final())}catch{}if(!o)throw new errors_JWEDecryptionFailed;return o}function gcmDecrypt(e,t,r,a,n,s){let i=parseInt(e.slice(1,4),10),o=`aes-${i}-gcm`;if(!runtime_ciphers(o))throw new errors_JOSENotSupported(`alg ${e} is not supported by your javascript runtime`);try{let e=(0,u.createDecipheriv)(o,t,a,{authTagLength:16});e.setAuthTag(n),s.byteLength&&e.setAAD(s,{plaintextLength:r.length});let i=e.update(r);return e.final(),i}catch{throw new errors_JWEDecryptionFailed}}(globalThis.CryptoKey||(null==E?void 0:E.CryptoKey))&&b.push("CryptoKey");let runtime_decrypt=(e,t,r,a,n,s)=>{let i;if(w(t))checkEncCryptoKey(t,e,"decrypt"),i=u.KeyObject.from(t);else if(t instanceof Uint8Array||_(t))i=t;else throw TypeError(invalid_key_input(t,...b,"Uint8Array"));switch(check_cek_length(e,i),check_iv_length(e,a),e){case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":return cbcDecrypt(e,i,r,a,n,s);case"A128GCM":case"A192GCM":case"A256GCM":return gcmDecrypt(e,i,r,a,n,s);default:throw new errors_JOSENotSupported("Unsupported JWE Content Encryption Algorithm")}};var k=r(59796);let T=(0,g.promisify)(k.inflateRaw),S=(0,g.promisify)(k.deflateRaw),inflate=e=>T(e),deflate=e=>S(e),is_disjoint=(...e)=>{let t;let r=e.filter(Boolean);if(0===r.length||1===r.length)return!0;for(let e of r){let r=Object.keys(e);if(!t||0===t.size){t=new Set(r);continue}for(let e of r){if(t.has(e))return!1;t.add(e)}}return!0};function isObjectLike(e){return"object"==typeof e&&null!==e}function is_object_isObject(e){if(!isObjectLike(e)||"[object Object]"!==Object.prototype.toString.call(e))return!1;if(null===Object.getPrototypeOf(e))return!0;let t=e;for(;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}function checkKeySize(e,t){if(e.symmetricKeySize<<3!==parseInt(t.slice(1,4),10))throw TypeError(`Invalid key size for alg: ${t}`)}function ensureKeyObject(e,t,r){if(_(e))return e;if(e instanceof Uint8Array)return(0,u.createSecretKey)(e);if(w(e))return checkEncCryptoKey(e,t,r),u.KeyObject.from(e);throw TypeError(invalid_key_input(e,...b,"Uint8Array"))}let wrap=(e,t,r)=>{let a=parseInt(e.slice(1,4),10),n=`aes${a}-wrap`;if(!runtime_ciphers(n))throw new errors_JOSENotSupported(`alg ${e} is not supported either by JOSE or your javascript runtime`);let s=ensureKeyObject(t,e,"wrapKey");checkKeySize(s,e);let i=(0,u.createCipheriv)(n,s,f.Buffer.alloc(8,166));return buffer_utils_concat(i.update(r),i.final())},unwrap=(e,t,r)=>{let a=parseInt(e.slice(1,4),10),n=`aes${a}-wrap`;if(!runtime_ciphers(n))throw new errors_JOSENotSupported(`alg ${e} is not supported either by JOSE or your javascript runtime`);let s=ensureKeyObject(t,e,"unwrapKey");checkKeySize(s,e);let i=(0,u.createDecipheriv)(n,s,f.Buffer.alloc(8,166));return buffer_utils_concat(i.update(r),i.final())},x=f.Buffer.from([42,134,72,206,61,3,1,7]),Z=f.Buffer.from([43,129,4,0,34]),C=f.Buffer.from([43,129,4,0,35]),A=f.Buffer.from([43,129,4,0,10]),O=new WeakMap,namedCurveToJOSE=e=>{switch(e){case"prime256v1":return"P-256";case"secp384r1":return"P-384";case"secp521r1":return"P-521";case"secp256k1":return"secp256k1";default:throw new errors_JOSENotSupported("Unsupported key curve for this operation")}},get_named_curve_getNamedCurve=(e,t)=>{var r;let a;if(w(e))a=u.KeyObject.from(e);else if(_(e))a=e;else throw TypeError(invalid_key_input(e,...b));if("secret"===a.type)throw TypeError('only "private" or "public" type keys can be used for this operation');switch(a.asymmetricKeyType){case"ed25519":case"ed448":return`Ed${a.asymmetricKeyType.slice(2)}`;case"x25519":case"x448":return`X${a.asymmetricKeyType.slice(1)}`;case"ec":{if(O.has(a))return O.get(a);let e=null===(r=a.asymmetricKeyDetails)||void 0===r?void 0:r.namedCurve;if(e||"private"!==a.type){if(!e){let t=a.export({format:"der",type:"spki"}),r=t[1]<128?14:15,n=t[r],s=t.slice(r+1,r+1+n);if(s.equals(x))e="prime256v1";else if(s.equals(Z))e="secp384r1";else if(s.equals(C))e="secp521r1";else if(s.equals(A))e="secp256k1";else throw new errors_JOSENotSupported("Unsupported key curve for this operation")}}else e=get_named_curve_getNamedCurve((0,u.createPublicKey)(a),!0);if(t)return e;let n=namedCurveToJOSE(e);return O.set(a,n),n}default:throw TypeError("Invalid asymmetric key type for this operation")}},I=(0,g.promisify)(u.generateKeyPair);async function deriveKey(e,t,r,a,n=new Uint8Array(0),s=new Uint8Array(0)){let i,o;if(w(e))checkEncCryptoKey(e,"ECDH"),i=u.KeyObject.from(e);else if(_(e))i=e;else throw TypeError(invalid_key_input(e,...b));if(w(t))checkEncCryptoKey(t,"ECDH","deriveBits"),o=u.KeyObject.from(t);else if(_(t))o=t;else throw TypeError(invalid_key_input(t,...b));let d=buffer_utils_concat(lengthAndInput(m.encode(r)),lengthAndInput(n),lengthAndInput(s),uint32be(a)),c=(0,u.diffieHellman)({privateKey:o,publicKey:i});return concatKdf(c,a,d)}async function generateEpk(e){let t;if(w(e))t=u.KeyObject.from(e);else if(_(e))t=e;else throw TypeError(invalid_key_input(e,...b));switch(t.asymmetricKeyType){case"x25519":return I("x25519");case"x448":return I("x448");case"ec":{let e=get_named_curve_getNamedCurve(t);return I("ec",{namedCurve:e})}default:throw new errors_JOSENotSupported("Invalid or unsupported EPK")}}let ecdhAllowed=e=>["P-256","P-384","P-521","X25519","X448"].includes(get_named_curve_getNamedCurve(e));function checkP2s(e){if(!(e instanceof Uint8Array)||e.length<8)throw new errors_JWEInvalid("PBES2 Salt Input must be 8 or more octets")}let P=(0,g.promisify)(u.pbkdf2);function getPassword(e,t){if(_(e))return e.export();if(e instanceof Uint8Array)return e;if(w(e))return checkEncCryptoKey(e,t,"deriveBits","deriveKey"),u.KeyObject.from(e).export();throw TypeError(invalid_key_input(e,...b,"Uint8Array"))}let encrypt=async(e,t,r,a=2048,s=(0,u.randomFillSync)(new Uint8Array(16)))=>{checkP2s(s);let i=buffer_utils_p2s(e,s),o=parseInt(e.slice(13,16),10)>>3,d=getPassword(t,e),c=await P(d,i,a,o,`sha${e.slice(8,11)}`),l=await wrap(e.slice(-6),c,r);return{encryptedKey:l,p2c:a,p2s:n(s)}},pbes2kw_decrypt=async(e,t,r,a,n)=>{checkP2s(n);let s=buffer_utils_p2s(e,n),i=parseInt(e.slice(13,16),10)>>3,o=getPassword(t,e),d=await P(o,s,a,i,`sha${e.slice(8,11)}`);return unwrap(e.slice(-6),d,r)},R=new WeakMap,getLength=(e,t)=>{let r=e.readUInt8(1);if((128&r)==0)return 0===t?r:getLength(e.subarray(2+r),t-1);let a=127&r;r=0;for(let t=0;t<a;t++){r<<=8;let a=e.readUInt8(2+t);r|=a}return 0===t?r:getLength(e.subarray(2+r),t-1)},getLengthOfSeqIndex=(e,t)=>{let r=e.readUInt8(1);return(128&r)==0?getLength(e.subarray(2),t):getLength(e.subarray(2+(127&r)),t)},getModulusLength=e=>{var t,r;if(R.has(e))return R.get(e);let a=null!==(r=null===(t=e.asymmetricKeyDetails)||void 0===t?void 0:t.modulusLength)&&void 0!==r?r:getLengthOfSeqIndex(e.export({format:"der",type:"pkcs1"}),"private"===e.type?1:0)-1<<3;return R.set(e,a),a},check_modulus_length_setModulusLength=(e,t)=>{R.set(e,t)},check_modulus_length=(e,t)=>{if(2048>getModulusLength(e))throw TypeError(`${t} requires key modulusLength to be 2048 bits or larger`)},checkKey=(e,t)=>{if("rsa"!==e.asymmetricKeyType)throw TypeError("Invalid key for this operation, its asymmetricKeyType must be rsa");check_modulus_length(e,t)},resolvePadding=e=>{switch(e){case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":return u.constants.RSA_PKCS1_OAEP_PADDING;case"RSA1_5":return u.constants.RSA_PKCS1_PADDING;default:return}},resolveOaepHash=e=>{switch(e){case"RSA-OAEP":return"sha1";case"RSA-OAEP-256":return"sha256";case"RSA-OAEP-384":return"sha384";case"RSA-OAEP-512":return"sha512";default:return}};function rsaes_ensureKeyObject(e,t,...r){if(_(e))return e;if(w(e))return checkEncCryptoKey(e,t,...r),u.KeyObject.from(e);throw TypeError(invalid_key_input(e,...b))}let rsaes_encrypt=(e,t,r)=>{let a=resolvePadding(e),n=resolveOaepHash(e),s=rsaes_ensureKeyObject(t,e,"wrapKey","encrypt");return checkKey(s,e),(0,u.publicEncrypt)({key:s,oaepHash:n,padding:a},r)},rsaes_decrypt=(e,t,r)=>{let a=resolvePadding(e),n=resolveOaepHash(e),s=rsaes_ensureKeyObject(t,e,"unwrapKey","decrypt");return checkKey(s,e),(0,u.privateDecrypt)({key:s,oaepHash:n,padding:a},r)};function cek_bitLength(e){switch(e){case"A128GCM":return 128;case"A192GCM":return 192;case"A256GCM":case"A128CBC-HS256":return 256;case"A192CBC-HS384":return 384;case"A256CBC-HS512":return 512;default:throw new errors_JOSENotSupported(`Unsupported JWE Algorithm: ${e}`)}}let lib_cek=e=>(0,u.randomFillSync)(new Uint8Array(cek_bitLength(e)>>3)),N=f.Buffer.from([0]),U=f.Buffer.from([2]),J=f.Buffer.from([3]),K=f.Buffer.from([48]),D=f.Buffer.from([4]),encodeLength=e=>{if(e<128)return f.Buffer.from([e]);let t=f.Buffer.alloc(5);t.writeUInt32BE(e,1);let r=1;for(;0===t[r];)r++;return t[r-1]=128|5-r,t.slice(r-1)},W=new Map([["P-256",f.Buffer.from("06 08 2A 86 48 CE 3D 03 01 07".replace(/ /g,""),"hex")],["secp256k1",f.Buffer.from("06 05 2B 81 04 00 0A".replace(/ /g,""),"hex")],["P-384",f.Buffer.from("06 05 2B 81 04 00 22".replace(/ /g,""),"hex")],["P-521",f.Buffer.from("06 05 2B 81 04 00 23".replace(/ /g,""),"hex")],["ecPublicKey",f.Buffer.from("06 07 2A 86 48 CE 3D 02 01".replace(/ /g,""),"hex")],["X25519",f.Buffer.from("06 03 2B 65 6E".replace(/ /g,""),"hex")],["X448",f.Buffer.from("06 03 2B 65 6F".replace(/ /g,""),"hex")],["Ed25519",f.Buffer.from("06 03 2B 65 70".replace(/ /g,""),"hex")],["Ed448",f.Buffer.from("06 03 2B 65 71".replace(/ /g,""),"hex")]]);let DumbAsn1Encoder=class DumbAsn1Encoder{constructor(){this.length=0,this.elements=[]}oidFor(e){let t=W.get(e);if(!t)throw new errors_JOSENotSupported("Invalid or unsupported OID");this.elements.push(t),this.length+=t.length}zero(){this.elements.push(U,f.Buffer.from([1]),N),this.length+=3}one(){this.elements.push(U,f.Buffer.from([1]),f.Buffer.from([1])),this.length+=3}unsignedInteger(e){if(128&e[0]){let t=encodeLength(e.length+1);this.elements.push(U,t,N,e),this.length+=2+t.length+e.length}else{let t=0;for(;0===e[t]&&(128&e[t+1])==0;)t++;let r=encodeLength(e.length-t);this.elements.push(U,encodeLength(e.length-t),e.slice(t)),this.length+=1+r.length+e.length-t}}octStr(e){let t=encodeLength(e.length);this.elements.push(D,encodeLength(e.length),e),this.length+=1+t.length+e.length}bitStr(e){let t=encodeLength(e.length+1);this.elements.push(J,encodeLength(e.length+1),N,e),this.length+=1+t.length+e.length+1}add(e){this.elements.push(e),this.length+=e.length}end(e=K){let t=encodeLength(this.length);return f.Buffer.concat([e,t,...this.elements],1+t.length+this.length)}};let[j,L]=process.versions.node.split(".").map(e=>parseInt(e,10));process.versions;let M=j>=16||15===j&&L>=9,H=j>=16||15===j&&L>=12,jwk_to_key=e=>{if(H&&"oct"!==e.kty)return e.d?(0,u.createPrivateKey)({format:"jwk",key:e}):(0,u.createPublicKey)({format:"jwk",key:e});switch(e.kty){case"oct":return(0,u.createSecretKey)(decode(e.k));case"RSA":{let t=new DumbAsn1Encoder,r=void 0!==e.d,a=f.Buffer.from(e.n,"base64"),n=f.Buffer.from(e.e,"base64");r?(t.zero(),t.unsignedInteger(a),t.unsignedInteger(n),t.unsignedInteger(f.Buffer.from(e.d,"base64")),t.unsignedInteger(f.Buffer.from(e.p,"base64")),t.unsignedInteger(f.Buffer.from(e.q,"base64")),t.unsignedInteger(f.Buffer.from(e.dp,"base64")),t.unsignedInteger(f.Buffer.from(e.dq,"base64")),t.unsignedInteger(f.Buffer.from(e.qi,"base64"))):(t.unsignedInteger(a),t.unsignedInteger(n));let s=t.end(),i={key:s,format:"der",type:"pkcs1"},o=r?(0,u.createPrivateKey)(i):(0,u.createPublicKey)(i);return check_modulus_length_setModulusLength(o,a.length<<3),o}case"EC":{var t,r;let a=new DumbAsn1Encoder,n=void 0!==e.d,s=f.Buffer.concat([f.Buffer.alloc(1,4),f.Buffer.from(e.x,"base64"),f.Buffer.from(e.y,"base64")]);if(n){a.zero();let r=new DumbAsn1Encoder;r.oidFor("ecPublicKey"),r.oidFor(e.crv),a.add(r.end());let n=new DumbAsn1Encoder;n.one(),n.octStr(f.Buffer.from(e.d,"base64"));let i=new DumbAsn1Encoder;i.bitStr(s);let o=i.end(f.Buffer.from([161]));n.add(o);let d=n.end(),c=new DumbAsn1Encoder;c.add(d);let l=c.end(f.Buffer.from([4]));a.add(l);let p=a.end(),h=(0,u.createPrivateKey)({key:p,format:"der",type:"pkcs8"});return t=e.crv,O.set(h,t),h}let i=new DumbAsn1Encoder;i.oidFor("ecPublicKey"),i.oidFor(e.crv),a.add(i.end()),a.bitStr(s);let o=a.end(),d=(0,u.createPublicKey)({key:o,format:"der",type:"spki"});return r=e.crv,O.set(d,r),d}case"OKP":{let t=new DumbAsn1Encoder,r=void 0!==e.d;if(r){t.zero();let r=new DumbAsn1Encoder;r.oidFor(e.crv),t.add(r.end());let a=new DumbAsn1Encoder;a.octStr(f.Buffer.from(e.d,"base64"));let n=a.end(f.Buffer.from([4]));t.add(n);let s=t.end();return(0,u.createPrivateKey)({key:s,format:"der",type:"pkcs8"})}let a=new DumbAsn1Encoder;a.oidFor(e.crv),t.add(a.end()),t.bitStr(f.Buffer.from(e.x,"base64"));let n=t.end();return(0,u.createPublicKey)({key:n,format:"der",type:"spki"})}default:throw new errors_JOSENotSupported('Invalid or unsupported JWK "kty" (Key Type) Parameter value')}};async function import_importJWK(e,t,r){var a;if(!is_object_isObject(e))throw TypeError("JWK must be an object");switch(t||(t=e.alg),e.kty){case"oct":if("string"!=typeof e.k||!e.k)throw TypeError('missing "k" (Key Value) Parameter value');if(null!=r||(r=!0!==e.ext),r)return jwk_to_key({...e,alg:t,ext:null!==(a=e.ext)&&void 0!==a&&a});return decode(e.k);case"RSA":if(void 0!==e.oth)throw new errors_JOSENotSupported('RSA JWK "oth" (Other Primes Info) Parameter value is not supported');case"EC":case"OKP":return jwk_to_key({...e,alg:t});default:throw new errors_JOSENotSupported('Unsupported "kty" (Key Type) Parameter value')}}let symmetricTypeCheck=(e,t)=>{if(!(t instanceof Uint8Array)){if(!is_key_like(t))throw TypeError(withAlg(e,t,...b,"Uint8Array"));if("secret"!==t.type)throw TypeError(`${b.join(" or ")} instances for symmetric algorithms must be of type "secret"`)}},asymmetricTypeCheck=(e,t,r)=>{if(!is_key_like(t))throw TypeError(withAlg(e,t,...b));if("secret"===t.type)throw TypeError(`${b.join(" or ")} instances for asymmetric algorithms must not be of type "secret"`);if("sign"===r&&"public"===t.type)throw TypeError(`${b.join(" or ")} instances for asymmetric algorithm signing must be of type "private"`);if("decrypt"===r&&"public"===t.type)throw TypeError(`${b.join(" or ")} instances for asymmetric algorithm decryption must be of type "private"`);if(t.algorithm&&"verify"===r&&"private"===t.type)throw TypeError(`${b.join(" or ")} instances for asymmetric algorithm verifying must be of type "public"`);if(t.algorithm&&"encrypt"===r&&"private"===t.type)throw TypeError(`${b.join(" or ")} instances for asymmetric algorithm encryption must be of type "public"`)},check_key_type=(e,t,r)=>{let a=e.startsWith("HS")||"dir"===e||e.startsWith("PBES2")||/^A\d{3}(?:GCM)?KW$/.test(e);a?symmetricTypeCheck(e,t):asymmetricTypeCheck(e,t,r)};function cbcEncrypt(e,t,r,a,n){let s=parseInt(e.slice(1,4),10);_(r)&&(r=r.export());let i=r.subarray(s>>3),o=r.subarray(0,s>>3),d=`aes-${s}-cbc`;if(!runtime_ciphers(d))throw new errors_JOSENotSupported(`alg ${e} is not supported by your javascript runtime`);let c=(0,u.createCipheriv)(d,i,a),l=buffer_utils_concat(c.update(t),c.final()),p=parseInt(e.slice(-3),10),h=cbcTag(n,a,l,p,o,s);return{ciphertext:l,tag:h}}function gcmEncrypt(e,t,r,a,n){let s=parseInt(e.slice(1,4),10),i=`aes-${s}-gcm`;if(!runtime_ciphers(i))throw new errors_JOSENotSupported(`alg ${e} is not supported by your javascript runtime`);let o=(0,u.createCipheriv)(i,r,a,{authTagLength:16});n.byteLength&&o.setAAD(n,{plaintextLength:t.length});let d=o.update(t);o.final();let c=o.getAuthTag();return{ciphertext:d,tag:c}}let runtime_encrypt=(e,t,r,a,n)=>{let s;if(w(r))checkEncCryptoKey(r,e,"encrypt"),s=u.KeyObject.from(r);else if(r instanceof Uint8Array||_(r))s=r;else throw TypeError(invalid_key_input(r,...b,"Uint8Array"));switch(check_cek_length(e,s),check_iv_length(e,a),e){case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":return cbcEncrypt(e,t,s,a,n);case"A128GCM":case"A192GCM":case"A256GCM":return gcmEncrypt(e,t,s,a,n);default:throw new errors_JOSENotSupported("Unsupported JWE Content Encryption Algorithm")}};async function aesgcmkw_wrap(e,t,r,a){let s=e.slice(0,7);a||(a=lib_iv(s));let{ciphertext:i,tag:o}=await runtime_encrypt(s,r,t,a,new Uint8Array(0));return{encryptedKey:i,iv:n(a),tag:n(o)}}async function aesgcmkw_unwrap(e,t,r,a,n){let s=e.slice(0,7);return runtime_decrypt(s,t,r,a,n,new Uint8Array(0))}async function decryptKeyManagement(e,t,r,a,n){switch(check_key_type(e,t,"decrypt"),e){case"dir":if(void 0!==r)throw new errors_JWEInvalid("Encountered unexpected JWE Encrypted Key");return t;case"ECDH-ES":if(void 0!==r)throw new errors_JWEInvalid("Encountered unexpected JWE Encrypted Key");case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":{let n,s;if(!is_object_isObject(a.epk))throw new errors_JWEInvalid('JOSE Header "epk" (Ephemeral Public Key) missing or invalid');if(!ecdhAllowed(t))throw new errors_JOSENotSupported("ECDH with the provided key is not allowed or not supported by your javascript runtime");let i=await import_importJWK(a.epk,e);if(void 0!==a.apu){if("string"!=typeof a.apu)throw new errors_JWEInvalid('JOSE Header "apu" (Agreement PartyUInfo) invalid');try{n=decode(a.apu)}catch{throw new errors_JWEInvalid("Failed to base64url decode the apu")}}if(void 0!==a.apv){if("string"!=typeof a.apv)throw new errors_JWEInvalid('JOSE Header "apv" (Agreement PartyVInfo) invalid');try{s=decode(a.apv)}catch{throw new errors_JWEInvalid("Failed to base64url decode the apv")}}let o=await deriveKey(i,t,"ECDH-ES"===e?a.enc:e,"ECDH-ES"===e?cek_bitLength(a.enc):parseInt(e.slice(-5,-2),10),n,s);if("ECDH-ES"===e)return o;if(void 0===r)throw new errors_JWEInvalid("JWE Encrypted Key missing");return unwrap(e.slice(-6),o,r)}case"RSA1_5":case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":if(void 0===r)throw new errors_JWEInvalid("JWE Encrypted Key missing");return rsaes_decrypt(e,t,r);case"PBES2-HS256+A128KW":case"PBES2-HS384+A192KW":case"PBES2-HS512+A256KW":{let s;if(void 0===r)throw new errors_JWEInvalid("JWE Encrypted Key missing");if("number"!=typeof a.p2c)throw new errors_JWEInvalid('JOSE Header "p2c" (PBES2 Count) missing or invalid');let i=(null==n?void 0:n.maxPBES2Count)||1e4;if(a.p2c>i)throw new errors_JWEInvalid('JOSE Header "p2c" (PBES2 Count) out is of acceptable bounds');if("string"!=typeof a.p2s)throw new errors_JWEInvalid('JOSE Header "p2s" (PBES2 Salt) missing or invalid');try{s=decode(a.p2s)}catch{throw new errors_JWEInvalid("Failed to base64url decode the p2s")}return pbes2kw_decrypt(e,t,r,a.p2c,s)}case"A128KW":case"A192KW":case"A256KW":if(void 0===r)throw new errors_JWEInvalid("JWE Encrypted Key missing");return unwrap(e,t,r);case"A128GCMKW":case"A192GCMKW":case"A256GCMKW":{let n,s;if(void 0===r)throw new errors_JWEInvalid("JWE Encrypted Key missing");if("string"!=typeof a.iv)throw new errors_JWEInvalid('JOSE Header "iv" (Initialization Vector) missing or invalid');if("string"!=typeof a.tag)throw new errors_JWEInvalid('JOSE Header "tag" (Authentication Tag) missing or invalid');try{n=decode(a.iv)}catch{throw new errors_JWEInvalid("Failed to base64url decode the iv")}try{s=decode(a.tag)}catch{throw new errors_JWEInvalid("Failed to base64url decode the tag")}return aesgcmkw_unwrap(e,t,r,n,s)}default:throw new errors_JOSENotSupported('Invalid or unsupported "alg" (JWE Algorithm) header value')}}let B=decryptKeyManagement;function validate_crit_validateCrit(e,t,r,a,n){let s;if(void 0!==n.crit&&void 0===a.crit)throw new e('"crit" (Critical) Header Parameter MUST be integrity protected');if(!a||void 0===a.crit)return new Set;if(!Array.isArray(a.crit)||0===a.crit.length||a.crit.some(e=>"string"!=typeof e||0===e.length))throw new e('"crit" (Critical) Header Parameter MUST be an array of non-empty strings when present');for(let i of(s=void 0!==r?new Map([...Object.entries(r),...t.entries()]):t,a.crit)){if(!s.has(i))throw new errors_JOSENotSupported(`Extension Header Parameter "${i}" is not recognized`);if(void 0===n[i])throw new e(`Extension Header Parameter "${i}" is missing`);if(s.get(i)&&void 0===a[i])throw new e(`Extension Header Parameter "${i}" MUST be integrity protected`)}return new Set(a.crit)}let $=validate_crit_validateCrit,validate_algorithms=(e,t)=>{if(void 0!==t&&(!Array.isArray(t)||t.some(e=>"string"!=typeof e)))throw TypeError(`"${e}" option must be an array of strings`);if(t)return new Set(t)};async function decrypt_flattenedDecrypt(e,t,r){var a;let n,s,i,o,d,c,l;if(!is_object_isObject(e))throw new errors_JWEInvalid("Flattened JWE must be an object");if(void 0===e.protected&&void 0===e.header&&void 0===e.unprotected)throw new errors_JWEInvalid("JOSE Header missing");if("string"!=typeof e.iv)throw new errors_JWEInvalid("JWE Initialization Vector missing or incorrect type");if("string"!=typeof e.ciphertext)throw new errors_JWEInvalid("JWE Ciphertext missing or incorrect type");if("string"!=typeof e.tag)throw new errors_JWEInvalid("JWE Authentication Tag missing or incorrect type");if(void 0!==e.protected&&"string"!=typeof e.protected)throw new errors_JWEInvalid("JWE Protected Header incorrect type");if(void 0!==e.encrypted_key&&"string"!=typeof e.encrypted_key)throw new errors_JWEInvalid("JWE Encrypted Key incorrect type");if(void 0!==e.aad&&"string"!=typeof e.aad)throw new errors_JWEInvalid("JWE AAD incorrect type");if(void 0!==e.header&&!is_object_isObject(e.header))throw new errors_JWEInvalid("JWE Shared Unprotected Header incorrect type");if(void 0!==e.unprotected&&!is_object_isObject(e.unprotected))throw new errors_JWEInvalid("JWE Per-Recipient Unprotected Header incorrect type");if(e.protected)try{let t=decode(e.protected);n=JSON.parse(y.decode(t))}catch{throw new errors_JWEInvalid("JWE Protected Header is invalid")}if(!is_disjoint(n,e.header,e.unprotected))throw new errors_JWEInvalid("JWE Protected, JWE Unprotected Header, and JWE Per-Recipient Unprotected Header Parameter names must be disjoint");let u={...n,...e.header,...e.unprotected};if($(errors_JWEInvalid,new Map,null==r?void 0:r.crit,n,u),void 0!==u.zip){if(!n||!n.zip)throw new errors_JWEInvalid('JWE "zip" (Compression Algorithm) Header MUST be integrity protected');if("DEF"!==u.zip)throw new errors_JOSENotSupported('Unsupported JWE "zip" (Compression Algorithm) Header Parameter value')}let{alg:p,enc:h}=u;if("string"!=typeof p||!p)throw new errors_JWEInvalid("missing JWE Algorithm (alg) in JWE Header");if("string"!=typeof h||!h)throw new errors_JWEInvalid("missing JWE Encryption Algorithm (enc) in JWE Header");let f=r&&validate_algorithms("keyManagementAlgorithms",r.keyManagementAlgorithms),g=r&&validate_algorithms("contentEncryptionAlgorithms",r.contentEncryptionAlgorithms);if(f&&!f.has(p))throw new errors_JOSEAlgNotAllowed('"alg" (Algorithm) Header Parameter not allowed');if(g&&!g.has(h))throw new errors_JOSEAlgNotAllowed('"enc" (Encryption Algorithm) Header Parameter not allowed');if(void 0!==e.encrypted_key)try{s=decode(e.encrypted_key)}catch{throw new errors_JWEInvalid("Failed to base64url decode the encrypted_key")}let _=!1;"function"==typeof t&&(t=await t(n,e),_=!0);try{i=await B(p,t,s,u,r)}catch(e){if(e instanceof TypeError||e instanceof errors_JWEInvalid||e instanceof errors_JOSENotSupported)throw e;i=lib_cek(h)}try{o=decode(e.iv)}catch{throw new errors_JWEInvalid("Failed to base64url decode the iv")}try{d=decode(e.tag)}catch{throw new errors_JWEInvalid("Failed to base64url decode the tag")}let v=m.encode(null!==(a=e.protected)&&void 0!==a?a:"");c=void 0!==e.aad?buffer_utils_concat(v,m.encode("."),m.encode(e.aad)):v;try{l=decode(e.ciphertext)}catch{throw new errors_JWEInvalid("Failed to base64url decode the ciphertext")}let E=await runtime_decrypt(h,i,l,o,d,c);"DEF"===u.zip&&(E=await ((null==r?void 0:r.inflateRaw)||inflate)(E));let w={plaintext:E};if(void 0!==e.protected&&(w.protectedHeader=n),void 0!==e.aad)try{w.additionalAuthenticatedData=decode(e.aad)}catch{throw new errors_JWEInvalid("Failed to base64url decode the aad")}return(void 0!==e.unprotected&&(w.sharedUnprotectedHeader=e.unprotected),void 0!==e.header&&(w.unprotectedHeader=e.header),_)?{...w,key:t}:w}async function compactDecrypt(e,t,r){if(e instanceof Uint8Array&&(e=y.decode(e)),"string"!=typeof e)throw new errors_JWEInvalid("Compact JWE must be a string or Uint8Array");let{0:a,1:n,2:s,3:i,4:o,length:d}=e.split(".");if(5!==d)throw new errors_JWEInvalid("Invalid Compact JWE");let c=await decrypt_flattenedDecrypt({ciphertext:i,iv:s||void 0,protected:a||void 0,tag:o||void 0,encrypted_key:n||void 0},t,r),l={plaintext:c.plaintext,protectedHeader:c.protectedHeader};return"function"==typeof t?{...l,key:c.key}:l}let Asn1SequenceDecoder=class Asn1SequenceDecoder{constructor(e){if(48!==e[0])throw TypeError();this.buffer=e,this.offset=1;let t=this.decodeLength();if(t!==e.length-this.offset)throw TypeError()}decodeLength(){let e=this.buffer[this.offset++];if(128&e){let t=-129&e;e=0;for(let r=0;r<t;r++)e=e<<8|this.buffer[this.offset+r];this.offset+=t}return e}unsignedInteger(){if(2!==this.buffer[this.offset++])throw TypeError();let e=this.decodeLength();0===this.buffer[this.offset]&&(this.offset++,e--);let t=this.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t}end(){if(this.offset!==this.buffer.length)throw TypeError()}};let keyToJWK=e=>{let t;if(w(e)){if(!e.extractable)throw TypeError("CryptoKey is not extractable");t=u.KeyObject.from(e)}else if(_(e))t=e;else if(e instanceof Uint8Array)return{kty:"oct",k:n(e)};else throw TypeError(invalid_key_input(e,...b,"Uint8Array"));if(M){if("secret"!==t.type&&!["rsa","ec","ed25519","x25519","ed448","x448"].includes(t.asymmetricKeyType))throw new errors_JOSENotSupported("Unsupported key asymmetricKeyType");return t.export({format:"jwk"})}switch(t.type){case"secret":return{kty:"oct",k:n(t.export())};case"private":case"public":switch(t.asymmetricKeyType){case"rsa":{let e;let r=t.export({format:"der",type:"pkcs1"}),a=new Asn1SequenceDecoder(r);"private"===t.type&&a.unsignedInteger();let s=n(a.unsignedInteger()),i=n(a.unsignedInteger());return"private"===t.type&&(e={d:n(a.unsignedInteger()),p:n(a.unsignedInteger()),q:n(a.unsignedInteger()),dp:n(a.unsignedInteger()),dq:n(a.unsignedInteger()),qi:n(a.unsignedInteger())}),a.end(),{kty:"RSA",n:s,e:i,...e}}case"ec":{let e,r,a;let s=get_named_curve_getNamedCurve(t);switch(s){case"secp256k1":e=64,r=33,a=-1;break;case"P-256":e=64,r=36,a=-1;break;case"P-384":e=96,r=35,a=-3;break;case"P-521":e=132,r=35,a=-3;break;default:throw new errors_JOSENotSupported("Unsupported curve")}if("public"===t.type){let r=t.export({type:"spki",format:"der"});return{kty:"EC",crv:s,x:n(r.subarray(-e,-e/2)),y:n(r.subarray(-e/2))}}let i=t.export({type:"pkcs8",format:"der"});return i.length<100&&(r+=a),{...keyToJWK((0,u.createPublicKey)(t)),d:n(i.subarray(r,r+e/2))}}case"ed25519":case"x25519":{let e=get_named_curve_getNamedCurve(t);if("public"===t.type){let r=t.export({type:"spki",format:"der"});return{kty:"OKP",crv:e,x:n(r.subarray(-32))}}let r=t.export({type:"pkcs8",format:"der"});return{...keyToJWK((0,u.createPublicKey)(t)),d:n(r.subarray(-32))}}case"ed448":case"x448":{let e=get_named_curve_getNamedCurve(t);if("public"===t.type){let r=t.export({type:"spki",format:"der"});return{kty:"OKP",crv:e,x:n(r.subarray("Ed448"===e?-57:-56))}}let r=t.export({type:"pkcs8",format:"der"});return{...keyToJWK((0,u.createPublicKey)(t)),d:n(r.subarray("Ed448"===e?-57:-56))}}default:throw new errors_JOSENotSupported("Unsupported key asymmetricKeyType")}default:throw new errors_JOSENotSupported("Unsupported key type")}};async function exportJWK(e){return keyToJWK(e)}async function encrypt_key_management_encryptKeyManagement(e,t,r,a,s={}){let i,o,d;switch(check_key_type(e,r,"encrypt"),e){case"dir":d=r;break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":{if(!ecdhAllowed(r))throw new errors_JOSENotSupported("ECDH with the provided key is not allowed or not supported by your javascript runtime");let{apu:c,apv:l}=s,{epk:u}=s;u||(u=(await generateEpk(r)).privateKey);let{x:p,y:h,crv:f,kty:m}=await exportJWK(u),y=await deriveKey(r,u,"ECDH-ES"===e?t:e,"ECDH-ES"===e?cek_bitLength(t):parseInt(e.slice(-5,-2),10),c,l);if(o={epk:{x:p,crv:f,kty:m}},"EC"===m&&(o.epk.y=h),c&&(o.apu=n(c)),l&&(o.apv=n(l)),"ECDH-ES"===e){d=y;break}d=a||lib_cek(t);let g=e.slice(-6);i=await wrap(g,y,d);break}case"RSA1_5":case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":d=a||lib_cek(t),i=await rsaes_encrypt(e,r,d);break;case"PBES2-HS256+A128KW":case"PBES2-HS384+A192KW":case"PBES2-HS512+A256KW":{d=a||lib_cek(t);let{p2c:n,p2s:c}=s;({encryptedKey:i,...o}=await encrypt(e,r,d,n,c));break}case"A128KW":case"A192KW":case"A256KW":d=a||lib_cek(t),i=await wrap(e,r,d);break;case"A128GCMKW":case"A192GCMKW":case"A256GCMKW":{d=a||lib_cek(t);let{iv:n}=s;({encryptedKey:i,...o}=await aesgcmkw_wrap(e,r,d,n));break}default:throw new errors_JOSENotSupported('Invalid or unsupported "alg" (JWE Algorithm) header value')}return{cek:d,encryptedKey:i,parameters:o}}let z=encrypt_key_management_encryptKeyManagement,F=Symbol();let encrypt_FlattenedEncrypt=class encrypt_FlattenedEncrypt{constructor(e){if(!(e instanceof Uint8Array))throw TypeError("plaintext must be an instance of Uint8Array");this._plaintext=e}setKeyManagementParameters(e){if(this._keyManagementParameters)throw TypeError("setKeyManagementParameters can only be called once");return this._keyManagementParameters=e,this}setProtectedHeader(e){if(this._protectedHeader)throw TypeError("setProtectedHeader can only be called once");return this._protectedHeader=e,this}setSharedUnprotectedHeader(e){if(this._sharedUnprotectedHeader)throw TypeError("setSharedUnprotectedHeader can only be called once");return this._sharedUnprotectedHeader=e,this}setUnprotectedHeader(e){if(this._unprotectedHeader)throw TypeError("setUnprotectedHeader can only be called once");return this._unprotectedHeader=e,this}setAdditionalAuthenticatedData(e){return this._aad=e,this}setContentEncryptionKey(e){if(this._cek)throw TypeError("setContentEncryptionKey can only be called once");return this._cek=e,this}setInitializationVector(e){if(this._iv)throw TypeError("setInitializationVector can only be called once");return this._iv=e,this}async encrypt(e,t){let r,a,s,i,o,d,c;if(!this._protectedHeader&&!this._unprotectedHeader&&!this._sharedUnprotectedHeader)throw new errors_JWEInvalid("either setProtectedHeader, setUnprotectedHeader, or sharedUnprotectedHeader must be called before #encrypt()");if(!is_disjoint(this._protectedHeader,this._unprotectedHeader,this._sharedUnprotectedHeader))throw new errors_JWEInvalid("JWE Protected, JWE Shared Unprotected and JWE Per-Recipient Header Parameter names must be disjoint");let l={...this._protectedHeader,...this._unprotectedHeader,...this._sharedUnprotectedHeader};if($(errors_JWEInvalid,new Map,null==t?void 0:t.crit,this._protectedHeader,l),void 0!==l.zip){if(!this._protectedHeader||!this._protectedHeader.zip)throw new errors_JWEInvalid('JWE "zip" (Compression Algorithm) Header MUST be integrity protected');if("DEF"!==l.zip)throw new errors_JOSENotSupported('Unsupported JWE "zip" (Compression Algorithm) Header Parameter value')}let{alg:u,enc:p}=l;if("string"!=typeof u||!u)throw new errors_JWEInvalid('JWE "alg" (Algorithm) Header Parameter missing or invalid');if("string"!=typeof p||!p)throw new errors_JWEInvalid('JWE "enc" (Encryption Algorithm) Header Parameter missing or invalid');if("dir"===u){if(this._cek)throw TypeError("setContentEncryptionKey cannot be called when using Direct Encryption")}else if("ECDH-ES"===u&&this._cek)throw TypeError("setContentEncryptionKey cannot be called when using Direct Key Agreement");{let n;({cek:a,encryptedKey:r,parameters:n}=await z(u,p,e,this._cek,this._keyManagementParameters)),n&&(t&&F in t?this._unprotectedHeader?this._unprotectedHeader={...this._unprotectedHeader,...n}:this.setUnprotectedHeader(n):this._protectedHeader?this._protectedHeader={...this._protectedHeader,...n}:this.setProtectedHeader(n))}if(this._iv||(this._iv=lib_iv(p)),i=this._protectedHeader?m.encode(n(JSON.stringify(this._protectedHeader))):m.encode(""),this._aad?(o=n(this._aad),s=buffer_utils_concat(i,m.encode("."),m.encode(o))):s=i,"DEF"===l.zip){let e=await ((null==t?void 0:t.deflateRaw)||deflate)(this._plaintext);({ciphertext:d,tag:c}=await runtime_encrypt(p,e,a,this._iv,s))}else({ciphertext:d,tag:c}=await runtime_encrypt(p,this._plaintext,a,this._iv,s));let h={ciphertext:n(d),iv:n(this._iv),tag:n(c)};return r&&(h.encrypted_key=n(r)),o&&(h.aad=o),this._protectedHeader&&(h.protected=y.decode(i)),this._sharedUnprotectedHeader&&(h.unprotected=this._sharedUnprotectedHeader),this._unprotectedHeader&&(h.header=this._unprotectedHeader),h}};u.constants.RSA_PKCS1_PSS_PADDING,u.constants.RSA_PSS_SALTLEN_DIGEST,u.sign.length>3?(0,g.promisify)(u.sign):u.sign,u.verify.length>4&&(j>=16||15===j&&L>=13)?(0,g.promisify)(u.verify):u.verify;let epoch=e=>Math.floor(e.getTime()/1e3),V=604800,G=31557600,q=/^(\d+|\d+\.\d+) ?(seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)$/i,secs=e=>{let t=q.exec(e);if(!t)throw TypeError("Invalid time period format");let r=parseFloat(t[1]),a=t[2].toLowerCase();switch(a){case"sec":case"secs":case"second":case"seconds":case"s":return Math.round(r);case"minute":case"minutes":case"min":case"mins":case"m":return Math.round(60*r);case"hour":case"hours":case"hr":case"hrs":case"h":return Math.round(3600*r);case"day":case"days":case"d":return Math.round(86400*r);case"week":case"weeks":case"w":return Math.round(r*V);default:return Math.round(r*G)}},normalizeTyp=e=>e.toLowerCase().replace(/^application\//,""),checkAudiencePresence=(e,t)=>"string"==typeof e?t.includes(e):!!Array.isArray(e)&&t.some(Set.prototype.has.bind(new Set(e))),jwt_claims_set=(e,t,r={})=>{let a,n;let{typ:s}=r;if(s&&("string"!=typeof e.typ||normalizeTyp(e.typ)!==normalizeTyp(s)))throw new JWTClaimValidationFailed('unexpected "typ" JWT header value',"typ","check_failed");try{a=JSON.parse(y.decode(t))}catch{}if(!is_object_isObject(a))throw new errors_JWTInvalid("JWT Claims Set must be a top-level JSON object");let{requiredClaims:i=[],issuer:o,subject:d,audience:c,maxTokenAge:l}=r;for(let e of(void 0!==l&&i.push("iat"),void 0!==c&&i.push("aud"),void 0!==d&&i.push("sub"),void 0!==o&&i.push("iss"),new Set(i.reverse())))if(!(e in a))throw new JWTClaimValidationFailed(`missing required "${e}" claim`,e,"missing");if(o&&!(Array.isArray(o)?o:[o]).includes(a.iss))throw new JWTClaimValidationFailed('unexpected "iss" claim value',"iss","check_failed");if(d&&a.sub!==d)throw new JWTClaimValidationFailed('unexpected "sub" claim value',"sub","check_failed");if(c&&!checkAudiencePresence(a.aud,"string"==typeof c?[c]:c))throw new JWTClaimValidationFailed('unexpected "aud" claim value',"aud","check_failed");switch(typeof r.clockTolerance){case"string":n=secs(r.clockTolerance);break;case"number":n=r.clockTolerance;break;case"undefined":n=0;break;default:throw TypeError("Invalid clockTolerance option type")}let{currentDate:u}=r,p=epoch(u||new Date);if((void 0!==a.iat||l)&&"number"!=typeof a.iat)throw new JWTClaimValidationFailed('"iat" claim must be a number',"iat","invalid");if(void 0!==a.nbf){if("number"!=typeof a.nbf)throw new JWTClaimValidationFailed('"nbf" claim must be a number',"nbf","invalid");if(a.nbf>p+n)throw new JWTClaimValidationFailed('"nbf" claim timestamp check failed',"nbf","check_failed")}if(void 0!==a.exp){if("number"!=typeof a.exp)throw new JWTClaimValidationFailed('"exp" claim must be a number',"exp","invalid");if(a.exp<=p-n)throw new JWTExpired('"exp" claim timestamp check failed',"exp","check_failed")}if(l){let e=p-a.iat,t="number"==typeof l?l:secs(l);if(e-n>t)throw new JWTExpired('"iat" claim timestamp check failed (too far in the past)',"iat","check_failed");if(e<0-n)throw new JWTClaimValidationFailed('"iat" claim timestamp check failed (it should be in the past)',"iat","check_failed")}return a};async function jwtDecrypt(e,t,r){let a=await compactDecrypt(e,t,r),n=jwt_claims_set(a.protectedHeader,a.plaintext,r),{protectedHeader:s}=a;if(void 0!==s.iss&&s.iss!==n.iss)throw new JWTClaimValidationFailed('replicated "iss" claim header parameter mismatch',"iss","mismatch");if(void 0!==s.sub&&s.sub!==n.sub)throw new JWTClaimValidationFailed('replicated "sub" claim header parameter mismatch',"sub","mismatch");if(void 0!==s.aud&&JSON.stringify(s.aud)!==JSON.stringify(n.aud))throw new JWTClaimValidationFailed('replicated "aud" claim header parameter mismatch',"aud","mismatch");let i={payload:n,protectedHeader:s};return"function"==typeof t?{...i,key:a.key}:i}let CompactEncrypt=class CompactEncrypt{constructor(e){this._flattened=new encrypt_FlattenedEncrypt(e)}setContentEncryptionKey(e){return this._flattened.setContentEncryptionKey(e),this}setInitializationVector(e){return this._flattened.setInitializationVector(e),this}setProtectedHeader(e){return this._flattened.setProtectedHeader(e),this}setKeyManagementParameters(e){return this._flattened.setKeyManagementParameters(e),this}async encrypt(e,t){let r=await this._flattened.encrypt(e,t);return[r.protected,r.encrypted_key,r.iv,r.ciphertext,r.tag].join(".")}};let produce_ProduceJWT=class produce_ProduceJWT{constructor(e){if(!is_object_isObject(e))throw TypeError("JWT Claims Set MUST be an object");this._payload=e}setIssuer(e){return this._payload={...this._payload,iss:e},this}setSubject(e){return this._payload={...this._payload,sub:e},this}setAudience(e){return this._payload={...this._payload,aud:e},this}setJti(e){return this._payload={...this._payload,jti:e},this}setNotBefore(e){return"number"==typeof e?this._payload={...this._payload,nbf:e}:this._payload={...this._payload,nbf:epoch(new Date)+secs(e)},this}setExpirationTime(e){return"number"==typeof e?this._payload={...this._payload,exp:e}:this._payload={...this._payload,exp:epoch(new Date)+secs(e)},this}setIssuedAt(e){return void 0===e?this._payload={...this._payload,iat:epoch(new Date)}:this._payload={...this._payload,iat:e},this}};let EncryptJWT=class EncryptJWT extends produce_ProduceJWT{setProtectedHeader(e){if(this._protectedHeader)throw TypeError("setProtectedHeader can only be called once");return this._protectedHeader=e,this}setKeyManagementParameters(e){if(this._keyManagementParameters)throw TypeError("setKeyManagementParameters can only be called once");return this._keyManagementParameters=e,this}setContentEncryptionKey(e){if(this._cek)throw TypeError("setContentEncryptionKey can only be called once");return this._cek=e,this}setInitializationVector(e){if(this._iv)throw TypeError("setInitializationVector can only be called once");return this._iv=e,this}replicateIssuerAsHeader(){return this._replicateIssuerAsHeader=!0,this}replicateSubjectAsHeader(){return this._replicateSubjectAsHeader=!0,this}replicateAudienceAsHeader(){return this._replicateAudienceAsHeader=!0,this}async encrypt(e,t){let r=new CompactEncrypt(m.encode(JSON.stringify(this._payload)));return this._replicateIssuerAsHeader&&(this._protectedHeader={...this._protectedHeader,iss:this._payload.iss}),this._replicateSubjectAsHeader&&(this._protectedHeader={...this._protectedHeader,sub:this._payload.sub}),this._replicateAudienceAsHeader&&(this._protectedHeader={...this._protectedHeader,aud:this._payload.aud}),r.setProtectedHeader(this._protectedHeader),this._iv&&r.setInitializationVector(this._iv),this._cek&&r.setContentEncryptionKey(this._cek),this._keyManagementParameters&&r.setKeyManagementParameters(this._keyManagementParameters),r.encrypt(e,t)}};function isJWKLike(e){return isObject(e)}r(13685),r(95687),r(82361),(0,g.promisify)(u.generateKeyPair);let Y={randomUUID:p().randomUUID},X=new Uint8Array(256),Q=X.length;function rng(){return Q>X.length-16&&(p().randomFillSync(X),Q=0),X.slice(Q,Q+=16)}let ee=[];for(let e=0;e<256;++e)ee.push((e+256).toString(16).slice(1));function unsafeStringify(e,t=0){return ee[e[t+0]]+ee[e[t+1]]+ee[e[t+2]]+ee[e[t+3]]+"-"+ee[e[t+4]]+ee[e[t+5]]+"-"+ee[e[t+6]]+ee[e[t+7]]+"-"+ee[e[t+8]]+ee[e[t+9]]+"-"+ee[e[t+10]]+ee[e[t+11]]+ee[e[t+12]]+ee[e[t+13]]+ee[e[t+14]]+ee[e[t+15]]}function v4(e,t,r){if(Y.randomUUID&&!t&&!e)return Y.randomUUID();e=e||{};let a=e.random||(e.rng||rng)();if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,t){r=r||0;for(let e=0;e<16;++e)t[r+e]=a[e];return t}return unsafeStringify(a)}let et=v4,er=["image/jpeg","image/png","image/gif","image/webp","image/svg+xml","image/tiff","image/bmp","image/x-icon"];async function init(e){let t=globalThis._EDGE_STORE_LOGGER,{ctx:r,provider:a,router:n}=e;t.debug("Running [init]",{ctx:r});let s=await encryptJWT(r),{token:i}=await a.init({ctx:r,router:n}),o=[(0,h.serialize)("edgestore-ctx",s,{path:"/",maxAge:2592e3})];i&&o.push((0,h.serialize)("edgestore-token",i,{path:"/",maxAge:2592e3}));let d=await a.getBaseUrl();return t.debug("Finished [init]",{ctx:r,newCookies:o,token:i,baseUrl:d}),{newCookies:o,token:i,baseUrl:d}}async function requestUpload(e){let{provider:t,router:r,ctxToken:a,body:{bucketName:n,input:s,fileInfo:o}}=e,d=globalThis._EDGE_STORE_LOGGER;if(d.debug("Running [requestUpload]",{bucketName:n,input:s,fileInfo:o}),!a)throw new i.f9({message:"Missing edgestore-ctx cookie",code:"UNAUTHORIZED"});let c=await getContext(a);d.debug("Decrypted Context",{ctx:c});let l=r.buckets[n];if(!l)throw new i.f9({message:`Bucket ${n} not found`,code:"BAD_REQUEST"});if(l._def.beforeUpload){d.debug("Running [beforeUpload]");let e=await l._def.beforeUpload?.({ctx:c,input:s,fileInfo:{size:o.size,type:o.type,fileName:o.fileName,extension:o.extension,replaceTargetUrl:o.replaceTargetUrl,temporary:o.temporary}});if(d.debug("Finished [beforeUpload]",{canUpload:e}),!e)throw new i.f9({message:"Upload not allowed for the current context",code:"UPLOAD_NOT_ALLOWED"})}if("IMAGE"===l._def.type&&!er.includes(o.type))throw new i.f9({code:"MIME_TYPE_NOT_ALLOWED",message:"Only images are allowed in this bucket",details:{allowedMimeTypes:er,mimeType:o.type}});if(l._def.bucketConfig?.maxSize&&o.size>l._def.bucketConfig.maxSize)throw new i.f9({code:"FILE_TOO_LARGE",message:`File size is too big. Max size is ${l._def.bucketConfig.maxSize}`,details:{maxFileSize:l._def.bucketConfig.maxSize,fileSize:o.size}});if(l._def.bucketConfig?.accept){let e=l._def.bucketConfig.accept,t=!1;for(let r of e)if(r.endsWith("/*")){let e=r.replace("/*","");if(o.type.startsWith(e)){t=!0;break}}else if(o.type===r){t=!0;break}if(!t)throw new i.f9({code:"MIME_TYPE_NOT_ALLOWED",message:`"${o.type}" is not allowed. Accepted types are ${JSON.stringify(e)}`,details:{allowedMimeTypes:e,mimeType:o.type}})}let u=buildPath({fileInfo:o,bucket:l,pathAttrs:{ctx:c,input:s}}),p=await l._def.metadata?.({ctx:c,input:s}),h=void 0===l._def.accessControl;d.debug("upload info",{path:u,metadata:p,isPublic:h,bucketType:l._def.type});let f=await t.requestUpload({bucketName:n,bucketType:l._def.type,fileInfo:{...o,path:u,isPublic:h,metadata:p}}),{parsedPath:m,pathOrder:y}=parsePath(u);return d.debug("Finished [requestUpload]"),{...f,size:o.size,uploadedAt:new Date().toISOString(),path:m,pathOrder:y,metadata:p}}async function requestUploadParts(e){let{provider:t,ctxToken:r,body:{multipart:a,path:n}}=e,s=globalThis._EDGE_STORE_LOGGER;if(s.debug("Running [requestUploadParts]",{multipart:a,path:n}),!r)throw new i.f9({message:"Missing edgestore-ctx cookie",code:"UNAUTHORIZED"});await getContext(r);let o=await t.requestUploadParts({multipart:a,path:n});return s.debug("Finished [requestUploadParts]"),o}async function completeMultipartUpload(e){let{provider:t,router:r,ctxToken:a,body:{bucketName:n,uploadId:s,key:o,parts:d}}=e,c=globalThis._EDGE_STORE_LOGGER;if(c.debug("Running [completeMultipartUpload]",{bucketName:n,uploadId:s,key:o}),!a)throw new i.f9({message:"Missing edgestore-ctx cookie",code:"UNAUTHORIZED"});await getContext(a);let l=r.buckets[n];if(!l)throw new i.f9({message:`Bucket ${n} not found`,code:"BAD_REQUEST"});let u=await t.completeMultipartUpload({uploadId:s,key:o,parts:d});return c.debug("Finished [completeMultipartUpload]"),u}async function confirmUpload(e){let{provider:t,router:r,ctxToken:a,body:{bucketName:n,url:s}}=e,o=globalThis._EDGE_STORE_LOGGER;if(o.debug("Running [confirmUpload]",{bucketName:n,url:s}),!a)throw new i.f9({message:"Missing edgestore-ctx cookie",code:"UNAUTHORIZED"});await getContext(a);let d=r.buckets[n];if(!d)throw new i.f9({message:`Bucket ${n} not found`,code:"BAD_REQUEST"});let c=await t.confirmUpload({bucket:d,url:s});return o.debug("Finished [confirmUpload]"),c}async function deleteFile(e){let{provider:t,router:r,ctxToken:a,body:{bucketName:n,url:s}}=e,o=globalThis._EDGE_STORE_LOGGER;if(o.debug("Running [deleteFile]",{bucketName:n,url:s}),!a)throw new i.f9({message:"Missing edgestore-ctx cookie",code:"UNAUTHORIZED"});let d=await getContext(a),c=r.buckets[n];if(!c)throw new i.f9({message:`Bucket ${n} not found`,code:"BAD_REQUEST"});if(!c._def.beforeDelete)throw new i.f9({message:"You need to define beforeDelete if you want to delete files directly from the frontend.",code:"SERVER_ERROR"});let l=await t.getFile({url:s}),u=await c._def.beforeDelete({ctx:d,fileInfo:l});if(!u)throw new i.f9({message:"Delete not allowed for the current context",code:"DELETE_NOT_ALLOWED"});let p=await t.deleteFile({bucket:c,url:s});return o.debug("Finished [deleteFile]"),p}async function encryptJWT(e){let t=process.env.EDGE_STORE_JWT_SECRET??process.env.EDGE_STORE_SECRET_KEY;if(!t)throw new i.f9({message:"EDGE_STORE_JWT_SECRET or EDGE_STORE_SECRET_KEY is not defined",code:"SERVER_ERROR"});let r=await getDerivedEncryptionKey(t);return await new EncryptJWT(e).setProtectedHeader({alg:"dir",enc:"A256GCM"}).setIssuedAt().setExpirationTime(Date.now()/1e3+2592e3).setJti(et()).encrypt(r)}async function decryptJWT(e){let t=process.env.EDGE_STORE_JWT_SECRET??process.env.EDGE_STORE_SECRET_KEY;if(!t)throw new i.f9({message:"EDGE_STORE_JWT_SECRET or EDGE_STORE_SECRET_KEY is not defined",code:"SERVER_ERROR"});let r=await getDerivedEncryptionKey(t),{payload:a}=await jwtDecrypt(e,r,{clockTolerance:15});return a}async function getDerivedEncryptionKey(e){return await esm_hkdf("sha256",e,"","Edge Store Generated Encryption Key",32)}function buildPath(e){let{bucket:t}=e,r=t._def.path,a=r.map(t=>{let a=Object.entries(t);if(void 0===a[0])throw new i.f9({message:`Empty path param found in: ${JSON.stringify(r)}`,code:"SERVER_ERROR"});let[n,s]=a[0],o=s().split(".").reduce((e,t)=>{if(void 0===e[t])throw new i.f9({message:`Missing key ${t} in ${JSON.stringify(e)}`,code:"BAD_REQUEST"});return e[t]},e.pathAttrs);return{key:n,value:o}});return a}function parsePath(e){let t=e.reduce((e,t)=>(e[t.key]=t.value,e),{}),r=e.map(e=>e.key);return{parsedPath:t,pathOrder:r}}async function getContext(e){return await decryptJWT(e)}function createEdgeStoreNextHandler(e){let{provider:t=EdgeStoreProvider()}=e,r=new Logger(e.logLevel);return globalThis._EDGE_STORE_LOGGER=r,r.debug("Creating Edge Store Next handler (app adapter)"),async a=>{try{if(!("nextUrl"in a))throw new i.f9({message:"Error running the app adapter. Make sure you are importing the correct adapter in your router configuration",code:"SERVER_ERROR"});if(a.nextUrl.pathname.endsWith("/health"))return new Response("OK",{status:200});if(a.nextUrl.pathname.endsWith("/init")){let r={};try{r="createContext"in e?await e.createContext({req:a}):{}}catch(e){throw new i.f9({message:"Error creating context",code:"CREATE_CONTEXT_ERROR",cause:e instanceof Error?e:void 0})}let{newCookies:n,token:s,baseUrl:o}=await init({ctx:r,provider:t,router:e.router}),d=new Response(JSON.stringify({token:s,baseUrl:o}),{status:200,headers:{"Content-Type":"application/json"}});for(let e of n)d.headers.append("Set-Cookie",e);return d}if(a.nextUrl.pathname.endsWith("/request-upload")){let r=await requestUpload({provider:t,router:e.router,body:await a.json(),ctxToken:a.cookies.get("edgestore-ctx")?.value});return new Response(JSON.stringify(r),{status:200,headers:{"Content-Type":"application/json"}})}if(a.nextUrl.pathname.endsWith("/request-upload-parts")){let r=await requestUploadParts({provider:t,router:e.router,body:await a.json(),ctxToken:a.cookies.get("edgestore-ctx")?.value});return new Response(JSON.stringify(r),{status:200,headers:{"Content-Type":"application/json"}})}else if(a.nextUrl.pathname.endsWith("/complete-multipart-upload"))return await completeMultipartUpload({provider:t,router:e.router,body:await a.json(),ctxToken:a.cookies.get("edgestore-ctx")?.value}),new Response(null,{status:200});else if(a.nextUrl.pathname.endsWith("/confirm-upload")){let r=await confirmUpload({provider:t,router:e.router,body:await a.json(),ctxToken:a.cookies.get("edgestore-ctx")?.value});return new Response(JSON.stringify(r),{status:200,headers:{"Content-Type":"application/json"}})}else if(a.nextUrl.pathname.endsWith("/delete-file")){let r=await deleteFile({provider:t,router:e.router,body:await a.json(),ctxToken:a.cookies.get("edgestore-ctx")?.value});return new Response(JSON.stringify(r),{status:200,headers:{"Content-Type":"application/json"}})}else{if(!a.nextUrl.pathname.endsWith("/proxy-file"))return new Response(null,{status:404});let e=a.nextUrl.searchParams.get("url");if("string"!=typeof e)return new Response(null,{status:400});{let t=await fetch(e,{headers:{cookie:a.cookies.toString()??""}}),r=await t.arrayBuffer();return new Response(r,{status:t.status,headers:{"Content-Type":t.headers.get("Content-Type")??"application/octet-stream"}})}}}catch(e){if(e instanceof i.f9)return r[e.level](e.formattedMessage()),e.cause&&r[e.level](e.cause),new Response(JSON.stringify(e.formattedJson()),{status:i.O9[e.code],headers:{"Content-Type":"application/json"}});return r.error(e),new Response(JSON.stringify(new i.f9({message:"Internal server error",code:"SERVER_ERROR"}).formattedJson()),{status:500,headers:{"Content-Type":"application/json"}})}}}},60013:(e,t,r)=>{r.d(t,{c:()=>a.cW});var a=r(45104)},45104:(e,t,r)=>{let a;r.d(t,{O9:()=>er,f9:()=>EdgeStoreError,cW:()=>ea}),function(e){function assertIs(e){}function assertNever(e){throw Error()}function joinValues(e,t=" | "){return e.map(e=>"string"==typeof e?`'${e}'`:e).join(t)}e.assertEqual=e=>e,e.assertIs=assertIs,e.assertNever=assertNever,e.arrayToEnum=e=>{let t={};for(let r of e)t[r]=r;return t},e.getValidEnumValues=t=>{let r=e.objectKeys(t).filter(e=>"number"!=typeof t[t[e]]),a={};for(let e of r)a[e]=t[e];return e.objectValues(a)},e.objectValues=t=>e.objectKeys(t).map(function(e){return t[e]}),e.objectKeys="function"==typeof Object.keys?e=>Object.keys(e):e=>{let t=[];for(let r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.push(r);return t},e.find=(e,t)=>{for(let r of e)if(t(r))return r},e.isInteger="function"==typeof Number.isInteger?e=>Number.isInteger(e):e=>"number"==typeof e&&isFinite(e)&&Math.floor(e)===e,e.joinValues=joinValues,e.jsonStringifyReplacer=(e,t)=>"bigint"==typeof t?t.toString():t}(Y||(Y={})),(X||(X={})).mergeShapes=(e,t)=>({...e,...t});let n=Y.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),getParsedType=e=>{let t=typeof e;switch(t){case"undefined":return n.undefined;case"string":return n.string;case"number":return isNaN(e)?n.nan:n.number;case"boolean":return n.boolean;case"function":return n.function;case"bigint":return n.bigint;case"symbol":return n.symbol;case"object":if(Array.isArray(e))return n.array;if(null===e)return n.null;if(e.then&&"function"==typeof e.then&&e.catch&&"function"==typeof e.catch)return n.promise;if("undefined"!=typeof Map&&e instanceof Map)return n.map;if("undefined"!=typeof Set&&e instanceof Set)return n.set;if("undefined"!=typeof Date&&e instanceof Date)return n.date;return n.object;default:return n.unknown}},s=Y.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);let ZodError=class ZodError extends Error{constructor(e){super(),this.issues=[],this.addIssue=e=>{this.issues=[...this.issues,e]},this.addIssues=(e=[])=>{this.issues=[...this.issues,...e]};let t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}get errors(){return this.issues}format(e){let t=e||function(e){return e.message},r={_errors:[]},processError=e=>{for(let a of e.issues)if("invalid_union"===a.code)a.unionErrors.map(processError);else if("invalid_return_type"===a.code)processError(a.returnTypeError);else if("invalid_arguments"===a.code)processError(a.argumentsError);else if(0===a.path.length)r._errors.push(t(a));else{let e=r,n=0;for(;n<a.path.length;){let r=a.path[n],s=n===a.path.length-1;s?(e[r]=e[r]||{_errors:[]},e[r]._errors.push(t(a))):e[r]=e[r]||{_errors:[]},e=e[r],n++}}};return processError(this),r}toString(){return this.message}get message(){return JSON.stringify(this.issues,Y.jsonStringifyReplacer,2)}get isEmpty(){return 0===this.issues.length}flatten(e=e=>e.message){let t={},r=[];for(let a of this.issues)a.path.length>0?(t[a.path[0]]=t[a.path[0]]||[],t[a.path[0]].push(e(a))):r.push(e(a));return{formErrors:r,fieldErrors:t}}get formErrors(){return this.flatten()}};ZodError.create=e=>{let t=new ZodError(e);return t};let errorMap=(e,t)=>{let r;switch(e.code){case s.invalid_type:r=e.received===n.undefined?"Required":`Expected ${e.expected}, received ${e.received}`;break;case s.invalid_literal:r=`Invalid literal value, expected ${JSON.stringify(e.expected,Y.jsonStringifyReplacer)}`;break;case s.unrecognized_keys:r=`Unrecognized key(s) in object: ${Y.joinValues(e.keys,", ")}`;break;case s.invalid_union:r="Invalid input";break;case s.invalid_union_discriminator:r=`Invalid discriminator value. Expected ${Y.joinValues(e.options)}`;break;case s.invalid_enum_value:r=`Invalid enum value. Expected ${Y.joinValues(e.options)}, received '${e.received}'`;break;case s.invalid_arguments:r="Invalid function arguments";break;case s.invalid_return_type:r="Invalid function return type";break;case s.invalid_date:r="Invalid date";break;case s.invalid_string:"object"==typeof e.validation?"includes"in e.validation?(r=`Invalid input: must include "${e.validation.includes}"`,"number"==typeof e.validation.position&&(r=`${r} at one or more positions greater than or equal to ${e.validation.position}`)):"startsWith"in e.validation?r=`Invalid input: must start with "${e.validation.startsWith}"`:"endsWith"in e.validation?r=`Invalid input: must end with "${e.validation.endsWith}"`:Y.assertNever(e.validation):r="regex"!==e.validation?`Invalid ${e.validation}`:"Invalid";break;case s.too_small:r="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at least":"more than"} ${e.minimum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at least":"over"} ${e.minimum} character(s)`:"number"===e.type?`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:"date"===e.type?`Date must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(e.minimum))}`:"Invalid input";break;case s.too_big:r="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at most":"less than"} ${e.maximum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at most":"under"} ${e.maximum} character(s)`:"number"===e.type?`Number must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"bigint"===e.type?`BigInt must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"date"===e.type?`Date must be ${e.exact?"exactly":e.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(e.maximum))}`:"Invalid input";break;case s.custom:r="Invalid input";break;case s.invalid_intersection_types:r="Intersection results could not be merged";break;case s.not_multiple_of:r=`Number must be a multiple of ${e.multipleOf}`;break;case s.not_finite:r="Number must be finite";break;default:r=t.defaultError,Y.assertNever(e)}return{message:r}},i=errorMap;function setErrorMap(e){i=e}function getErrorMap(){return i}let makeIssue=e=>{let{data:t,path:r,errorMaps:a,issueData:n}=e,s=[...r,...n.path||[]],i={...n,path:s},o="",d=a.filter(e=>!!e).slice().reverse();for(let e of d)o=e(i,{data:t,defaultError:o}).message;return{...n,path:s,message:n.message||o}};function addIssueToContext(e,t){let r=makeIssue({issueData:t,data:e.data,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,getErrorMap(),errorMap].filter(e=>!!e)});e.common.issues.push(r)}let ParseStatus=class ParseStatus{constructor(){this.value="valid"}dirty(){"valid"===this.value&&(this.value="dirty")}abort(){"aborted"!==this.value&&(this.value="aborted")}static mergeArray(e,t){let r=[];for(let a of t){if("aborted"===a.status)return o;"dirty"===a.status&&e.dirty(),r.push(a.value)}return{status:e.value,value:r}}static async mergeObjectAsync(e,t){let r=[];for(let e of t)r.push({key:await e.key,value:await e.value});return ParseStatus.mergeObjectSync(e,r)}static mergeObjectSync(e,t){let r={};for(let a of t){let{key:t,value:n}=a;if("aborted"===t.status||"aborted"===n.status)return o;"dirty"===t.status&&e.dirty(),"dirty"===n.status&&e.dirty(),"__proto__"!==t.value&&(void 0!==n.value||a.alwaysSet)&&(r[t.value]=n.value)}return{status:e.value,value:r}}};let o=Object.freeze({status:"aborted"}),DIRTY=e=>({status:"dirty",value:e}),OK=e=>({status:"valid",value:e}),isAborted=e=>"aborted"===e.status,isDirty=e=>"dirty"===e.status,isValid=e=>"valid"===e.status,isAsync=e=>"undefined"!=typeof Promise&&e instanceof Promise;!function(e){e.errToObj=e=>"string"==typeof e?{message:e}:e||{},e.toString=e=>"string"==typeof e?e:null==e?void 0:e.message}(Q||(Q={}));let ParseInputLazyPath=class ParseInputLazyPath{constructor(e,t,r,a){this._cachedPath=[],this.parent=e,this.data=t,this._path=r,this._key=a}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}};let handleResult=(e,t)=>{if(isValid(t))return{success:!0,data:t.value};if(!e.common.issues.length)throw Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let t=new ZodError(e.common.issues);return this._error=t,this._error}}};function processCreateParams(e){if(!e)return{};let{errorMap:t,invalid_type_error:r,required_error:a,description:n}=e;if(t&&(r||a))throw Error('Can\'t use "invalid_type_error" or "required_error" in conjunction with custom error map.');return t?{errorMap:t,description:n}:{errorMap:(e,t)=>"invalid_type"!==e.code?{message:t.defaultError}:void 0===t.data?{message:null!=a?a:t.defaultError}:{message:null!=r?r:t.defaultError},description:n}}let ZodType=class ZodType{constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this)}get description(){return this._def.description}_getType(e){return getParsedType(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:getParsedType(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new ParseStatus,ctx:{common:e.parent.common,data:e.data,parsedType:getParsedType(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){let t=this._parse(e);if(isAsync(t))throw Error("Synchronous parse encountered promise.");return t}_parseAsync(e){let t=this._parse(e);return Promise.resolve(t)}parse(e,t){let r=this.safeParse(e,t);if(r.success)return r.data;throw r.error}safeParse(e,t){var r;let a={common:{issues:[],async:null!==(r=null==t?void 0:t.async)&&void 0!==r&&r,contextualErrorMap:null==t?void 0:t.errorMap},path:(null==t?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:getParsedType(e)},n=this._parseSync({data:e,path:a.path,parent:a});return handleResult(a,n)}async parseAsync(e,t){let r=await this.safeParseAsync(e,t);if(r.success)return r.data;throw r.error}async safeParseAsync(e,t){let r={common:{issues:[],contextualErrorMap:null==t?void 0:t.errorMap,async:!0},path:(null==t?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:getParsedType(e)},a=this._parse({data:e,path:r.path,parent:r}),n=await (isAsync(a)?a:Promise.resolve(a));return handleResult(r,n)}refine(e,t){let getIssueProperties=e=>"string"==typeof t||void 0===t?{message:t}:"function"==typeof t?t(e):t;return this._refinement((t,r)=>{let a=e(t),setError=()=>r.addIssue({code:s.custom,...getIssueProperties(t)});return"undefined"!=typeof Promise&&a instanceof Promise?a.then(e=>!!e||(setError(),!1)):!!a||(setError(),!1)})}refinement(e,t){return this._refinement((r,a)=>!!e(r)||(a.addIssue("function"==typeof t?t(r,a):t),!1))}_refinement(e){return new ZodEffects({schema:this,typeName:ee.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}optional(){return ZodOptional.create(this,this._def)}nullable(){return ZodNullable.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return ZodArray.create(this,this._def)}promise(){return ZodPromise.create(this,this._def)}or(e){return ZodUnion.create([this,e],this._def)}and(e){return ZodIntersection.create(this,e,this._def)}transform(e){return new ZodEffects({...processCreateParams(this._def),schema:this,typeName:ee.ZodEffects,effect:{type:"transform",transform:e}})}default(e){return new ZodDefault({...processCreateParams(this._def),innerType:this,defaultValue:"function"==typeof e?e:()=>e,typeName:ee.ZodDefault})}brand(){return new ZodBranded({typeName:ee.ZodBranded,type:this,...processCreateParams(this._def)})}catch(e){return new ZodCatch({...processCreateParams(this._def),innerType:this,catchValue:"function"==typeof e?e:()=>e,typeName:ee.ZodCatch})}describe(e){let t=this.constructor;return new t({...this._def,description:e})}pipe(e){return ZodPipeline.create(this,e)}readonly(){return ZodReadonly.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}};let d=/^c[^\s-]{8,}$/i,c=/^[a-z][a-z0-9]*$/,l=/^[0-9A-HJKMNP-TV-Z]{26}$/,u=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,p=/^(?!\.)(?!.*\.\.)([A-Z0-9_+-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,h=/^(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))$/,f=/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,datetimeRegex=e=>e.precision?e.offset?RegExp(`^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}\\.\\d{${e.precision}}(([+-]\\d{2}(:?\\d{2})?)|Z)$`):RegExp(`^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}\\.\\d{${e.precision}}Z$`):0===e.precision?e.offset?RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(([+-]\\d{2}(:?\\d{2})?)|Z)$"):RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}Z$"):e.offset?RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(\\.\\d+)?(([+-]\\d{2}(:?\\d{2})?)|Z)$"):RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(\\.\\d+)?Z$");function isValidIP(e,t){return!!(("v4"===t||!t)&&h.test(e)||("v6"===t||!t)&&f.test(e))}let ZodString=class ZodString extends ZodType{_parse(e){let t;this._def.coerce&&(e.data=String(e.data));let r=this._getType(e);if(r!==n.string){let t=this._getOrReturnCtx(e);return addIssueToContext(t,{code:s.invalid_type,expected:n.string,received:t.parsedType}),o}let i=new ParseStatus;for(let r of this._def.checks)if("min"===r.kind)e.data.length<r.value&&(addIssueToContext(t=this._getOrReturnCtx(e,t),{code:s.too_small,minimum:r.value,type:"string",inclusive:!0,exact:!1,message:r.message}),i.dirty());else if("max"===r.kind)e.data.length>r.value&&(addIssueToContext(t=this._getOrReturnCtx(e,t),{code:s.too_big,maximum:r.value,type:"string",inclusive:!0,exact:!1,message:r.message}),i.dirty());else if("length"===r.kind){let a=e.data.length>r.value,n=e.data.length<r.value;(a||n)&&(t=this._getOrReturnCtx(e,t),a?addIssueToContext(t,{code:s.too_big,maximum:r.value,type:"string",inclusive:!0,exact:!0,message:r.message}):n&&addIssueToContext(t,{code:s.too_small,minimum:r.value,type:"string",inclusive:!0,exact:!0,message:r.message}),i.dirty())}else if("email"===r.kind)p.test(e.data)||(addIssueToContext(t=this._getOrReturnCtx(e,t),{validation:"email",code:s.invalid_string,message:r.message}),i.dirty());else if("emoji"===r.kind)a||(a=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),a.test(e.data)||(addIssueToContext(t=this._getOrReturnCtx(e,t),{validation:"emoji",code:s.invalid_string,message:r.message}),i.dirty());else if("uuid"===r.kind)u.test(e.data)||(addIssueToContext(t=this._getOrReturnCtx(e,t),{validation:"uuid",code:s.invalid_string,message:r.message}),i.dirty());else if("cuid"===r.kind)d.test(e.data)||(addIssueToContext(t=this._getOrReturnCtx(e,t),{validation:"cuid",code:s.invalid_string,message:r.message}),i.dirty());else if("cuid2"===r.kind)c.test(e.data)||(addIssueToContext(t=this._getOrReturnCtx(e,t),{validation:"cuid2",code:s.invalid_string,message:r.message}),i.dirty());else if("ulid"===r.kind)l.test(e.data)||(addIssueToContext(t=this._getOrReturnCtx(e,t),{validation:"ulid",code:s.invalid_string,message:r.message}),i.dirty());else if("url"===r.kind)try{new URL(e.data)}catch(a){addIssueToContext(t=this._getOrReturnCtx(e,t),{validation:"url",code:s.invalid_string,message:r.message}),i.dirty()}else if("regex"===r.kind){r.regex.lastIndex=0;let a=r.regex.test(e.data);a||(addIssueToContext(t=this._getOrReturnCtx(e,t),{validation:"regex",code:s.invalid_string,message:r.message}),i.dirty())}else if("trim"===r.kind)e.data=e.data.trim();else if("includes"===r.kind)e.data.includes(r.value,r.position)||(addIssueToContext(t=this._getOrReturnCtx(e,t),{code:s.invalid_string,validation:{includes:r.value,position:r.position},message:r.message}),i.dirty());else if("toLowerCase"===r.kind)e.data=e.data.toLowerCase();else if("toUpperCase"===r.kind)e.data=e.data.toUpperCase();else if("startsWith"===r.kind)e.data.startsWith(r.value)||(addIssueToContext(t=this._getOrReturnCtx(e,t),{code:s.invalid_string,validation:{startsWith:r.value},message:r.message}),i.dirty());else if("endsWith"===r.kind)e.data.endsWith(r.value)||(addIssueToContext(t=this._getOrReturnCtx(e,t),{code:s.invalid_string,validation:{endsWith:r.value},message:r.message}),i.dirty());else if("datetime"===r.kind){let a=datetimeRegex(r);a.test(e.data)||(addIssueToContext(t=this._getOrReturnCtx(e,t),{code:s.invalid_string,validation:"datetime",message:r.message}),i.dirty())}else"ip"===r.kind?isValidIP(e.data,r.version)||(addIssueToContext(t=this._getOrReturnCtx(e,t),{validation:"ip",code:s.invalid_string,message:r.message}),i.dirty()):Y.assertNever(r);return{status:i.value,value:e.data}}_regex(e,t,r){return this.refinement(t=>e.test(t),{validation:t,code:s.invalid_string,...Q.errToObj(r)})}_addCheck(e){return new ZodString({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...Q.errToObj(e)})}url(e){return this._addCheck({kind:"url",...Q.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...Q.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...Q.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...Q.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...Q.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...Q.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...Q.errToObj(e)})}datetime(e){var t;return"string"==typeof e?this._addCheck({kind:"datetime",precision:null,offset:!1,message:e}):this._addCheck({kind:"datetime",precision:void 0===(null==e?void 0:e.precision)?null:null==e?void 0:e.precision,offset:null!==(t=null==e?void 0:e.offset)&&void 0!==t&&t,...Q.errToObj(null==e?void 0:e.message)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...Q.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:null==t?void 0:t.position,...Q.errToObj(null==t?void 0:t.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...Q.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...Q.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...Q.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...Q.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...Q.errToObj(t)})}nonempty(e){return this.min(1,Q.errToObj(e))}trim(){return new ZodString({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new ZodString({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new ZodString({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>"datetime"===e.kind)}get isEmail(){return!!this._def.checks.find(e=>"email"===e.kind)}get isURL(){return!!this._def.checks.find(e=>"url"===e.kind)}get isEmoji(){return!!this._def.checks.find(e=>"emoji"===e.kind)}get isUUID(){return!!this._def.checks.find(e=>"uuid"===e.kind)}get isCUID(){return!!this._def.checks.find(e=>"cuid"===e.kind)}get isCUID2(){return!!this._def.checks.find(e=>"cuid2"===e.kind)}get isULID(){return!!this._def.checks.find(e=>"ulid"===e.kind)}get isIP(){return!!this._def.checks.find(e=>"ip"===e.kind)}get minLength(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}};function floatSafeRemainder(e,t){let r=(e.toString().split(".")[1]||"").length,a=(t.toString().split(".")[1]||"").length,n=r>a?r:a,s=parseInt(e.toFixed(n).replace(".","")),i=parseInt(t.toFixed(n).replace(".",""));return s%i/Math.pow(10,n)}ZodString.create=e=>{var t;return new ZodString({checks:[],typeName:ee.ZodString,coerce:null!==(t=null==e?void 0:e.coerce)&&void 0!==t&&t,...processCreateParams(e)})};let ZodNumber=class ZodNumber extends ZodType{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){let t;this._def.coerce&&(e.data=Number(e.data));let r=this._getType(e);if(r!==n.number){let t=this._getOrReturnCtx(e);return addIssueToContext(t,{code:s.invalid_type,expected:n.number,received:t.parsedType}),o}let a=new ParseStatus;for(let r of this._def.checks)if("int"===r.kind)Y.isInteger(e.data)||(addIssueToContext(t=this._getOrReturnCtx(e,t),{code:s.invalid_type,expected:"integer",received:"float",message:r.message}),a.dirty());else if("min"===r.kind){let n=r.inclusive?e.data<r.value:e.data<=r.value;n&&(addIssueToContext(t=this._getOrReturnCtx(e,t),{code:s.too_small,minimum:r.value,type:"number",inclusive:r.inclusive,exact:!1,message:r.message}),a.dirty())}else if("max"===r.kind){let n=r.inclusive?e.data>r.value:e.data>=r.value;n&&(addIssueToContext(t=this._getOrReturnCtx(e,t),{code:s.too_big,maximum:r.value,type:"number",inclusive:r.inclusive,exact:!1,message:r.message}),a.dirty())}else"multipleOf"===r.kind?0!==floatSafeRemainder(e.data,r.value)&&(addIssueToContext(t=this._getOrReturnCtx(e,t),{code:s.not_multiple_of,multipleOf:r.value,message:r.message}),a.dirty()):"finite"===r.kind?Number.isFinite(e.data)||(addIssueToContext(t=this._getOrReturnCtx(e,t),{code:s.not_finite,message:r.message}),a.dirty()):Y.assertNever(r);return{status:a.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,Q.toString(t))}gt(e,t){return this.setLimit("min",e,!1,Q.toString(t))}lte(e,t){return this.setLimit("max",e,!0,Q.toString(t))}lt(e,t){return this.setLimit("max",e,!1,Q.toString(t))}setLimit(e,t,r,a){return new ZodNumber({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:Q.toString(a)}]})}_addCheck(e){return new ZodNumber({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:Q.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:Q.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:Q.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:Q.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:Q.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:Q.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:Q.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:Q.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:Q.toString(e)})}get minValue(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>"int"===e.kind||"multipleOf"===e.kind&&Y.isInteger(e.value))}get isFinite(){let e=null,t=null;for(let r of this._def.checks){if("finite"===r.kind||"int"===r.kind||"multipleOf"===r.kind)return!0;"min"===r.kind?(null===t||r.value>t)&&(t=r.value):"max"===r.kind&&(null===e||r.value<e)&&(e=r.value)}return Number.isFinite(t)&&Number.isFinite(e)}};ZodNumber.create=e=>new ZodNumber({checks:[],typeName:ee.ZodNumber,coerce:(null==e?void 0:e.coerce)||!1,...processCreateParams(e)});let ZodBigInt=class ZodBigInt extends ZodType{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){let t;this._def.coerce&&(e.data=BigInt(e.data));let r=this._getType(e);if(r!==n.bigint){let t=this._getOrReturnCtx(e);return addIssueToContext(t,{code:s.invalid_type,expected:n.bigint,received:t.parsedType}),o}let a=new ParseStatus;for(let r of this._def.checks)if("min"===r.kind){let n=r.inclusive?e.data<r.value:e.data<=r.value;n&&(addIssueToContext(t=this._getOrReturnCtx(e,t),{code:s.too_small,type:"bigint",minimum:r.value,inclusive:r.inclusive,message:r.message}),a.dirty())}else if("max"===r.kind){let n=r.inclusive?e.data>r.value:e.data>=r.value;n&&(addIssueToContext(t=this._getOrReturnCtx(e,t),{code:s.too_big,type:"bigint",maximum:r.value,inclusive:r.inclusive,message:r.message}),a.dirty())}else"multipleOf"===r.kind?e.data%r.value!==BigInt(0)&&(addIssueToContext(t=this._getOrReturnCtx(e,t),{code:s.not_multiple_of,multipleOf:r.value,message:r.message}),a.dirty()):Y.assertNever(r);return{status:a.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,Q.toString(t))}gt(e,t){return this.setLimit("min",e,!1,Q.toString(t))}lte(e,t){return this.setLimit("max",e,!0,Q.toString(t))}lt(e,t){return this.setLimit("max",e,!1,Q.toString(t))}setLimit(e,t,r,a){return new ZodBigInt({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:Q.toString(a)}]})}_addCheck(e){return new ZodBigInt({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:Q.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:Q.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:Q.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:Q.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:Q.toString(t)})}get minValue(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}};ZodBigInt.create=e=>{var t;return new ZodBigInt({checks:[],typeName:ee.ZodBigInt,coerce:null!==(t=null==e?void 0:e.coerce)&&void 0!==t&&t,...processCreateParams(e)})};let ZodBoolean=class ZodBoolean extends ZodType{_parse(e){this._def.coerce&&(e.data=!!e.data);let t=this._getType(e);if(t!==n.boolean){let t=this._getOrReturnCtx(e);return addIssueToContext(t,{code:s.invalid_type,expected:n.boolean,received:t.parsedType}),o}return OK(e.data)}};ZodBoolean.create=e=>new ZodBoolean({typeName:ee.ZodBoolean,coerce:(null==e?void 0:e.coerce)||!1,...processCreateParams(e)});let ZodDate=class ZodDate extends ZodType{_parse(e){let t;this._def.coerce&&(e.data=new Date(e.data));let r=this._getType(e);if(r!==n.date){let t=this._getOrReturnCtx(e);return addIssueToContext(t,{code:s.invalid_type,expected:n.date,received:t.parsedType}),o}if(isNaN(e.data.getTime())){let t=this._getOrReturnCtx(e);return addIssueToContext(t,{code:s.invalid_date}),o}let a=new ParseStatus;for(let r of this._def.checks)"min"===r.kind?e.data.getTime()<r.value&&(addIssueToContext(t=this._getOrReturnCtx(e,t),{code:s.too_small,message:r.message,inclusive:!0,exact:!1,minimum:r.value,type:"date"}),a.dirty()):"max"===r.kind?e.data.getTime()>r.value&&(addIssueToContext(t=this._getOrReturnCtx(e,t),{code:s.too_big,message:r.message,inclusive:!0,exact:!1,maximum:r.value,type:"date"}),a.dirty()):Y.assertNever(r);return{status:a.value,value:new Date(e.data.getTime())}}_addCheck(e){return new ZodDate({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:Q.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:Q.toString(t)})}get minDate(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return null!=e?new Date(e):null}get maxDate(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return null!=e?new Date(e):null}};ZodDate.create=e=>new ZodDate({checks:[],coerce:(null==e?void 0:e.coerce)||!1,typeName:ee.ZodDate,...processCreateParams(e)});let ZodSymbol=class ZodSymbol extends ZodType{_parse(e){let t=this._getType(e);if(t!==n.symbol){let t=this._getOrReturnCtx(e);return addIssueToContext(t,{code:s.invalid_type,expected:n.symbol,received:t.parsedType}),o}return OK(e.data)}};ZodSymbol.create=e=>new ZodSymbol({typeName:ee.ZodSymbol,...processCreateParams(e)});let ZodUndefined=class ZodUndefined extends ZodType{_parse(e){let t=this._getType(e);if(t!==n.undefined){let t=this._getOrReturnCtx(e);return addIssueToContext(t,{code:s.invalid_type,expected:n.undefined,received:t.parsedType}),o}return OK(e.data)}};ZodUndefined.create=e=>new ZodUndefined({typeName:ee.ZodUndefined,...processCreateParams(e)});let ZodNull=class ZodNull extends ZodType{_parse(e){let t=this._getType(e);if(t!==n.null){let t=this._getOrReturnCtx(e);return addIssueToContext(t,{code:s.invalid_type,expected:n.null,received:t.parsedType}),o}return OK(e.data)}};ZodNull.create=e=>new ZodNull({typeName:ee.ZodNull,...processCreateParams(e)});let ZodAny=class ZodAny extends ZodType{constructor(){super(...arguments),this._any=!0}_parse(e){return OK(e.data)}};ZodAny.create=e=>new ZodAny({typeName:ee.ZodAny,...processCreateParams(e)});let ZodUnknown=class ZodUnknown extends ZodType{constructor(){super(...arguments),this._unknown=!0}_parse(e){return OK(e.data)}};ZodUnknown.create=e=>new ZodUnknown({typeName:ee.ZodUnknown,...processCreateParams(e)});let ZodNever=class ZodNever extends ZodType{_parse(e){let t=this._getOrReturnCtx(e);return addIssueToContext(t,{code:s.invalid_type,expected:n.never,received:t.parsedType}),o}};ZodNever.create=e=>new ZodNever({typeName:ee.ZodNever,...processCreateParams(e)});let ZodVoid=class ZodVoid extends ZodType{_parse(e){let t=this._getType(e);if(t!==n.undefined){let t=this._getOrReturnCtx(e);return addIssueToContext(t,{code:s.invalid_type,expected:n.void,received:t.parsedType}),o}return OK(e.data)}};ZodVoid.create=e=>new ZodVoid({typeName:ee.ZodVoid,...processCreateParams(e)});let ZodArray=class ZodArray extends ZodType{_parse(e){let{ctx:t,status:r}=this._processInputParams(e),a=this._def;if(t.parsedType!==n.array)return addIssueToContext(t,{code:s.invalid_type,expected:n.array,received:t.parsedType}),o;if(null!==a.exactLength){let e=t.data.length>a.exactLength.value,n=t.data.length<a.exactLength.value;(e||n)&&(addIssueToContext(t,{code:e?s.too_big:s.too_small,minimum:n?a.exactLength.value:void 0,maximum:e?a.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:a.exactLength.message}),r.dirty())}if(null!==a.minLength&&t.data.length<a.minLength.value&&(addIssueToContext(t,{code:s.too_small,minimum:a.minLength.value,type:"array",inclusive:!0,exact:!1,message:a.minLength.message}),r.dirty()),null!==a.maxLength&&t.data.length>a.maxLength.value&&(addIssueToContext(t,{code:s.too_big,maximum:a.maxLength.value,type:"array",inclusive:!0,exact:!1,message:a.maxLength.message}),r.dirty()),t.common.async)return Promise.all([...t.data].map((e,r)=>a.type._parseAsync(new ParseInputLazyPath(t,e,t.path,r)))).then(e=>ParseStatus.mergeArray(r,e));let i=[...t.data].map((e,r)=>a.type._parseSync(new ParseInputLazyPath(t,e,t.path,r)));return ParseStatus.mergeArray(r,i)}get element(){return this._def.type}min(e,t){return new ZodArray({...this._def,minLength:{value:e,message:Q.toString(t)}})}max(e,t){return new ZodArray({...this._def,maxLength:{value:e,message:Q.toString(t)}})}length(e,t){return new ZodArray({...this._def,exactLength:{value:e,message:Q.toString(t)}})}nonempty(e){return this.min(1,e)}};function deepPartialify(e){if(e instanceof ZodObject){let t={};for(let r in e.shape){let a=e.shape[r];t[r]=ZodOptional.create(deepPartialify(a))}return new ZodObject({...e._def,shape:()=>t})}return e instanceof ZodArray?new ZodArray({...e._def,type:deepPartialify(e.element)}):e instanceof ZodOptional?ZodOptional.create(deepPartialify(e.unwrap())):e instanceof ZodNullable?ZodNullable.create(deepPartialify(e.unwrap())):e instanceof ZodTuple?ZodTuple.create(e.items.map(e=>deepPartialify(e))):e}ZodArray.create=(e,t)=>new ZodArray({type:e,minLength:null,maxLength:null,exactLength:null,typeName:ee.ZodArray,...processCreateParams(t)});let ZodObject=class ZodObject extends ZodType{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(null!==this._cached)return this._cached;let e=this._def.shape(),t=Y.objectKeys(e);return this._cached={shape:e,keys:t}}_parse(e){let t=this._getType(e);if(t!==n.object){let t=this._getOrReturnCtx(e);return addIssueToContext(t,{code:s.invalid_type,expected:n.object,received:t.parsedType}),o}let{status:r,ctx:a}=this._processInputParams(e),{shape:i,keys:d}=this._getCached(),c=[];if(!(this._def.catchall instanceof ZodNever&&"strip"===this._def.unknownKeys))for(let e in a.data)d.includes(e)||c.push(e);let l=[];for(let e of d){let t=i[e],r=a.data[e];l.push({key:{status:"valid",value:e},value:t._parse(new ParseInputLazyPath(a,r,a.path,e)),alwaysSet:e in a.data})}if(this._def.catchall instanceof ZodNever){let e=this._def.unknownKeys;if("passthrough"===e)for(let e of c)l.push({key:{status:"valid",value:e},value:{status:"valid",value:a.data[e]}});else if("strict"===e)c.length>0&&(addIssueToContext(a,{code:s.unrecognized_keys,keys:c}),r.dirty());else if("strip"===e);else throw Error("Internal ZodObject error: invalid unknownKeys value.")}else{let e=this._def.catchall;for(let t of c){let r=a.data[t];l.push({key:{status:"valid",value:t},value:e._parse(new ParseInputLazyPath(a,r,a.path,t)),alwaysSet:t in a.data})}}return a.common.async?Promise.resolve().then(async()=>{let e=[];for(let t of l){let r=await t.key;e.push({key:r,value:await t.value,alwaysSet:t.alwaysSet})}return e}).then(e=>ParseStatus.mergeObjectSync(r,e)):ParseStatus.mergeObjectSync(r,l)}get shape(){return this._def.shape()}strict(e){return Q.errToObj,new ZodObject({...this._def,unknownKeys:"strict",...void 0!==e?{errorMap:(t,r)=>{var a,n,s,i;let o=null!==(s=null===(n=(a=this._def).errorMap)||void 0===n?void 0:n.call(a,t,r).message)&&void 0!==s?s:r.defaultError;return"unrecognized_keys"===t.code?{message:null!==(i=Q.errToObj(e).message)&&void 0!==i?i:o}:{message:o}}}:{}})}strip(){return new ZodObject({...this._def,unknownKeys:"strip"})}passthrough(){return new ZodObject({...this._def,unknownKeys:"passthrough"})}extend(e){return new ZodObject({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){let t=new ZodObject({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:ee.ZodObject});return t}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new ZodObject({...this._def,catchall:e})}pick(e){let t={};return Y.objectKeys(e).forEach(r=>{e[r]&&this.shape[r]&&(t[r]=this.shape[r])}),new ZodObject({...this._def,shape:()=>t})}omit(e){let t={};return Y.objectKeys(this.shape).forEach(r=>{e[r]||(t[r]=this.shape[r])}),new ZodObject({...this._def,shape:()=>t})}deepPartial(){return deepPartialify(this)}partial(e){let t={};return Y.objectKeys(this.shape).forEach(r=>{let a=this.shape[r];e&&!e[r]?t[r]=a:t[r]=a.optional()}),new ZodObject({...this._def,shape:()=>t})}required(e){let t={};return Y.objectKeys(this.shape).forEach(r=>{if(e&&!e[r])t[r]=this.shape[r];else{let e=this.shape[r],a=e;for(;a instanceof ZodOptional;)a=a._def.innerType;t[r]=a}}),new ZodObject({...this._def,shape:()=>t})}keyof(){return createZodEnum(Y.objectKeys(this.shape))}};ZodObject.create=(e,t)=>new ZodObject({shape:()=>e,unknownKeys:"strip",catchall:ZodNever.create(),typeName:ee.ZodObject,...processCreateParams(t)}),ZodObject.strictCreate=(e,t)=>new ZodObject({shape:()=>e,unknownKeys:"strict",catchall:ZodNever.create(),typeName:ee.ZodObject,...processCreateParams(t)}),ZodObject.lazycreate=(e,t)=>new ZodObject({shape:e,unknownKeys:"strip",catchall:ZodNever.create(),typeName:ee.ZodObject,...processCreateParams(t)});let ZodUnion=class ZodUnion extends ZodType{_parse(e){let{ctx:t}=this._processInputParams(e),r=this._def.options;function handleResults(e){for(let t of e)if("valid"===t.result.status)return t.result;for(let r of e)if("dirty"===r.result.status)return t.common.issues.push(...r.ctx.common.issues),r.result;let r=e.map(e=>new ZodError(e.ctx.common.issues));return addIssueToContext(t,{code:s.invalid_union,unionErrors:r}),o}if(t.common.async)return Promise.all(r.map(async e=>{let r={...t,common:{...t.common,issues:[]},parent:null};return{result:await e._parseAsync({data:t.data,path:t.path,parent:r}),ctx:r}})).then(handleResults);{let e;let a=[];for(let n of r){let r={...t,common:{...t.common,issues:[]},parent:null},s=n._parseSync({data:t.data,path:t.path,parent:r});if("valid"===s.status)return s;"dirty"!==s.status||e||(e={result:s,ctx:r}),r.common.issues.length&&a.push(r.common.issues)}if(e)return t.common.issues.push(...e.ctx.common.issues),e.result;let n=a.map(e=>new ZodError(e));return addIssueToContext(t,{code:s.invalid_union,unionErrors:n}),o}}get options(){return this._def.options}};ZodUnion.create=(e,t)=>new ZodUnion({options:e,typeName:ee.ZodUnion,...processCreateParams(t)});let getDiscriminator=e=>{if(e instanceof ZodLazy)return getDiscriminator(e.schema);if(e instanceof ZodEffects)return getDiscriminator(e.innerType());if(e instanceof ZodLiteral)return[e.value];if(e instanceof ZodEnum)return e.options;if(e instanceof ZodNativeEnum)return Object.keys(e.enum);if(e instanceof ZodDefault)return getDiscriminator(e._def.innerType);if(e instanceof ZodUndefined)return[void 0];else if(e instanceof ZodNull)return[null];else return null};let ZodDiscriminatedUnion=class ZodDiscriminatedUnion extends ZodType{_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==n.object)return addIssueToContext(t,{code:s.invalid_type,expected:n.object,received:t.parsedType}),o;let r=this.discriminator,a=t.data[r],i=this.optionsMap.get(a);return i?t.common.async?i._parseAsync({data:t.data,path:t.path,parent:t}):i._parseSync({data:t.data,path:t.path,parent:t}):(addIssueToContext(t,{code:s.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[r]}),o)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,r){let a=new Map;for(let r of t){let t=getDiscriminator(r.shape[e]);if(!t)throw Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(let n of t){if(a.has(n))throw Error(`Discriminator property ${String(e)} has duplicate value ${String(n)}`);a.set(n,r)}}return new ZodDiscriminatedUnion({typeName:ee.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:a,...processCreateParams(r)})}};function mergeValues(e,t){let r=getParsedType(e),a=getParsedType(t);if(e===t)return{valid:!0,data:e};if(r===n.object&&a===n.object){let r=Y.objectKeys(t),a=Y.objectKeys(e).filter(e=>-1!==r.indexOf(e)),n={...e,...t};for(let r of a){let a=mergeValues(e[r],t[r]);if(!a.valid)return{valid:!1};n[r]=a.data}return{valid:!0,data:n}}if(r===n.array&&a===n.array){if(e.length!==t.length)return{valid:!1};let r=[];for(let a=0;a<e.length;a++){let n=e[a],s=t[a],i=mergeValues(n,s);if(!i.valid)return{valid:!1};r.push(i.data)}return{valid:!0,data:r}}return r===n.date&&a===n.date&&+e==+t?{valid:!0,data:e}:{valid:!1}}let ZodIntersection=class ZodIntersection extends ZodType{_parse(e){let{status:t,ctx:r}=this._processInputParams(e),handleParsed=(e,a)=>{if(isAborted(e)||isAborted(a))return o;let n=mergeValues(e.value,a.value);return n.valid?((isDirty(e)||isDirty(a))&&t.dirty(),{status:t.value,value:n.data}):(addIssueToContext(r,{code:s.invalid_intersection_types}),o)};return r.common.async?Promise.all([this._def.left._parseAsync({data:r.data,path:r.path,parent:r}),this._def.right._parseAsync({data:r.data,path:r.path,parent:r})]).then(([e,t])=>handleParsed(e,t)):handleParsed(this._def.left._parseSync({data:r.data,path:r.path,parent:r}),this._def.right._parseSync({data:r.data,path:r.path,parent:r}))}};ZodIntersection.create=(e,t,r)=>new ZodIntersection({left:e,right:t,typeName:ee.ZodIntersection,...processCreateParams(r)});let ZodTuple=class ZodTuple extends ZodType{_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==n.array)return addIssueToContext(r,{code:s.invalid_type,expected:n.array,received:r.parsedType}),o;if(r.data.length<this._def.items.length)return addIssueToContext(r,{code:s.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),o;let a=this._def.rest;!a&&r.data.length>this._def.items.length&&(addIssueToContext(r,{code:s.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());let i=[...r.data].map((e,t)=>{let a=this._def.items[t]||this._def.rest;return a?a._parse(new ParseInputLazyPath(r,e,r.path,t)):null}).filter(e=>!!e);return r.common.async?Promise.all(i).then(e=>ParseStatus.mergeArray(t,e)):ParseStatus.mergeArray(t,i)}get items(){return this._def.items}rest(e){return new ZodTuple({...this._def,rest:e})}};ZodTuple.create=(e,t)=>{if(!Array.isArray(e))throw Error("You must pass an array of schemas to z.tuple([ ... ])");return new ZodTuple({items:e,typeName:ee.ZodTuple,rest:null,...processCreateParams(t)})};let ZodRecord=class ZodRecord extends ZodType{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==n.object)return addIssueToContext(r,{code:s.invalid_type,expected:n.object,received:r.parsedType}),o;let a=[],i=this._def.keyType,d=this._def.valueType;for(let e in r.data)a.push({key:i._parse(new ParseInputLazyPath(r,e,r.path,e)),value:d._parse(new ParseInputLazyPath(r,r.data[e],r.path,e))});return r.common.async?ParseStatus.mergeObjectAsync(t,a):ParseStatus.mergeObjectSync(t,a)}get element(){return this._def.valueType}static create(e,t,r){return new ZodRecord(t instanceof ZodType?{keyType:e,valueType:t,typeName:ee.ZodRecord,...processCreateParams(r)}:{keyType:ZodString.create(),valueType:e,typeName:ee.ZodRecord,...processCreateParams(t)})}};let ZodMap=class ZodMap extends ZodType{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==n.map)return addIssueToContext(r,{code:s.invalid_type,expected:n.map,received:r.parsedType}),o;let a=this._def.keyType,i=this._def.valueType,d=[...r.data.entries()].map(([e,t],n)=>({key:a._parse(new ParseInputLazyPath(r,e,r.path,[n,"key"])),value:i._parse(new ParseInputLazyPath(r,t,r.path,[n,"value"]))}));if(r.common.async){let e=new Map;return Promise.resolve().then(async()=>{for(let r of d){let a=await r.key,n=await r.value;if("aborted"===a.status||"aborted"===n.status)return o;("dirty"===a.status||"dirty"===n.status)&&t.dirty(),e.set(a.value,n.value)}return{status:t.value,value:e}})}{let e=new Map;for(let r of d){let a=r.key,n=r.value;if("aborted"===a.status||"aborted"===n.status)return o;("dirty"===a.status||"dirty"===n.status)&&t.dirty(),e.set(a.value,n.value)}return{status:t.value,value:e}}}};ZodMap.create=(e,t,r)=>new ZodMap({valueType:t,keyType:e,typeName:ee.ZodMap,...processCreateParams(r)});let ZodSet=class ZodSet extends ZodType{_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==n.set)return addIssueToContext(r,{code:s.invalid_type,expected:n.set,received:r.parsedType}),o;let a=this._def;null!==a.minSize&&r.data.size<a.minSize.value&&(addIssueToContext(r,{code:s.too_small,minimum:a.minSize.value,type:"set",inclusive:!0,exact:!1,message:a.minSize.message}),t.dirty()),null!==a.maxSize&&r.data.size>a.maxSize.value&&(addIssueToContext(r,{code:s.too_big,maximum:a.maxSize.value,type:"set",inclusive:!0,exact:!1,message:a.maxSize.message}),t.dirty());let i=this._def.valueType;function finalizeSet(e){let r=new Set;for(let a of e){if("aborted"===a.status)return o;"dirty"===a.status&&t.dirty(),r.add(a.value)}return{status:t.value,value:r}}let d=[...r.data.values()].map((e,t)=>i._parse(new ParseInputLazyPath(r,e,r.path,t)));return r.common.async?Promise.all(d).then(e=>finalizeSet(e)):finalizeSet(d)}min(e,t){return new ZodSet({...this._def,minSize:{value:e,message:Q.toString(t)}})}max(e,t){return new ZodSet({...this._def,maxSize:{value:e,message:Q.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}};ZodSet.create=(e,t)=>new ZodSet({valueType:e,minSize:null,maxSize:null,typeName:ee.ZodSet,...processCreateParams(t)});let ZodFunction=class ZodFunction extends ZodType{constructor(){super(...arguments),this.validate=this.implement}_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==n.function)return addIssueToContext(t,{code:s.invalid_type,expected:n.function,received:t.parsedType}),o;function makeArgsIssue(e,r){return makeIssue({data:e,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,getErrorMap(),errorMap].filter(e=>!!e),issueData:{code:s.invalid_arguments,argumentsError:r}})}function makeReturnsIssue(e,r){return makeIssue({data:e,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,getErrorMap(),errorMap].filter(e=>!!e),issueData:{code:s.invalid_return_type,returnTypeError:r}})}let r={errorMap:t.common.contextualErrorMap},a=t.data;if(this._def.returns instanceof ZodPromise){let e=this;return OK(async function(...t){let n=new ZodError([]),s=await e._def.args.parseAsync(t,r).catch(e=>{throw n.addIssue(makeArgsIssue(t,e)),n}),i=await Reflect.apply(a,this,s),o=await e._def.returns._def.type.parseAsync(i,r).catch(e=>{throw n.addIssue(makeReturnsIssue(i,e)),n});return o})}{let e=this;return OK(function(...t){let n=e._def.args.safeParse(t,r);if(!n.success)throw new ZodError([makeArgsIssue(t,n.error)]);let s=Reflect.apply(a,this,n.data),i=e._def.returns.safeParse(s,r);if(!i.success)throw new ZodError([makeReturnsIssue(s,i.error)]);return i.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new ZodFunction({...this._def,args:ZodTuple.create(e).rest(ZodUnknown.create())})}returns(e){return new ZodFunction({...this._def,returns:e})}implement(e){let t=this.parse(e);return t}strictImplement(e){let t=this.parse(e);return t}static create(e,t,r){return new ZodFunction({args:e||ZodTuple.create([]).rest(ZodUnknown.create()),returns:t||ZodUnknown.create(),typeName:ee.ZodFunction,...processCreateParams(r)})}};let ZodLazy=class ZodLazy extends ZodType{get schema(){return this._def.getter()}_parse(e){let{ctx:t}=this._processInputParams(e),r=this._def.getter();return r._parse({data:t.data,path:t.path,parent:t})}};ZodLazy.create=(e,t)=>new ZodLazy({getter:e,typeName:ee.ZodLazy,...processCreateParams(t)});let ZodLiteral=class ZodLiteral extends ZodType{_parse(e){if(e.data!==this._def.value){let t=this._getOrReturnCtx(e);return addIssueToContext(t,{received:t.data,code:s.invalid_literal,expected:this._def.value}),o}return{status:"valid",value:e.data}}get value(){return this._def.value}};function createZodEnum(e,t){return new ZodEnum({values:e,typeName:ee.ZodEnum,...processCreateParams(t)})}ZodLiteral.create=(e,t)=>new ZodLiteral({value:e,typeName:ee.ZodLiteral,...processCreateParams(t)});let ZodEnum=class ZodEnum extends ZodType{_parse(e){if("string"!=typeof e.data){let t=this._getOrReturnCtx(e),r=this._def.values;return addIssueToContext(t,{expected:Y.joinValues(r),received:t.parsedType,code:s.invalid_type}),o}if(-1===this._def.values.indexOf(e.data)){let t=this._getOrReturnCtx(e),r=this._def.values;return addIssueToContext(t,{received:t.data,code:s.invalid_enum_value,options:r}),o}return OK(e.data)}get options(){return this._def.values}get enum(){let e={};for(let t of this._def.values)e[t]=t;return e}get Values(){let e={};for(let t of this._def.values)e[t]=t;return e}get Enum(){let e={};for(let t of this._def.values)e[t]=t;return e}extract(e){return ZodEnum.create(e)}exclude(e){return ZodEnum.create(this.options.filter(t=>!e.includes(t)))}};ZodEnum.create=createZodEnum;let ZodNativeEnum=class ZodNativeEnum extends ZodType{_parse(e){let t=Y.getValidEnumValues(this._def.values),r=this._getOrReturnCtx(e);if(r.parsedType!==n.string&&r.parsedType!==n.number){let e=Y.objectValues(t);return addIssueToContext(r,{expected:Y.joinValues(e),received:r.parsedType,code:s.invalid_type}),o}if(-1===t.indexOf(e.data)){let e=Y.objectValues(t);return addIssueToContext(r,{received:r.data,code:s.invalid_enum_value,options:e}),o}return OK(e.data)}get enum(){return this._def.values}};ZodNativeEnum.create=(e,t)=>new ZodNativeEnum({values:e,typeName:ee.ZodNativeEnum,...processCreateParams(t)});let ZodPromise=class ZodPromise extends ZodType{unwrap(){return this._def.type}_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==n.promise&&!1===t.common.async)return addIssueToContext(t,{code:s.invalid_type,expected:n.promise,received:t.parsedType}),o;let r=t.parsedType===n.promise?t.data:Promise.resolve(t.data);return OK(r.then(e=>this._def.type.parseAsync(e,{path:t.path,errorMap:t.common.contextualErrorMap})))}};ZodPromise.create=(e,t)=>new ZodPromise({type:e,typeName:ee.ZodPromise,...processCreateParams(t)});let ZodEffects=class ZodEffects extends ZodType{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===ee.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){let{status:t,ctx:r}=this._processInputParams(e),a=this._def.effect||null,n={addIssue:e=>{addIssueToContext(r,e),e.fatal?t.abort():t.dirty()},get path(){return r.path}};if(n.addIssue=n.addIssue.bind(n),"preprocess"===a.type){let e=a.transform(r.data,n);return r.common.issues.length?{status:"dirty",value:r.data}:r.common.async?Promise.resolve(e).then(e=>this._def.schema._parseAsync({data:e,path:r.path,parent:r})):this._def.schema._parseSync({data:e,path:r.path,parent:r})}if("refinement"===a.type){let executeRefinement=e=>{let t=a.refinement(e,n);if(r.common.async)return Promise.resolve(t);if(t instanceof Promise)throw Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return e};if(!1!==r.common.async)return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(e=>"aborted"===e.status?o:("dirty"===e.status&&t.dirty(),executeRefinement(e.value).then(()=>({status:t.value,value:e.value}))));{let e=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});return"aborted"===e.status?o:("dirty"===e.status&&t.dirty(),executeRefinement(e.value),{status:t.value,value:e.value})}}if("transform"===a.type){if(!1!==r.common.async)return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(e=>isValid(e)?Promise.resolve(a.transform(e.value,n)).then(e=>({status:t.value,value:e})):e);{let e=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});if(!isValid(e))return e;let s=a.transform(e.value,n);if(s instanceof Promise)throw Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:s}}}Y.assertNever(a)}};ZodEffects.create=(e,t,r)=>new ZodEffects({schema:e,typeName:ee.ZodEffects,effect:t,...processCreateParams(r)}),ZodEffects.createWithPreprocess=(e,t,r)=>new ZodEffects({schema:t,effect:{type:"preprocess",transform:e},typeName:ee.ZodEffects,...processCreateParams(r)});let ZodOptional=class ZodOptional extends ZodType{_parse(e){let t=this._getType(e);return t===n.undefined?OK(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};ZodOptional.create=(e,t)=>new ZodOptional({innerType:e,typeName:ee.ZodOptional,...processCreateParams(t)});let ZodNullable=class ZodNullable extends ZodType{_parse(e){let t=this._getType(e);return t===n.null?OK(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};ZodNullable.create=(e,t)=>new ZodNullable({innerType:e,typeName:ee.ZodNullable,...processCreateParams(t)});let ZodDefault=class ZodDefault extends ZodType{_parse(e){let{ctx:t}=this._processInputParams(e),r=t.data;return t.parsedType===n.undefined&&(r=this._def.defaultValue()),this._def.innerType._parse({data:r,path:t.path,parent:t})}removeDefault(){return this._def.innerType}};ZodDefault.create=(e,t)=>new ZodDefault({innerType:e,typeName:ee.ZodDefault,defaultValue:"function"==typeof t.default?t.default:()=>t.default,...processCreateParams(t)});let ZodCatch=class ZodCatch extends ZodType{_parse(e){let{ctx:t}=this._processInputParams(e),r={...t,common:{...t.common,issues:[]}},a=this._def.innerType._parse({data:r.data,path:r.path,parent:{...r}});return isAsync(a)?a.then(e=>({status:"valid",value:"valid"===e.status?e.value:this._def.catchValue({get error(){return new ZodError(r.common.issues)},input:r.data})})):{status:"valid",value:"valid"===a.status?a.value:this._def.catchValue({get error(){return new ZodError(r.common.issues)},input:r.data})}}removeCatch(){return this._def.innerType}};ZodCatch.create=(e,t)=>new ZodCatch({innerType:e,typeName:ee.ZodCatch,catchValue:"function"==typeof t.catch?t.catch:()=>t.catch,...processCreateParams(t)});let ZodNaN=class ZodNaN extends ZodType{_parse(e){let t=this._getType(e);if(t!==n.nan){let t=this._getOrReturnCtx(e);return addIssueToContext(t,{code:s.invalid_type,expected:n.nan,received:t.parsedType}),o}return{status:"valid",value:e.data}}};ZodNaN.create=e=>new ZodNaN({typeName:ee.ZodNaN,...processCreateParams(e)});let m=Symbol("zod_brand");let ZodBranded=class ZodBranded extends ZodType{_parse(e){let{ctx:t}=this._processInputParams(e),r=t.data;return this._def.type._parse({data:r,path:t.path,parent:t})}unwrap(){return this._def.type}};let ZodPipeline=class ZodPipeline extends ZodType{_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.common.async){let handleAsync=async()=>{let e=await this._def.in._parseAsync({data:r.data,path:r.path,parent:r});return"aborted"===e.status?o:"dirty"===e.status?(t.dirty(),DIRTY(e.value)):this._def.out._parseAsync({data:e.value,path:r.path,parent:r})};return handleAsync()}{let e=this._def.in._parseSync({data:r.data,path:r.path,parent:r});return"aborted"===e.status?o:"dirty"===e.status?(t.dirty(),{status:"dirty",value:e.value}):this._def.out._parseSync({data:e.value,path:r.path,parent:r})}}static create(e,t){return new ZodPipeline({in:e,out:t,typeName:ee.ZodPipeline})}};let ZodReadonly=class ZodReadonly extends ZodType{_parse(e){let t=this._def.innerType._parse(e);return isValid(t)&&(t.value=Object.freeze(t.value)),t}};ZodReadonly.create=(e,t)=>new ZodReadonly({innerType:e,typeName:ee.ZodReadonly,...processCreateParams(t)});let custom=(e,t={},r)=>e?ZodAny.create().superRefine((a,n)=>{var s,i;if(!e(a)){let e="function"==typeof t?t(a):"string"==typeof t?{message:t}:t,o=null===(i=null!==(s=e.fatal)&&void 0!==s?s:r)||void 0===i||i,d="string"==typeof e?{message:e}:e;n.addIssue({code:"custom",...d,fatal:o})}}):ZodAny.create(),y={object:ZodObject.lazycreate};!function(e){e.ZodString="ZodString",e.ZodNumber="ZodNumber",e.ZodNaN="ZodNaN",e.ZodBigInt="ZodBigInt",e.ZodBoolean="ZodBoolean",e.ZodDate="ZodDate",e.ZodSymbol="ZodSymbol",e.ZodUndefined="ZodUndefined",e.ZodNull="ZodNull",e.ZodAny="ZodAny",e.ZodUnknown="ZodUnknown",e.ZodNever="ZodNever",e.ZodVoid="ZodVoid",e.ZodArray="ZodArray",e.ZodObject="ZodObject",e.ZodUnion="ZodUnion",e.ZodDiscriminatedUnion="ZodDiscriminatedUnion",e.ZodIntersection="ZodIntersection",e.ZodTuple="ZodTuple",e.ZodRecord="ZodRecord",e.ZodMap="ZodMap",e.ZodSet="ZodSet",e.ZodFunction="ZodFunction",e.ZodLazy="ZodLazy",e.ZodLiteral="ZodLiteral",e.ZodEnum="ZodEnum",e.ZodEffects="ZodEffects",e.ZodNativeEnum="ZodNativeEnum",e.ZodOptional="ZodOptional",e.ZodNullable="ZodNullable",e.ZodDefault="ZodDefault",e.ZodCatch="ZodCatch",e.ZodPromise="ZodPromise",e.ZodBranded="ZodBranded",e.ZodPipeline="ZodPipeline",e.ZodReadonly="ZodReadonly"}(ee||(ee={}));let g=ZodString.create,_=ZodNumber.create,v=ZodNaN.create,E=ZodBigInt.create,w=ZodBoolean.create,b=ZodDate.create,k=ZodSymbol.create,T=ZodUndefined.create,S=ZodNull.create,x=ZodAny.create,Z=ZodUnknown.create,C=ZodNever.create,A=ZodVoid.create,O=ZodArray.create,I=ZodObject.create,P=ZodObject.strictCreate,R=ZodUnion.create,N=ZodDiscriminatedUnion.create,U=ZodIntersection.create,J=ZodTuple.create,K=ZodRecord.create,D=ZodMap.create,W=ZodSet.create,j=ZodFunction.create,L=ZodLazy.create,M=ZodLiteral.create,H=ZodEnum.create,B=ZodNativeEnum.create,$=ZodPromise.create,z=ZodEffects.create,F=ZodOptional.create,V=ZodNullable.create,G=ZodEffects.createWithPreprocess,q=ZodPipeline.create;var Y,X,Q,ee,et=Object.freeze({__proto__:null,defaultErrorMap:errorMap,setErrorMap:setErrorMap,getErrorMap:getErrorMap,makeIssue:makeIssue,EMPTY_PATH:[],addIssueToContext:addIssueToContext,ParseStatus:ParseStatus,INVALID:o,DIRTY:DIRTY,OK:OK,isAborted:isAborted,isDirty:isDirty,isValid:isValid,isAsync:isAsync,get util(){return Y},get objectUtil(){return X},ZodParsedType:n,getParsedType:getParsedType,ZodType:ZodType,ZodString:ZodString,ZodNumber:ZodNumber,ZodBigInt:ZodBigInt,ZodBoolean:ZodBoolean,ZodDate:ZodDate,ZodSymbol:ZodSymbol,ZodUndefined:ZodUndefined,ZodNull:ZodNull,ZodAny:ZodAny,ZodUnknown:ZodUnknown,ZodNever:ZodNever,ZodVoid:ZodVoid,ZodArray:ZodArray,ZodObject:ZodObject,ZodUnion:ZodUnion,ZodDiscriminatedUnion:ZodDiscriminatedUnion,ZodIntersection:ZodIntersection,ZodTuple:ZodTuple,ZodRecord:ZodRecord,ZodMap:ZodMap,ZodSet:ZodSet,ZodFunction:ZodFunction,ZodLazy:ZodLazy,ZodLiteral:ZodLiteral,ZodEnum:ZodEnum,ZodNativeEnum:ZodNativeEnum,ZodPromise:ZodPromise,ZodEffects:ZodEffects,ZodTransformer:ZodEffects,ZodOptional:ZodOptional,ZodNullable:ZodNullable,ZodDefault:ZodDefault,ZodCatch:ZodCatch,ZodNaN:ZodNaN,BRAND:m,ZodBranded:ZodBranded,ZodPipeline:ZodPipeline,ZodReadonly:ZodReadonly,custom:custom,Schema:ZodType,ZodSchema:ZodType,late:y,get ZodFirstPartyTypeKind(){return ee},coerce:{string:e=>ZodString.create({...e,coerce:!0}),number:e=>ZodNumber.create({...e,coerce:!0}),boolean:e=>ZodBoolean.create({...e,coerce:!0}),bigint:e=>ZodBigInt.create({...e,coerce:!0}),date:e=>ZodDate.create({...e,coerce:!0})},any:x,array:O,bigint:E,boolean:w,date:b,discriminatedUnion:N,effect:z,enum:H,function:j,instanceof:(e,t={message:`Input not instance of ${e.name}`})=>custom(t=>t instanceof e,t),intersection:U,lazy:L,literal:M,map:D,nan:v,nativeEnum:B,never:C,null:S,nullable:V,number:_,object:I,oboolean:()=>w().optional(),onumber:()=>_().optional(),optional:F,ostring:()=>g().optional(),pipeline:q,preprocess:G,promise:$,record:K,set:W,strictObject:P,string:g,symbol:k,transformer:z,tuple:J,undefined:T,union:R,unknown:Z,void:A,NEVER:o,ZodIssueCode:s,quotelessJson:e=>{let t=JSON.stringify(e,null,2);return t.replace(/"([^"]+)":/g,"$1:")},ZodError:ZodError});function _define_property$1(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}let er={BAD_REQUEST:400,FILE_TOO_LARGE:400,MIME_TYPE_NOT_ALLOWED:400,UNAUTHORIZED:401,UPLOAD_NOT_ALLOWED:403,DELETE_NOT_ALLOWED:403,CREATE_CONTEXT_ERROR:500,SERVER_ERROR:500};let EdgeStoreError=class EdgeStoreError extends Error{formattedMessage(){return`${this.message}${this.details?`
    Details: ${JSON.stringify(this.details)}`:""}${this.cause?`
    Caused by: ${this.cause.message}`:""}`}formattedJson(){return{message:"SERVER_ERROR"===this.code?"Internal server error":this.message,code:this.code,details:this.details}}constructor(e){super(e.message),_define_property$1(this,"cause",void 0),_define_property$1(this,"code",void 0),_define_property$1(this,"level",void 0),_define_property$1(this,"details",void 0),this.name="EdgeStoreError",this.code=e.code,this.cause=e.cause,this.level=er[e.code]>=500?"error":"warn",this.details="details"in e?e.details:void 0}};function createPathParamProxy(){let getPath=(e,t)=>new Proxy(()=>e,{get:(t,r)=>getPath(`${e}.${String(r)}`)});return new Proxy(()=>"",{get:(e,t)=>getPath(String(t))})}let createNewBuilder=(e,t)=>{let r={...e,...t};return createBuilder({type:r.type},r)};function createBuilder(e,t){let r={type:e.type,input:et.never(),path:[],metadata:()=>({}),...t};return{$config:{ctx:void 0},_def:r,input:e=>createNewBuilder(r,{input:e}),path(e){let t=createPathParamProxy(),a=e(t);return createNewBuilder(r,{path:a})},metadata:e=>createNewBuilder(r,{metadata:e}),accessControl:e=>createNewBuilder(r,{accessControl:e}),beforeUpload:e=>createNewBuilder(r,{beforeUpload:e}),beforeDelete:e=>createNewBuilder(r,{beforeDelete:e})}}let EdgeStoreBuilder=class EdgeStoreBuilder{context(){return new EdgeStoreBuilder}create(){return createEdgeStoreInner()()}};function createRouterFactory(){return function(e){return{$config:{ctx:void 0},buckets:e}}}function initBucket(e,t){return createBuilder({type:e},{bucketConfig:t})}function createEdgeStoreInner(){return function(){return{imageBucket:e=>initBucket("IMAGE",e),fileBucket:e=>initBucket("FILE",e),router:createRouterFactory()}}}let ea=new EdgeStoreBuilder}};