(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[57],{4997:function(e,t,a){Promise.resolve().then(a.bind(a,9477)),Promise.resolve().then(a.bind(a,5482)),Promise.resolve().then(a.bind(a,2872))},9477:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return components_Navbar}});var n=a(7437),r=a(1396),s=a.n(r),o=a(4033),i=a(2882),l=a(7972),c=a(3889),d=a(2265),u=a(7684),f=a(8004),h=a(8712),p=a(9213),m=a(2549);let g=h.fC;h.xz,h.x8;let C=h.h_,y=d.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,n.jsx)(h.aV,{className:(0,c.cn)("fixed inset-0 z-50 bg-background/80 backdrop-blur-sm data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",a),...r,ref:t})});y.displayName=h.aV.displayName;let x=(0,p.j)("fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500",{variants:{side:{top:"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",bottom:"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",left:"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm",right:"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm"}},defaultVariants:{side:"right"}}),b=d.forwardRef((e,t)=>{let{side:a="right",className:r,children:s,...o}=e;return(0,n.jsxs)(C,{children:[(0,n.jsx)(y,{}),(0,n.jsxs)(h.VY,{ref:t,className:(0,c.cn)(x({side:a}),r),...o,children:[s,(0,n.jsxs)(h.x8,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary",children:[(0,n.jsx)(m.Z,{className:"h-4 w-4"}),(0,n.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});b.displayName=h.VY.displayName;let v=d.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,n.jsx)(h.Dx,{ref:t,className:(0,c.cn)("text-lg font-semibold text-foreground",a),...r})});v.displayName=h.Dx.displayName;let T=d.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,n.jsx)(h.dk,{ref:t,className:(0,c.cn)("text-sm text-muted-foreground",a),...r})});T.displayName=h.dk.displayName;var S=a(4660);let E=(0,S.Ue)(e=>({isOpen:!1,onOpen:()=>e({isOpen:!0}),onClose:()=>e({isOpen:!1})})),MobileMenu=()=>{let[e,t]=(0,d.useState)(!1),a=(0,o.usePathname)(),{isOpen:r,onOpen:h,onClose:p}=E(),m=[{href:"/chat",label:(0,n.jsx)(i.Z,{className:"h-6 w-6 text-inherit"}),labelText:"Chat",active:"/chat"===a},{href:"/chat/profile",label:(0,n.jsx)(l.Z,{className:"h-10 w-10 p-[10px] rounded-full  text-inherit bg-profile_bg"}),labelText:"Account",active:"/chat/profile"===a}];return((0,d.useEffect)(()=>{t(!0)},[]),(0,d.useEffect)(()=>{p()},[a,p]),e)?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(u.z,{onClick:h,className:"block md:hidden absolute top-[3.9rem] left-10 z-50 ",variant:"ghost",size:"md",children:(0,n.jsx)(f.Z,{className:"w-5 h-5"})}),(0,n.jsx)(g,{open:r,onOpenChange:p,children:(0,n.jsx)(b,{side:"left",className:"p-2 pt-10",children:(0,n.jsx)("div",{className:"flex flex-col items-start mt-8",children:m.map(e=>(0,n.jsx)(s(),{href:e.href,className:(0,c.cn)("transition-colors p-3 rounded-full font-medium",e.active?"text-orange":"text-black_accent_2"),children:e.labelText},e.href))})})})]}):null};var _=a(6691),N=a.n(_);let Logo=()=>(0,n.jsx)(s(),{href:"/chat",children:(0,n.jsx)("div",{className:"hover:opacity-75 transition flex items-center gap-x-2",children:(0,n.jsx)(N(),{src:"/logo.svg",alt:"Logo",width:30,height:30})})});var components_Navbar=()=>{let e=(0,o.usePathname)(),t=[{href:"/chat",label:(0,n.jsx)(i.Z,{className:"h-6 w-6 text-inherit"}),labelText:"Chat",active:"/chat"===e},{href:"/chat/profile",label:(0,n.jsx)(l.Z,{className:"h-10 w-10 p-[10px] rounded-full  text-inherit bg-profile_bg"}),labelText:"Account",active:"/chat/profile"===e}];return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("nav",{className:"hidden md:flex  min-w-[70px] max-w-[70px] flex-col items-center justify-between py-8 px-4 bg-nav_bg h-full rounded-2xl shadow-sm",children:[(0,n.jsx)(Logo,{}),t.map(e=>(0,n.jsx)(s(),{href:e.href,className:(0,c.cn)("transition-colors p-3 rounded-full",e.active?"text-orange":"text-text_on_navbg"),children:e.label},e.href))]}),(0,n.jsx)(MobileMenu,{})]})}},7684:function(e,t,a){"use strict";a.d(t,{z:function(){return c}});var n=a(7437),r=a(2265),s=a(7256),o=a(9213),i=a(3889);let l=(0,o.j)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),c=r.forwardRef((e,t)=>{let{className:a,variant:r,size:o,asChild:c=!1,...d}=e,u=c?s.g7:"button";return(0,n.jsx)(u,{className:(0,i.cn)(l({variant:r,size:o,className:a})),ref:t,...d})});c.displayName="Button"},5482:function(e,t,a){"use strict";a.r(t),a.d(t,{ChatProvider:function(){return ChatProvider},useChat:function(){return useChat}});var n=a(7437),r=a(2265),s=a(8666);let o={currentChat:"",loading:!1,chatsLoading:!1,messages:[],chats:[],contacts:[]};function chatReducer(e,t){switch(t.type){case"SET_CURRENT_CHAT":return{...e,currentChat:t.payload};case"SET_LOADING":return{...e,loading:t.payload};case"SET_CHATS_LOADING":return{...e,chatsLoading:t.payload};case"SET_MESSAGES":return{...e,messages:t.payload};case"SET_CHATS":return{...e,chats:t.payload};case"SET_CONTACTS":return{...e,contacts:t.payload};case"UPDATE_SEEN":return{...e,messages:e.messages.map(e=>e._id===t.payload._id?{...e,status:"seen"}:e)};default:throw Error("No action of "+t.type)}}let i=(0,r.createContext)({}),ChatProvider=e=>{var t;let{children:a}=e,{socket:l}=(0,s.useSocket)(),[c,d]=(0,r.useReducer)(chatReducer,o),handleSetCurrChat=async e=>{l&&(console.log("emitting join event from socekt"),l.emit("JOIN",{data:e}));let t={...e,unread:0};d({type:"SET_CURRENT_CHAT",payload:t}),(null==e?void 0:e.unread)>0&&resetUnreadCount(null==e?void 0:e._id).then(e=>{let{chat:t}=e;if(t){d({type:"SET_CURRENT_CHAT",payload:t});let e=updateChatList(c.chats,t);null!==e&&d({type:"SET_CHATS",payload:e})}})},getChat=async e=>{try{let t=await fetch("api/getChat",{method:"POST",body:JSON.stringify({receiverId:e})}),{data:a}=await t.json();handleSetCurrChat(a[0]);let n=[...c.chats,a[0]];d({type:"SET_CHATS",payload:n})}catch(e){console.log(e)}},u=(0,r.useCallback)(async()=>{d({type:"SET_LOADING",payload:!0});try{let e=await fetch("api/chats/".concat(c.currentChat._id,"/messages")),{data:t}=await e.json();d({type:"SET_MESSAGES",payload:[...t]})}catch(e){console.log(e)}finally{d({type:"SET_LOADING",payload:!1})}},[null==c?void 0:null===(t=c.currentChat)||void 0===t?void 0:t._id]);async function getData(e){if(e)try{let t=await fetch(e);return await t.json()}catch(e){return console.error(e),null}}async function resetUnreadCount(e){let t=await fetch("api/resetUnread/".concat(e),{method:"POST"});return await t.json()}let f=(0,r.useCallback)(async()=>{d({type:"SET_CHATS_LOADING",payload:!0});let e=await getData("api/chats"),t=await getData("api/contacts");d({type:"SET_CHATS",payload:null==e?void 0:e.chats}),d({type:"SET_CONTACTS",payload:null==t?void 0:t.contacts}),d({type:"SET_CHATS_LOADING",payload:!1})},[]);return(0,r.useEffect)(()=>{c.currentChat&&u()},[c.currentChat,u]),(0,r.useEffect)(()=>{f()},[f]),(0,r.useEffect)(()=>(l&&l.on("CHAT_UPDATE",e=>{var t;console.log("chat update event"),(null===(t=c.currentChat)||void 0===t?void 0:t._id)===(null==e?void 0:e._id)&&e.unread>0&&(resetUnreadCount(e._id),e.unread=0);let a=updateChatList(c.chats,e);null!==a&&d({type:"SET_CHATS",payload:a})}),()=>{null==l||l.off("CHAT_UPDATE")}),[l,c.chats,c.currentChat]),(0,n.jsx)(i.Provider,{value:{currentChat:c.currentChat,contacts:c.contacts,messages:c.messages,loading:c.loading,chatsLoading:c.chatsLoading,chats:c.chats,handleSetCurrChat,resetUnreadCount,setMessages:e=>{d({type:"SET_MESSAGES",payload:e})},setContacts:e=>{d({type:"SET_CONTACTS",payload:e})},updateSeen:e=>{d({type:"UPDATE_SEEN",payload:e})},closeChat:()=>{d({type:"SET_CURRENT_CHAT",payload:null})},setChats:e=>{d({type:"SET_CHATS",payload:e})},getChat},children:a})},useChat=()=>(0,r.useContext)(i);function updateChatList(e,t){let a=e.findIndex(e=>e._id===t._id);if(-1!==a&&JSON.stringify(e[a])!==JSON.stringify(t)){let n=[...e];return n[a]=t,n}return null}},8666:function(e,t,a){"use strict";a.r(t),a.d(t,{SocketProvider:function(){return SocketProvider},useSocket:function(){return useSocket}});var n=a(7437),r=a(7430),s=a(2749),o=a(2265),i=a(3388);let l=(0,o.createContext)({socket:null,isConnected:!1}),useSocket=()=>(0,o.useContext)(l),SocketProvider=e=>{let{children:t}=e,[a,c]=(0,o.useState)(null),[d,u]=(0,o.useState)(!1),{data:f}=(0,s.useSession)(),{remove:h,set:p}=(0,r.Z)();return(0,o.useEffect)(()=>{let e=JSON.parse(localStorage.getItem("UserEmail")),t=new i.io({path:"/api/socket/io"});return t.on("connect",()=>{e&&(console.log("socket is registered with ",e),t.emit("REGISTER",{email:e})),u(!0)}),t.on("disconnect",()=>{console.log("client socket disconnected."),u(!1)}),t.on("ACTIVE_USERS",e=>{p(e)}),t.on("ACTIVE_USERS:REMOVE",e=>{console.log("remove a active user ",e),h(e)}),c(t),()=>{t.disconnect()}},[]),(0,n.jsx)(l.Provider,{value:{socket:a,isConnected:d},children:t})}},2872:function(e,t,a){"use strict";a.r(t),a.d(t,{WebRTC:function(){return WebRTC},useWebRTC:function(){return useWebRTC}});var n=a(7437),r=a(2265),s=a(8666);let o=(0,r.createContext)(null),i={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"turn:openrelay.metered.ca:80",username:"openrelayproject",credential:"openrelayproject"}]},WebRTC=e=>{let{children:t}=e,[a,o]=(0,r.useState)(null),{socket:l}=(0,s.useSocket)(),c=(0,r.useRef)(),d=(0,r.useRef)();(0,r.useEffect)(()=>{if(RTCPeerConnection){let e=new RTCPeerConnection(i);return e.ontrack=e=>{c.current&&e.streams[0]&&(c.current.srcObject=e.streams[0])},null==l||l.on("ICE_CANDIDATE",async t=>{if(t)try{let a=new RTCIceCandidate(t);await e.addIceCandidate(a)}catch(e){console.log("handleIceCandidate: ",e)}}),o(e),()=>{null==l||l.off("ICE_CANDIDATE")}}},[]);let initiateCall=async(e,t)=>{let n=await navigator.mediaDevices.getUserMedia({video:!0});d.current&&(d.current.srcObject=n),n.getTracks().forEach(e=>{a.addTrack(e,n)}),a.onicecandidate=e=>{e.candidate&&(null==l||l.emit("ICE_CANDIDATE",{candidate,to:t}))};let r=await a.createOffer();await a.setLocalDescription(r),null==l||l.emit("OUTGOING_CALL",{sender:e,receiver:t,offer:r})},handleCall=async(e,t)=>{await a.setRemoteDescription(new RTCSessionDescription(e));let n=await a.createAnswer();await a.setLocalDescription(n),null==l||l.emit("CALL_ACCEPTED",{ans:n,to:t})};return a?(0,n.jsx)(WebRTC.Provider,{value:{pc:a,initiateCall,handleCall,remoteVideoRef:c,selfVideoRef:d},children:t}):null},useWebRTC=()=>(0,r.useContext)(o)},7430:function(e,t,a){"use strict";var n=a(4660);let r=(0,n.Ue)(e=>({members:[],add:t=>e(e=>({members:[...e.members,t]})),remove:t=>e(e=>({members:e.members.filter(e=>e!==t)})),set:t=>e({members:t})}));t.Z=r},3889:function(e,t,a){"use strict";a.d(t,{cn:function(){return cn}});var n=a(7042),r=a(4769);function cn(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,r.m6)((0,n.W)(t))}}},function(e){e.O(0,[294,894,7,935,284,653,971,472,744],function(){return e(e.s=4997)}),_N_E=e.O()}]);