"use strict";var We=Object.create;var K=Object.defineProperty;var Ve=Object.getOwnPropertyDescriptor;var Ge=Object.getOwnPropertyNames;var De=Object.getPrototypeOf,Se=Object.prototype.hasOwnProperty;var ke=(e,t)=>{for(var d in t)K(e,d,{get:t[d],enumerable:!0})},ye=(e,t,d,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of Ge(t))!Se.call(e,o)&&o!==d&&K(e,o,{get:()=>t[o],enumerable:!(n=Ve(t,o))||n.enumerable});return e};var P=(e,t,d)=>(d=e!=null?We(De(e)):{},ye(t||!e||!e.__esModule?K(d,"default",{value:e,enumerable:!0}):d,e)),je=e=>ye(K({},"__esModule",{value:!0}),e);var Ke={};ke(Ke,{CldImage:()=>ae,CldOgImage:()=>se,CldUploadButton:()=>ce,CldUploadWidget:()=>B,CldVideoPlayer:()=>pe,cloudinaryLoader:()=>te,getCldImageUrl:()=>I,getCldOgImageUrl:()=>Ae,getCldVideoUrl:()=>oe});module.exports=je(Ke);var A=P(require("react")),Ue=P(require("next/image")),Oe=require("@cloudinary-util/util"),Ee=require("@cloudinary-util/url-loader");async function Q(e){let{src:t}=e;try{await new Promise((d,n)=>{fetch(t).then(o=>{if(!o.ok){n(o);return}d(o)})})}catch(d){return d.status===423?await Q(e):!1}return!0}function T(e){if(!e)throw new Error("A Cloudinary Cloud name is required, please make sure NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME is set and configured in your environment.")}var Ie=require("@cloudinary-util/url-loader");var he=P(require("next/package.json"));var Ce={name:"next-cloudinary",version:"5.18.0",license:"MIT",main:"./dist/index.js",module:"./dist/index.mjs",types:"./dist/index.d.ts",source:"src/index.ts",scripts:{build:"tsup",dev:"tsup --watch",prepublishOnly:"cp ../README.md . && cp ../LICENSE . && yarn build",postpublish:"rm ./README.md && rm ./LICENSE",test:"jest","test:app":'NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME="test" yarn build && cd tests/nextjs-app && yarn build'},dependencies:{"@cloudinary-util/url-loader":"^3.22.0","@cloudinary-util/util":"^2.3.0"},devDependencies:{"@babel/core":"^7.23.2","@babel/preset-env":"^7.23.2","@types/jest":"^29.5.6","@types/react":"^18.2.33","@types/react-dom":"^18.2.14","babel-jest":"^29.7.0",dotenv:"^16.3.1",jest:"^29.7.0","jest-environment-jsdom":"^29.7.0",mkdirp:"^3.0.1","ts-jest":"^29.1.1",tsup:"^7.2.0",typescript:"^5.2.2"},peerDependencies:{next:"^12 || ^13 || ^14",react:"^17 || ^18"}};var J="V",Z=Ce.version,ee=he.default.version;function I(e,t,d){var o,r;let n=(r=(o=t==null?void 0:t.cloud)==null?void 0:o.cloudName)!=null?r:process.env.NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME;return T(n),(0,Ie.constructCloudinaryUrl)({options:e,config:Object.assign({cloud:{cloudName:n}},t),analytics:Object.assign({sdkCode:J,sdkSemver:Z,techVersion:ee,feature:""},d)})}function te({loaderOptions:e,imageProps:t,cldOptions:d,cldConfig:n={}}){let o={...t,...d};o.width=typeof o.width=="string"?parseInt(o.width):o.width,o.height=typeof o.height=="string"?parseInt(o.height):o.height;let r;return typeof(e==null?void 0:e.width)=="number"&&typeof o.width=="number"&&e.width!==o.width?r=e.width:typeof(e==null?void 0:e.width)=="number"&&typeof(o==null?void 0:o.width)!="number"&&(r=e.width,o.width=r),o.width&&r&&r<o.width&&(o.widthResize=e.width),I(o,n)}var Fe=(0,A.forwardRef)(function(t,d){let n=!1,o=["deliveryType","preserveTransformations","strictTransformations","assetType"];Ee.transformationPlugins.forEach(({props:i=[]})=>{i.forEach(u=>{if(o.includes(u))throw new Error(`Option ${u} already exists!`);o.push(u)})});let r={alt:t.alt,src:t.src};Object.keys(t).filter(i=>!o.includes(i)).forEach(i=>r[i]=t[i]);let c=Object.keys(r).map(i=>`${i}:${r[i]}`).join(";"),[U,O]=(0,A.useState)(c),p={};if(o.forEach(i=>{t[i]&&(p[i]=t[i]||void 0)}),t.preserveTransformations)try{let i=(0,Oe.getTransformations)(t.src).map(u=>u.join(","));p.rawTransformations=[...i.flat(),...t.rawTransformations||[]]}catch(i){console.warn(`Failed to preserve transformations: ${i.message}`)}let a=process.env.__NEXT_IMAGE_OPTS||{};(t.unoptimized===!0||(a==null?void 0:a.unoptimized)===!0)&&(r.src=I({...p,width:r.width,height:r.height,src:r.src,format:"default",quality:"default"},t.config));async function E(i){let u=!0;if(n)return;if(n=!0,typeof t.onError=="function"){let x=t.onError(i);typeof x=="boolean"&&x===!1&&(u=!1)}else typeof t.onError=="boolean"&&t.onError===!1&&(u=!1);if(u===!1)return;let v=i.target;await Q({src:v.src})&&O(`${c};${Date.now()}`)}let w=(0,A.useCallback)(E,[Q,c]),_=Ue.default;return"default"in _&&(_=_.default),A.default.createElement(_,{key:U,...r,loader:i=>te({loaderOptions:i,imageProps:r,cldOptions:p,cldConfig:t.config}),onError:w,ref:d})}),ae=Fe;var N=P(require("react")),Pe=P(require("next/head"));var He="summary_large_image",Xe=({excludeTags:e=[],twitterTitle:t,keys:d={},...n})=>{let{alt:o}=n,r={...n,crop:n.crop||"fill",gravity:n.gravity||"center",height:n.height||1254,src:n.src,width:n.width||2400,widthResize:n.width||1200},c=typeof r.width=="string"?parseInt(r.width):r.width,U=typeof r.height=="string"?parseInt(r.height):r.height;typeof U=="number"&&typeof c=="number"&&(U=1200/c*U),c=1200;let O=I({...r,format:n.format||"jpg"}),p=I({...r,format:n.format||"webp"}),a={"og:image":"og-image","og:image:secure_url":"og-image-secureurl","og:image:width":"og-image-width","og:image:height":"og-image-height","og:image:alt":"og-image-alt","twitter:title":"twitter-title","twitter:card":"twitter-card","twitter:image":"twitter-image",...d};return N.default.createElement(Pe.default,null,N.default.createElement("meta",{key:a["og:image"],property:"og:image",content:O}),N.default.createElement("meta",{key:a["og:image:secure_url"],property:"og:image:secure_url",content:O}),N.default.createElement("meta",{key:a["og:image:width"],property:"og:image:width",content:`${c}`}),N.default.createElement("meta",{key:a["og:image:height"],property:"og:image:height",content:`${U}`}),o&&N.default.createElement("meta",{key:a["og:image:alt"],property:"og:image:alt",content:o}),!e.includes("twitter:title")&&N.default.createElement("meta",{key:a["twitter:title"],property:"twitter:title",content:t||" "}),N.default.createElement("meta",{key:a["twitter:card"],property:"twitter:card",content:He}),N.default.createElement("meta",{key:a["twitter:image"],property:"twitter:image",content:p}))},se=Xe;var Y=P(require("react"));var f=P(require("react")),_e=P(require("next/script"));function we(e){return window&&"requestIdleCallback"in window?requestIdleCallback(e):setTimeout(()=>e(),1)}var Be=["success","display-changed"],Ye={abort:"onAbort","batch-cancelled":"onBatchCancelled","display-changed":"onDisplayChanged",publicid:"onPublicId","queues-end":"onQueuesEnd","queues-start":"onQueuesStart",retry:"onRetry","show-completed":"onShowCompleted","source-changed":"onSourceChanged",success:"onSuccess",tags:"onTags","upload-added":"onUploadAdded"},$e=({children:e,onClose:t,onError:d,onOpen:n,onUpload:o,options:r,signatureEndpoint:c,uploadPreset:U,...O})=>{let p=(0,f.useRef)(),a=(0,f.useRef)(),E=!!c,[w,_]=(0,f.useState)(void 0),[i,u]=(0,f.useState)(void 0),[v,G]=(0,f.useState)(!0),x={cloudName:process.env.NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME,uploadPreset:U||process.env.NEXT_PUBLIC_CLOUDINARY_UPLOAD_PRESET,apiKey:process.env.NEXT_PUBLIC_CLOUDINARY_API_KEY,...r};T(process.env.NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME),E&&(x.uploadSignature=L,x.apiKey||console.warn("Missing dependency: Signed Upload requires an API key")),(0,f.useEffect)(()=>{if(typeof i=="undefined")return;let l=i.event==="success",g=i.event==="display-changed"&&i.info==="hidden";l&&typeof o=="function"&&o(i,a.current),g&&typeof t=="function"&&t(a.current)},[i]),(0,f.useEffect)(()=>{w&&typeof d=="function"&&d(w,a.current)},[w]);function j(){G(!1),p.current||(p.current=window.cloudinary),we(()=>{a.current||(a.current=V())})}(0,f.useEffect)(()=>()=>{var l;(l=a.current)==null||l.destroy(),a.current=void 0},[]);function L(l,g){if(typeof c=="undefined")throw Error("Failed to generate signature: signatureEndpoint undefined.");fetch(c,{method:"POST",body:JSON.stringify({paramsToSign:g})}).then(y=>y.json()).then(({signature:y})=>{l(y)})}function m(l,g=[]){if(a.current||(a.current=V()),typeof(a==null?void 0:a.current[l])=="function")return a.current[l](...g)}function D(l){m("close",[l])}function M(l){return m("destroy",[l])}function R(){m("hide")}function F(){return m("isDestroyed")}function S(){return m("isMinimized")}function $(){return m("isShowing")}function W(){m("minimize")}function z(l,g){m("open",[l,g]),typeof n=="function"&&n(a.current)}function ne(){m("show")}function H(){m("update")}let q={close:D,destroy:M,hide:R,isDestroyed:F,isMinimized:S,isShowing:$,minimize:W,open:z,show:ne,update:H};function V(){var l;return(l=p.current)==null?void 0:l.createUploadWidget(x,(g,y)=>{if(g&&g!==null&&_(g),typeof(y==null?void 0:y.event)=="string"){Be.includes(y==null?void 0:y.event)&&u(y);let b=Ye[y.event];if(typeof b=="string"&&typeof O[b]=="function"&&typeof O[b]){let ie=O[b];ie(y,{widget:a.current,...q})}}})}return f.default.createElement(f.default.Fragment,null,typeof e=="function"&&e({cloudinary:p.current,widget:a.current,results:i,error:w,isLoading:v,...q}),f.default.createElement(_e.default,{id:`cloudinary-uploadwidget-${Math.floor(Math.random()*100)}`,src:"https://upload-widget.cloudinary.com/global/all.js",onLoad:j,onError:l=>console.error(`Failed to load Cloudinary Upload Widget: ${l.message}`)}))},B=$e;var ze=({className:e,children:t,onClick:d,onError:n,onOpen:o,onUpload:r,onAbort:c,onBatchCancelled:U,onClose:O,onDisplayChanged:p,onPublicId:a,onQueuesEnd:E,onQueuesStart:w,onRetry:_,onShowCompleted:i,onSourceChanged:u,onSuccess:v,onTags:G,onUploadAdded:x,options:j,signatureEndpoint:L,uploadPreset:m,...D})=>Y.default.createElement(Y.default.Fragment,null,Y.default.createElement(B,{onError:n,onOpen:o,onUpload:r,onAbort:c,onBatchCancelled:U,onClose:O,onDisplayChanged:p,onPublicId:a,onQueuesEnd:E,onQueuesStart:w,onRetry:_,onShowCompleted:i,onSourceChanged:u,onSuccess:v,onTags:G,onUploadAdded:x,options:j,signatureEndpoint:L,uploadPreset:m},({open:M,isLoading:R})=>{function F(S){S.preventDefault(),M(),typeof d=="function"&&d(S)}return Y.default.createElement("button",{...D,className:e||"",onClick:F,disabled:R},t||"Upload")})),ce=ze;var C=P(require("react")),Ne=P(require("next/script")),be=P(require("next/head")),Te=require("@cloudinary-util/util");var xe=require("@cloudinary-util/url-loader");function oe(e,t,d){var o,r;let n=(r=(o=t==null?void 0:t.cloud)==null?void 0:o.cloudName)!=null?r:process.env.NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME;return T(n),(0,xe.constructCloudinaryUrl)({options:{assetType:"video",...e},config:Object.assign({cloud:{cloudName:n}},t),analytics:Object.assign({sdkCode:J,sdkSemver:Z,techVersion:ee,feature:""},d)})}var re=[],Le="1.10.4",qe=e=>{let{autoPlay:t,autoplay:d,className:n,colors:o,controls:r=!0,fontFace:c,height:U,id:O,language:p,languages:a,logo:E=!0,loop:w=!1,muted:_=!1,onDataLoad:i,onError:u,onMetadataLoad:v,onPause:G,onPlay:x,onEnded:j,poster:L,src:m,sourceTypes:D,transformation:M,quality:R="auto",width:F,...S}=e,$=Array.isArray(M)?M:[M],W=m||"";if(W.startsWith("http"))try{let s=(0,Te.parseUrl)(m);typeof(s==null?void 0:s.publicId)=="string"&&(W=s==null?void 0:s.publicId)}catch(s){}$.unshift({quality:R});let z=(0,C.useRef)(),ne=(0,C.useRef)(),H=e.videoRef||ne,q=(0,C.useRef)(),V=e.playerRef||q,l=O||`player-${W.replace("/","-")}`,g="cld-video-player cld-fluid";n&&(g=`${g} ${n}`),re.filter(s=>s===l).length>1?console.warn(`Multiple instances of the same video detected on the
     page which may cause some features to not work. 
    Try adding a unique id to each player.`):re.push(l);let b={error:u,loadeddata:i,loadedmetadata:v,pause:G,play:x,ended:j};function ie(s){let h=b[s.type];typeof h=="function"&&h(Me())}T(process.env.NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME);function ve(){if("cloudinary"in window){z.current=window.cloudinary;let s={};typeof E=="boolean"?s.showLogo=E:typeof E=="object"&&(s={...s,showLogo:!0,logoImageUrl:E.imageUrl,logoOnclickUrl:E.onClickUrl});let h=d||t,ue=!1,me;t&&process.env.NODE_ENV==="development"&&console.warn('Prop autoPlay will be removed in future versions, please use autoplay (lowercase "p")'),(typeof h=="boolean"||h==="true"||h==="false")&&(ue=h),typeof h=="string"&&h!=="true"&&h!=="false"&&(me=h);let k={autoplayMode:me,autoplay:ue,cloud_name:process.env.NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME,controls:r,fontFace:c||"",language:p,languages:a,loop:w,muted:_,publicId:W,transformation:$,...s,...S};Array.isArray(D)&&(k.sourceTypes=D),typeof o=="object"&&(k.colors=o),typeof L=="string"?k.posterOptions={publicId:L}:typeof L=="object"&&(typeof L.src!="string"?k.posterOptions={publicId:oe({...L,src:W,format:"auto:image"})}:k.posterOptions={publicId:I(L)}),V.current=z.current.videoPlayer(H.current,k),Object.keys(b).forEach(ge=>{var fe;typeof b[ge]=="function"&&((fe=V.current)==null||fe.on(ge,ie))})}}(0,C.useEffect)(()=>()=>{var s;(s=V.current)==null||s.videojs.cloudinary.dispose(),re=re.filter(h=>h!==l)},[]);function Me(){return{player:V.current,video:H.current}}return C.default.createElement(C.default.Fragment,null,C.default.createElement(be.default,null,C.default.createElement("link",{href:`https://unpkg.com/cloudinary-video-player@${Le}/dist/cld-video-player.min.css`,rel:"stylesheet"})),C.default.createElement("div",{style:{width:"100%",aspectRatio:`${e.width} / ${e.height}`}},C.default.createElement("video",{ref:H,id:l,className:g,width:F,height:U}),C.default.createElement(Ne.default,{id:`cloudinary-videoplayer-${l}-${Math.floor(Math.random()*100)}`,src:`https://unpkg.com/cloudinary-video-player@${Le}/dist/cld-video-player.min.js`,onLoad:ve,onError:s=>console.error(`Failed to load Cloudinary Video Player: ${s.message}`)})))},pe=qe;function Ae(e){return I({...e,crop:e.crop||"fill",format:e.format||"jpg",gravity:e.gravity||"center",height:e.height||1254,width:e.width||2400,widthResize:e.width||1200})}0&&(module.exports={CldImage,CldOgImage,CldUploadButton,CldUploadWidget,CldVideoPlayer,cloudinaryLoader,getCldImageUrl,getCldOgImageUrl,getCldVideoUrl});
//# sourceMappingURL=index.js.map