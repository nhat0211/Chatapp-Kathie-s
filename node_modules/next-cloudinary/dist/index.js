"use strict";var Me=Object.create;var K=Object.defineProperty;var Ve=Object.getOwnPropertyDescriptor;var Ge=Object.getOwnPropertyNames;var De=Object.getPrototypeOf,Se=Object.prototype.hasOwnProperty;var ke=(e,t)=>{for(var a in t)K(e,a,{get:t[a],enumerable:!0})},ye=(e,t,a,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of Ge(t))!Se.call(e,o)&&o!==a&&K(e,o,{get:()=>t[o],enumerable:!(n=Ve(t,o))||n.enumerable});return e};var w=(e,t,a)=>(a=e!=null?Me(De(e)):{},ye(t||!e||!e.__esModule?K(a,"default",{value:e,enumerable:!0}):a,e)),je=e=>ye(K({},"__esModule",{value:!0}),e);var Ke={};ke(Ke,{CldImage:()=>de,CldOgImage:()=>se,CldUploadButton:()=>pe,CldUploadWidget:()=>B,CldVideoPlayer:()=>ce,cloudinaryLoader:()=>te,getCldImageUrl:()=>h,getCldOgImageUrl:()=>Ae,getCldVideoUrl:()=>oe});module.exports=je(Ke);var v=w(require("react")),Ue=w(require("next/image")),Oe=require("@cloudinary-util/util"),Ee=require("@cloudinary-util/url-loader");async function Q(e){let{src:t}=e;try{await new Promise((a,n)=>{fetch(t).then(o=>{if(!o.ok){n(o);return}a(o)})})}catch(a){return a.status===423?await Q(e):!1}return!0}function A(e){if(!e)throw new Error("A Cloudinary Cloud name is required, please make sure NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME is set and configured in your environment.")}var Ie=require("@cloudinary-util/url-loader");var he=w(require("next/package.json"));var Ce={name:"next-cloudinary",version:"5.20.0",license:"MIT",main:"./dist/index.js",module:"./dist/index.mjs",types:"./dist/index.d.ts",source:"src/index.ts",scripts:{build:"tsup",dev:"tsup --watch",prepublishOnly:"cp ../README.md . && cp ../LICENSE . && yarn build",postpublish:"rm ./README.md && rm ./LICENSE",test:"jest","test:app":'NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME="test" yarn build && cd tests/nextjs-app && yarn build'},dependencies:{"@cloudinary-util/url-loader":"^4.1.1","@cloudinary-util/util":"^2.3.0"},devDependencies:{"@babel/core":"^7.23.2","@babel/preset-env":"^7.23.2","@types/jest":"^29.5.6","@types/react":"^18.2.33","@types/react-dom":"^18.2.14","babel-jest":"^29.7.0",dotenv:"^16.3.1",jest:"^29.7.0","jest-environment-jsdom":"^29.7.0",mkdirp:"^3.0.1","ts-jest":"^29.1.1",tsup:"^7.2.0",typescript:"^5.2.2"},peerDependencies:{next:"^12 || ^13 || ^14",react:"^17 || ^18"}};var J="V",Z=Ce.version,ee=he.default.version;function h(e,t,a){var o,r;let n=(r=(o=t==null?void 0:t.cloud)==null?void 0:o.cloudName)!=null?r:process.env.NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME;return A(n),(0,Ie.constructCloudinaryUrl)({options:e,config:Object.assign({cloud:{cloudName:n}},t),analytics:Object.assign({sdkCode:J,sdkSemver:Z,techVersion:ee,feature:""},a)})}function te({loaderOptions:e,imageProps:t,cldOptions:a,cldConfig:n={}}){let o={...t,...a};o.width=typeof o.width=="string"?parseInt(o.width):o.width,o.height=typeof o.height=="string"?parseInt(o.height):o.height;let r;return typeof(e==null?void 0:e.width)=="number"&&typeof o.width=="number"&&e.width!==o.width?r=e.width:typeof(e==null?void 0:e.width)=="number"&&typeof(o==null?void 0:o.width)!="number"&&(r=e.width,o.width=r),o.width&&r&&r<o.width&&(o.widthResize=e.width),h(o,n)}var Fe=(0,v.forwardRef)(function(t,a){let n=!1,o=["deliveryType","preserveTransformations","strictTransformations","assetType"];Ee.transformationPlugins.forEach(({props:i})=>{Object.keys(i).forEach(P=>{if(o.includes(P))throw new Error(`Option ${P} already exists!`);o.push(P)})});let r={alt:t.alt,src:t.src};Object.keys(t).filter(i=>!o.includes(i)).forEach(i=>r[i]=t[i]);let p=Object.keys(r).map(i=>`${i}:${r[i]}`).join(";"),[I,U]=(0,v.useState)(p),c={};if(o.forEach(i=>{t[i]&&(c[i]=t[i]||void 0)}),t.preserveTransformations)try{let i=(0,Oe.getTransformations)(t.src).map(O=>O.join(","));c.rawTransformations=[...i.flat(),...t.rawTransformations||[]]}catch(i){console.warn(`Failed to preserve transformations: ${i.message}`)}let d=process.env.__NEXT_IMAGE_OPTS||{};(t.unoptimized===!0||(d==null?void 0:d.unoptimized)===!0)&&(r.src=h({...c,width:r.width,height:r.height,src:r.src,format:"default",quality:"default"},t.config));async function E(i){let O=!0;if(n)return;if(n=!0,typeof t.onError=="function"){let N=t.onError(i);typeof N=="boolean"&&N===!1&&(O=!1)}else typeof t.onError=="boolean"&&t.onError===!1&&(O=!1);if(O===!1)return;let P=i.target;await Q({src:P.src})&&U(`${p};${Date.now()}`)}let _=(0,v.useCallback)(E,[Q,p]),L=Ue.default;return"default"in L&&(L=L.default),v.default.createElement(L,{key:I,...r,loader:i=>te({loaderOptions:i,imageProps:r,cldOptions:c,cldConfig:t.config}),onError:_,ref:a})}),de=Fe;var x=w(require("react")),Pe=w(require("next/head"));var He="summary_large_image",Xe=({excludeTags:e=[],twitterTitle:t,keys:a={},...n})=>{let{alt:o}=n,r={...n,crop:n.crop||"fill",gravity:n.gravity||"center",height:n.height||1254,src:n.src,width:n.width||2400,widthResize:n.width||1200},p=typeof r.width=="string"?parseInt(r.width):r.width,I=typeof r.height=="string"?parseInt(r.height):r.height;typeof I=="number"&&typeof p=="number"&&(I=1200/p*I),p=1200;let U=h({...r,format:n.format||"jpg"}),c=h({...r,format:n.format||"webp"}),d={"og:image":"og-image","og:image:secure_url":"og-image-secureurl","og:image:width":"og-image-width","og:image:height":"og-image-height","og:image:alt":"og-image-alt","twitter:title":"twitter-title","twitter:card":"twitter-card","twitter:image":"twitter-image",...a};return x.default.createElement(Pe.default,null,x.default.createElement("meta",{key:d["og:image"],property:"og:image",content:U}),x.default.createElement("meta",{key:d["og:image:secure_url"],property:"og:image:secure_url",content:U}),x.default.createElement("meta",{key:d["og:image:width"],property:"og:image:width",content:`${p}`}),x.default.createElement("meta",{key:d["og:image:height"],property:"og:image:height",content:`${I}`}),o&&x.default.createElement("meta",{key:d["og:image:alt"],property:"og:image:alt",content:o}),!e.includes("twitter:title")&&x.default.createElement("meta",{key:d["twitter:title"],property:"twitter:title",content:t||" "}),x.default.createElement("meta",{key:d["twitter:card"],property:"twitter:card",content:He}),x.default.createElement("meta",{key:d["twitter:image"],property:"twitter:image",content:c}))},se=Xe;var Y=w(require("react"));var m=w(require("react")),_e=w(require("next/script"));function we(e){return window&&"requestIdleCallback"in window?requestIdleCallback(e):setTimeout(()=>e(),1)}var Be=["success","display-changed"],Ye={abort:"onAbort","batch-cancelled":"onBatchCancelled","display-changed":"onDisplayChanged",publicid:"onPublicId","queues-end":"onQueuesEnd","queues-start":"onQueuesStart",retry:"onRetry","show-completed":"onShowCompleted","source-changed":"onSourceChanged",success:"onSuccess",tags:"onTags","upload-added":"onUploadAdded"},$e=({children:e,onClose:t,onError:a,onOpen:n,onUpload:o,options:r,signatureEndpoint:p,uploadPreset:I,...U})=>{let c=(0,m.useRef)(),d=(0,m.useRef)(),E=!!p,[_,L]=(0,m.useState)(void 0),[i,O]=(0,m.useState)(void 0),[P,G]=(0,m.useState)(!0),N={cloudName:process.env.NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME,uploadPreset:I||process.env.NEXT_PUBLIC_CLOUDINARY_UPLOAD_PRESET,apiKey:process.env.NEXT_PUBLIC_CLOUDINARY_API_KEY,...r};A(process.env.NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME),E&&(N.uploadSignature=b,N.apiKey||console.warn("Missing dependency: Signed Upload requires an API key")),(0,m.useEffect)(()=>{if(typeof i=="undefined")return;let l=i.event==="success",g=i.event==="display-changed"&&i.info==="hidden";l&&typeof o=="function"&&o(i,d.current),g&&typeof t=="function"&&t(d.current)},[i]),(0,m.useEffect)(()=>{_&&typeof a=="function"&&a(_,d.current)},[_]);function j(){G(!1),c.current||(c.current=window.cloudinary),we(()=>{d.current||(d.current=V())})}(0,m.useEffect)(()=>()=>{var l;(l=d.current)==null||l.destroy(),d.current=void 0},[]);function b(l,g){if(typeof p=="undefined")throw Error("Failed to generate signature: signatureEndpoint undefined.");fetch(p,{method:"POST",body:JSON.stringify({paramsToSign:g})}).then(f=>f.json()).then(({signature:f})=>{l(f)})}function u(l,g=[]){if(d.current||(d.current=V()),typeof(d==null?void 0:d.current[l])=="function")return d.current[l](...g)}function D(l){u("close",[l])}function W(l){return u("destroy",[l])}function R(){u("hide")}function F(){return u("isDestroyed")}function S(){return u("isMinimized")}function $(){return u("isShowing")}function M(){u("minimize")}function z(l,g){u("open",[l,g]),typeof n=="function"&&n(d.current)}function ne(){u("show")}function H(){u("update")}let q={close:D,destroy:W,hide:R,isDestroyed:F,isMinimized:S,isShowing:$,minimize:M,open:z,show:ne,update:H};function V(){var l;return(l=c.current)==null?void 0:l.createUploadWidget(N,(g,f)=>{if(g&&g!==null&&L(g),typeof(f==null?void 0:f.event)=="string"){Be.includes(f==null?void 0:f.event)&&O(f);let T=Ye[f.event];if(typeof T=="string"&&typeof U[T]=="function"&&typeof U[T]){let ie=U[T];ie(f,{widget:d.current,...q})}}})}return m.default.createElement(m.default.Fragment,null,typeof e=="function"&&e({cloudinary:c.current,widget:d.current,results:i,error:_,isLoading:P,...q}),m.default.createElement(_e.default,{id:`cloudinary-uploadwidget-${Math.floor(Math.random()*100)}`,src:"https://upload-widget.cloudinary.com/global/all.js",onLoad:j,onError:l=>console.error(`Failed to load Cloudinary Upload Widget: ${l.message}`)}))},B=$e;var ze=({className:e,children:t,onClick:a,onError:n,onOpen:o,onUpload:r,onAbort:p,onBatchCancelled:I,onClose:U,onDisplayChanged:c,onPublicId:d,onQueuesEnd:E,onQueuesStart:_,onRetry:L,onShowCompleted:i,onSourceChanged:O,onSuccess:P,onTags:G,onUploadAdded:N,options:j,signatureEndpoint:b,uploadPreset:u,...D})=>Y.default.createElement(Y.default.Fragment,null,Y.default.createElement(B,{onError:n,onOpen:o,onUpload:r,onAbort:p,onBatchCancelled:I,onClose:U,onDisplayChanged:c,onPublicId:d,onQueuesEnd:E,onQueuesStart:_,onRetry:L,onShowCompleted:i,onSourceChanged:O,onSuccess:P,onTags:G,onUploadAdded:N,options:j,signatureEndpoint:b,uploadPreset:u},({open:W,isLoading:R})=>{function F(S){S.preventDefault(),W(),typeof a=="function"&&a(S)}return Y.default.createElement("button",{...D,className:e||"",onClick:F,disabled:R},t||"Upload")})),pe=ze;var y=w(require("react")),be=w(require("next/script")),xe=w(require("next/head")),Te=require("@cloudinary-util/util");var Le=require("@cloudinary-util/url-loader");function oe(e,t,a){var o,r;let n=(r=(o=t==null?void 0:t.cloud)==null?void 0:o.cloudName)!=null?r:process.env.NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME;return A(n),(0,Le.constructCloudinaryUrl)({options:{assetType:"video",...e},config:Object.assign({cloud:{cloudName:n}},t),analytics:Object.assign({sdkCode:J,sdkSemver:Z,techVersion:ee,feature:""},a)})}var re=[],Ne="1.10.4",qe=e=>{let{autoPlay:t,autoplay:a,className:n,colors:o,controls:r=!0,fontFace:p,height:I,id:U,language:c,languages:d,logo:E=!0,loop:_=!1,muted:L=!1,onDataLoad:i,onError:O,onMetadataLoad:P,onPause:G,onPlay:N,onEnded:j,poster:b,src:u,sourceTypes:D,transformation:W,quality:R="auto",width:F,...S}=e,$=Array.isArray(W)?W:[W],M=u||"";if(M.startsWith("http"))try{let s=(0,Te.parseUrl)(u);typeof(s==null?void 0:s.publicId)=="string"&&(M=s==null?void 0:s.publicId)}catch(s){}$.unshift({quality:R});let z=(0,y.useRef)(),ne=(0,y.useRef)(),H=e.videoRef||ne,q=(0,y.useRef)(),V=e.playerRef||q,l=U||`player-${M.replace("/","-")}`,g="cld-video-player cld-fluid";n&&(g=`${g} ${n}`),re.filter(s=>s===l).length>1?console.warn(`Multiple instances of the same video detected on the
     page which may cause some features to not work. 
    Try adding a unique id to each player.`):re.push(l);let T={error:O,loadeddata:i,loadedmetadata:P,pause:G,play:N,ended:j};function ie(s){let C=T[s.type];typeof C=="function"&&C(We())}A(process.env.NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME);function ve(){if("cloudinary"in window){z.current=window.cloudinary;let s={};typeof E=="boolean"?s.showLogo=E:typeof E=="object"&&(s={...s,showLogo:!0,logoImageUrl:E.imageUrl,logoOnclickUrl:E.onClickUrl});let C=a||t,ue=!1,ge;t&&process.env.NODE_ENV==="development"&&console.warn('Prop autoPlay will be removed in future versions, please use autoplay (lowercase "p")'),(typeof C=="boolean"||C==="true"||C==="false")&&(ue=C),typeof C=="string"&&C!=="true"&&C!=="false"&&(ge=C);let k={autoplayMode:ge,autoplay:ue,cloud_name:process.env.NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME,controls:r,fontFace:p||"",language:c,languages:d,loop:_,muted:L,publicId:M,transformation:$,...s,...S};Array.isArray(D)&&(k.sourceTypes=D),typeof o=="object"&&(k.colors=o),typeof b=="string"?k.posterOptions={publicId:b}:typeof b=="object"&&(typeof b.src!="string"?k.posterOptions={publicId:oe({...b,src:M,format:"auto:image"})}:k.posterOptions={publicId:h(b)}),V.current=z.current.videoPlayer(H.current,k),Object.keys(T).forEach(me=>{var fe;typeof T[me]=="function"&&((fe=V.current)==null||fe.on(me,ie))})}}(0,y.useEffect)(()=>()=>{var s;(s=V.current)==null||s.videojs.cloudinary.dispose(),re=re.filter(C=>C!==l)},[]);function We(){return{player:V.current,video:H.current}}return y.default.createElement(y.default.Fragment,null,y.default.createElement(xe.default,null,y.default.createElement("link",{href:`https://unpkg.com/cloudinary-video-player@${Ne}/dist/cld-video-player.min.css`,rel:"stylesheet"})),y.default.createElement("div",{style:{width:"100%",aspectRatio:`${e.width} / ${e.height}`}},y.default.createElement("video",{ref:H,id:l,className:g,width:F,height:I}),y.default.createElement(be.default,{id:`cloudinary-videoplayer-${l}-${Math.floor(Math.random()*100)}`,src:`https://unpkg.com/cloudinary-video-player@${Ne}/dist/cld-video-player.min.js`,onLoad:ve,onError:s=>console.error(`Failed to load Cloudinary Video Player: ${s.message}`)})))},ce=qe;function Ae(e){return h({...e,crop:e.crop||"fill",format:e.format||"jpg",gravity:e.gravity||"center",height:e.height||1254,width:e.width||2400,widthResize:e.width||1200})}0&&(module.exports={CldImage,CldOgImage,CldUploadButton,CldUploadWidget,CldVideoPlayer,cloudinaryLoader,getCldImageUrl,getCldOgImageUrl,getCldVideoUrl});
//# sourceMappingURL=index.js.map