exports.id=555,exports.ids=[555],exports.modules={25816:(e,t,a)=>{Promise.resolve().then(a.bind(a,89240)),Promise.resolve().then(a.bind(a,85456)),Promise.resolve().then(a.bind(a,38727))},89240:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>components_Navbar});var s=a(30784),n=a(11440),r=a.n(n),o=a(57114),l=a(18310),i=a(93680),c=a(1268),d=a(9885),h=a(1488),u=a(7382),p=a(7589),f=a(97389),C=a(56206);let x=p.fC;p.xz,p.x8;let m=p.h_,g=d.forwardRef(({className:e,...t},a)=>s.jsx(p.aV,{className:(0,c.cn)("fixed inset-0 z-50 bg-background/80 backdrop-blur-sm data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...t,ref:a}));g.displayName=p.aV.displayName;let y=(0,f.j)("fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500",{variants:{side:{top:"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",bottom:"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",left:"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm",right:"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm"}},defaultVariants:{side:"right"}}),T=d.forwardRef(({side:e="right",className:t,children:a,...n},r)=>(0,s.jsxs)(m,{children:[s.jsx(g,{}),(0,s.jsxs)(p.VY,{ref:r,className:(0,c.cn)(y({side:e}),t),...n,children:[a,(0,s.jsxs)(p.x8,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary",children:[s.jsx(C.Z,{className:"h-4 w-4"}),s.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));T.displayName=p.VY.displayName;let S=d.forwardRef(({className:e,...t},a)=>s.jsx(p.Dx,{ref:a,className:(0,c.cn)("text-lg font-semibold text-foreground",e),...t}));S.displayName=p.Dx.displayName;let b=d.forwardRef(({className:e,...t},a)=>s.jsx(p.dk,{ref:a,className:(0,c.cn)("text-sm text-muted-foreground",e),...t}));b.displayName=p.dk.displayName;var _=a(99715);let N=(0,_.Ue)(e=>({isOpen:!1,onOpen:()=>e({isOpen:!0}),onClose:()=>e({isOpen:!1})})),MobileMenu=()=>{let[e,t]=(0,d.useState)(!1),a=(0,o.usePathname)(),{isOpen:n,onOpen:p,onClose:f}=N(),C=[{href:"/chat",label:s.jsx(l.Z,{className:"h-6 w-6 text-inherit"}),labelText:"Chat",active:"/chat"===a},{href:"/chat/profile",label:s.jsx(i.Z,{className:"h-10 w-10 p-[10px] rounded-full  text-inherit bg-profile_bg"}),labelText:"Account",active:"/chat/profile"===a}];return((0,d.useEffect)(()=>{t(!0)},[]),(0,d.useEffect)(()=>{f()},[a,f]),e)?(0,s.jsxs)(s.Fragment,{children:[s.jsx(h.z,{onClick:p,className:"block md:hidden absolute top-[3.9rem] left-10 z-50 ",variant:"ghost",size:"md",children:s.jsx(u.Z,{className:"w-5 h-5"})}),s.jsx(x,{open:n,onOpenChange:f,children:s.jsx(T,{side:"left",className:"p-2 pt-10",children:s.jsx("div",{className:"flex flex-col items-start mt-8",children:C.map(e=>s.jsx(r(),{href:e.href,className:(0,c.cn)("transition-colors p-3 rounded-full font-medium",e.active?"text-orange":"text-black_accent_2"),children:e.labelText},e.href))})})})]}):null};var w=a(52451),E=a.n(w);let Logo=()=>s.jsx(r(),{href:"/chat",children:s.jsx("div",{className:"hover:opacity-75 transition flex items-center gap-x-2",children:s.jsx(E(),{src:"/logo.svg",alt:"Logo",width:30,height:30})})}),components_Navbar=()=>{let e=(0,o.usePathname)(),t=[{href:"/chat",label:s.jsx(l.Z,{className:"h-6 w-6 text-inherit"}),labelText:"Chat",active:"/chat"===e},{href:"/chat/profile",label:s.jsx(i.Z,{className:"h-10 w-10 p-[10px] rounded-full  text-inherit bg-profile_bg"}),labelText:"Account",active:"/chat/profile"===e}];return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("nav",{className:"hidden md:flex  min-w-[70px] max-w-[70px] flex-col items-center justify-between py-8 px-4 bg-nav_bg h-full rounded-2xl shadow-sm",children:[s.jsx(Logo,{}),t.map(e=>s.jsx(r(),{href:e.href,className:(0,c.cn)("transition-colors p-3 rounded-full",e.active?"text-orange":"text-text_on_navbg"),children:e.label},e.href))]}),s.jsx(MobileMenu,{})]})}},85456:(e,t,a)=>{"use strict";a.r(t),a.d(t,{ChatProvider:()=>ChatProvider,useChat:()=>useChat});var s=a(30784),n=a(9885),r=a(4345);let o={currentChat:"",loading:!1,chatsLoading:!1,messages:[],chats:[],contacts:[]};function chatReducer(e,t){switch(t.type){case"SET_CURRENT_CHAT":return{...e,currentChat:t.payload};case"SET_LOADING":return{...e,loading:t.payload};case"SET_CHATS_LOADING":return{...e,chatsLoading:t.payload};case"SET_MESSAGES":return{...e,messages:t.payload};case"SET_CHATS":return{...e,chats:t.payload};case"SET_CONTACTS":return{...e,contacts:t.payload};case"UPDATE_SEEN":return{...e,messages:e.messages.map(e=>e._id===t.payload._id?{...e,status:"seen"}:e)};default:throw Error("No action of "+t.type)}}let l=(0,n.createContext)({}),ChatProvider=({children:e})=>{let{socket:t}=(0,r.useSocket)(),[a,i]=(0,n.useReducer)(chatReducer,o),handleSetCurrChat=async e=>{t&&(console.log("emitting join event from socekt"),t.emit("JOIN",{data:e}));let s={...e,unread:0};i({type:"SET_CURRENT_CHAT",payload:s}),e?.unread>0&&resetUnreadCount(e?._id).then(({chat:e})=>{if(e){i({type:"SET_CURRENT_CHAT",payload:e});let t=updateChatList(a.chats,e);null!==t&&i({type:"SET_CHATS",payload:t})}})},getChat=async e=>{try{let t=await fetch("api/getChat",{method:"POST",body:JSON.stringify({receiverId:e})}),{data:s}=await t.json();handleSetCurrChat(s[0]);let n=[...a.chats,s[0]];i({type:"SET_CHATS",payload:n})}catch(e){console.log(e)}},c=(0,n.useCallback)(async()=>{i({type:"SET_LOADING",payload:!0});try{let e=await fetch(`api/chats/${a.currentChat._id}/messages`),{data:t}=await e.json();i({type:"SET_MESSAGES",payload:[...t]})}catch(e){console.log(e)}finally{i({type:"SET_LOADING",payload:!1})}},[a?.currentChat?._id]);async function getData(e){if(e)try{let t=await fetch(e);return await t.json()}catch(e){return console.error(e),null}}async function resetUnreadCount(e){let t=await fetch(`api/resetUnread/${e}`,{method:"POST"});return await t.json()}let d=(0,n.useCallback)(async()=>{i({type:"SET_CHATS_LOADING",payload:!0});let e=await getData("api/chats"),t=await getData("api/contacts");i({type:"SET_CHATS",payload:e?.chats}),i({type:"SET_CONTACTS",payload:t?.contacts}),i({type:"SET_CHATS_LOADING",payload:!1})},[]);return(0,n.useEffect)(()=>{a.currentChat&&c()},[a.currentChat,c]),(0,n.useEffect)(()=>{d()},[d]),(0,n.useEffect)(()=>(t&&t.on("CHAT_UPDATE",e=>{console.log("chat update event"),a.currentChat?._id===e?._id&&e.unread>0&&(resetUnreadCount(e._id),e.unread=0);let t=updateChatList(a.chats,e);null!==t&&i({type:"SET_CHATS",payload:t})}),()=>{t?.off("CHAT_UPDATE")}),[t,a.chats,a.currentChat]),s.jsx(l.Provider,{value:{currentChat:a.currentChat,contacts:a.contacts,messages:a.messages,loading:a.loading,chatsLoading:a.chatsLoading,chats:a.chats,handleSetCurrChat,resetUnreadCount,setMessages:e=>{i({type:"SET_MESSAGES",payload:e})},setContacts:e=>{i({type:"SET_CONTACTS",payload:e})},updateSeen:e=>{i({type:"UPDATE_SEEN",payload:e})},closeChat:()=>{i({type:"SET_CURRENT_CHAT",payload:null})},setChats:e=>{i({type:"SET_CHATS",payload:e})},getChat},children:e})},useChat=()=>(0,n.useContext)(l);function updateChatList(e,t){let a=e.findIndex(e=>e._id===t._id);if(-1!==a&&JSON.stringify(e[a])!==JSON.stringify(t)){let s=[...e];return s[a]=t,s}return null}},38727:(e,t,a)=>{"use strict";a.r(t),a.d(t,{WebRTC:()=>WebRTC,useWebRTC:()=>useWebRTC});var s=a(30784),n=a(9885),r=a(4345);let o=(0,n.createContext)(null),WebRTC=({children:e})=>{let[t,a]=(0,n.useState)(null),{socket:o}=(0,r.useSocket)(),l=(0,n.useRef)(),i=(0,n.useRef)();(0,n.useEffect)(()=>{},[]);let initiateCall=async(e,a)=>{let s=await navigator.mediaDevices.getUserMedia({video:!0});i.current&&(i.current.srcObject=s),s.getTracks().forEach(e=>{t.addTrack(e,s)}),t.onicecandidate=e=>{e.candidate&&o?.emit("ICE_CANDIDATE",{candidate,to:a})};let n=await t.createOffer();await t.setLocalDescription(n),o?.emit("OUTGOING_CALL",{sender:e,receiver:a,offer:n})},handleCall=async(e,a)=>{await t.setRemoteDescription(new RTCSessionDescription(e));let s=await t.createAnswer();await t.setLocalDescription(s),o?.emit("CALL_ACCEPTED",{ans:s,to:a})};return t?s.jsx(WebRTC.Provider,{value:{pc:t,initiateCall,handleCall,remoteVideoRef:l,selfVideoRef:i},children:e}):null},useWebRTC=()=>(0,n.useContext)(o)},56887:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>ChatLayout});var s=a(4656),n=a(95153);let r=(0,n.createProxy)(String.raw`/Users/quangnhat/Documents/Chatapp-Kathie/components/Navbar.jsx`),{__esModule:o,$$typeof:l}=r,i=r.default,c=(0,n.createProxy)(String.raw`/Users/quangnhat/Documents/Chatapp-Kathie/context/ChatContext.js`),{__esModule:d,$$typeof:h}=c;c.default;let u=(0,n.createProxy)(String.raw`/Users/quangnhat/Documents/Chatapp-Kathie/context/ChatContext.js#ChatProvider`);(0,n.createProxy)(String.raw`/Users/quangnhat/Documents/Chatapp-Kathie/context/ChatContext.js#useChat`);let p=(0,n.createProxy)(String.raw`/Users/quangnhat/Documents/Chatapp-Kathie/context/webrtc-provider.jsx`),{__esModule:f,$$typeof:C}=p;function ChatLayout({children:e}){return s.jsx(u,{children:(0,s.jsxs)("section",{className:"h-full max-h-[1200px] flex items-center w-full max-w-screen-2xl self-stretch mx-auto gap-2",children:[s.jsx(i,{}),e]})})}p.default,(0,n.createProxy)(String.raw`/Users/quangnhat/Documents/Chatapp-Kathie/context/webrtc-provider.jsx#WebRTC`),(0,n.createProxy)(String.raw`/Users/quangnhat/Documents/Chatapp-Kathie/context/webrtc-provider.jsx#useWebRTC`)}};